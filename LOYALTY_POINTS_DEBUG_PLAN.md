# üîç –ü–õ–ê–ù –î–ï–ë–ê–ì–ì–ò–ù–ì–ê: –ë–ê–õ–õ–´ –õ–û–Ø–õ–¨–ù–û–°–¢–ò –ò –ü–†–û–ú–û–ö–û–î–´

> üìò **–°–≤—è–∑–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:** [`LOYALTY_POINTS_AND_PROMO_SCENARIOS_ANALYSIS.md`](./LOYALTY_POINTS_AND_PROMO_SCENARIOS_ANALYSIS.md) ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –≤—Å–µ–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-15  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –¥–µ–±–∞–≥–≥–∏–Ω–≥–∞](#1-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã-–¥–µ–±–∞–≥–≥–∏–Ω–≥–∞)
2. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫](#2-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö-–ø—Ä–æ–≤–µ—Ä–æ–∫)
3. [–¢–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è](#3-—Ç–æ—á–∫–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è-–¥–ª—è-–∫–∞–∂–¥–æ–≥–æ-—Å—Ü–µ–Ω–∞—Ä–∏—è)
4. [–¢–µ–≥–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏](#4-—Ç–µ–≥–∏-–∏-—Ñ–∏–ª—å—Ç—Ä—ã-–¥–ª—è-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)
5. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ–±–∞–≥–≥–µ—Ä–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤](#5-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–¥–µ–±–∞–≥–≥–µ—Ä–∞-–¥–ª—è-–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
6. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é](#6-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏-–ø–æ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)

---

## 1. –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´ –î–ï–ë–ê–ì–ì–ò–ù–ì–ê

### 1.1. –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `hooks/useDebugRecorder.tsx` ‚Äî –∑–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
- `lib/debug-auto-checks.ts` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- `app/api/debug/report/route.ts` ‚Äî API –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤
- `components/debug/DebugConsole.tsx` ‚Äî UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö console.log/error/warn/info
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (5 —Ç–∏–ø–æ–≤)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –≤ `debug_reports/`
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 1.2. –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

**–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
1. –†–∞—Å—à–∏—Ä–∏—Ç—å `debug-auto-checks.ts` –¥–ª—è –≤—Å–µ—Ö 15 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º
4. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

---

## 2. –†–ê–°–®–ò–†–ï–ù–ò–ï –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–í–ï–†–û–ö

### 2.1. –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–§–∞–π–ª:** `lib/debug-auto-checks.ts`

#### 2.1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```typescript
/**
 * ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
 */
export async function checkPendingTransaction(
  debug: DebugRecorder,
  params: {
    transactionId: number;
    orderId: number;
    userId: number;
    expectedPoints: number;
    deliveryDate: string;
    paymentMethod: string;
  }
) {
  const { transactionId, orderId, userId, expectedPoints, deliveryDate, paymentMethod } = params;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –Ω–µ-cash –∑–∞–∫–∞–∑–∞
  if (paymentMethod !== 'cash') {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –Ω–µ-cash –∑–∞–∫–∞–∑–∞',
      data: {
        issue: 'pending_for_non_cash',
        transactionId,
        orderId,
        paymentMethod,
        userId,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞—Å—å —á–µ—Ä–µ–∑ 25+ —á–∞—Å–æ–≤
  const deliveryDateObj = new Date(deliveryDate);
  const hoursSinceDelivery = (Date.now() - deliveryDateObj.getTime()) / (1000 * 60 * 60);
  if (hoursSinceDelivery > 25) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞—Å—å —á–µ—Ä–µ–∑ 25+ —á–∞—Å–æ–≤',
      data: {
        issue: 'pending_not_processed',
        transactionId,
        orderId,
        hoursSinceDelivery: Math.round(hoursSinceDelivery),
        userId,
      },
    });
  }

  debug.log('‚úÖ Pending transaction check completed', { transactionId, passed: true });
}
```

#### 2.1.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –±–∞–ª–ª–æ–≤

```typescript
/**
 * üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞
 */
export async function checkLoyaltyPointsRefund(
  debug: DebugRecorder,
  params: {
    orderId: number;
    userId: number;
    pointsEarned: number;
    pointsUsed: number;
    oldPoints: number;
    newPoints: number;
    oldTotalSpent: number;
    newTotalSpent: number;
    orderTotal: number;
  }
) {
  const { orderId, userId, pointsEarned, pointsUsed, oldPoints, newPoints, oldTotalSpent, newTotalSpent, orderTotal } = params;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ë–∞–ª–ª—ã –Ω–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å (–∫–æ–≥–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏)
  const expectedPointsAfterRefund = oldPoints + pointsUsed - pointsEarned;
  if (Math.abs(newPoints - expectedPointsAfterRefund) > 0.01) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞',
      data: {
        issue: 'incorrect_points_refund',
        orderId,
        userId,
        expected: expectedPointsAfterRefund,
        actual: newPoints,
        difference: newPoints - expectedPointsAfterRefund,
        pointsEarned,
        pointsUsed,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: total_spent –Ω–µ –æ—Ç–∫–∞—Ç–∏–ª—Å—è (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞!)
  const expectedTotalSpent = oldTotalSpent - orderTotal + pointsUsed;
  if (Math.abs(newTotalSpent - expectedTotalSpent) > 0.01) {
    await debug.captureError({
      errorMessage: 'üö® total_spent –ù–ï –æ—Ç–∫–∞—Ç–∏–ª—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞!',
      data: {
        issue: 'total_spent_not_rolled_back',
        orderId,
        userId,
        expected: expectedTotalSpent,
        actual: newTotalSpent,
        difference: newTotalSpent - expectedTotalSpent,
        orderTotal,
        pointsUsed,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã –Ω–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å
  if (pointsUsed > 0 && newPoints < oldPoints + pointsUsed) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã –Ω–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ',
      data: {
        issue: 'used_points_not_refunded',
        orderId,
        userId,
        pointsUsed,
        oldPoints,
        newPoints,
      },
    });
  }

  debug.log('‚úÖ Loyalty points refund check completed', { orderId, passed: true });
}
```

#### 2.1.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

```typescript
/**
 * üéüÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
 */
export async function checkPromoCode(
  debug: DebugRecorder,
  params: {
    promoCode: string;
    orderTotal: number;
    minOrderAmount?: number;
    discount: number;
    maxDiscount?: number;
    usageType: 'unlimited' | 'once_per_user' | 'once_total';
    timesUsed: number;
    userId: number;
    orderId?: number;
  }
) {
  const { promoCode, orderTotal, minOrderAmount, discount, maxDiscount, usageType, timesUsed, userId, orderId } = params;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –∑–∞–∫–∞–∑—É –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã
  if (minOrderAmount && orderTotal < minOrderAmount) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –∑–∞–∫–∞–∑—É –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã',
      data: {
        issue: 'promo_min_order_amount_violation',
        promoCode,
        orderTotal,
        minOrderAmount,
        userId,
        orderId,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –°–∫–∏–¥–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é
  if (maxDiscount && discount > maxDiscount) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è –°–∫–∏–¥–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞',
      data: {
        issue: 'promo_max_discount_exceeded',
        promoCode,
        discount,
        maxDiscount,
        userId,
        orderId,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–æ–º–æ–∫–æ–¥ once_total –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ
  if (usageType === 'once_total' && timesUsed > 1) {
    await debug.captureError({
      errorMessage: '‚ö†Ô∏è –ü—Ä–æ–º–æ–∫–æ–¥ once_total –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ',
      data: {
        issue: 'promo_once_total_reused',
        promoCode,
        timesUsed,
        userId,
        orderId,
      },
    });
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –°—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è
  // (—ç—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
  debug.log('‚úÖ Promo code check completed', { promoCode, discount, passed: true });
}
```

#### 2.1.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω—ã —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

```typescript
/**
 * üí≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å–º–µ–Ω—ã —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
 */
export async function checkPaymentMethodChange(
  debug: DebugRecorder,
  params: {
    orderId: number;
    userId: number;
    oldPaymentMethod: string;
    newPaymentMethod: string;
    pendingPointsEarned: number;
    actualPointsEarned: number;
  }
) {
  const { orderId, userId, oldPaymentMethod, newPaymentMethod, pendingPointsEarned, actualPointsEarned } = params;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –°–º–µ–Ω–∞ —Å cash –Ω–∞ online, –Ω–æ pending –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å
  if (oldPaymentMethod === 'cash' && (newPaymentMethod === 'card' || newPaymentMethod === 'sbp')) {
    if (pendingPointsEarned > 0 && actualPointsEarned === 0) {
      await debug.captureError({
        errorMessage: '‚ö†Ô∏è –ü—Ä–∏ —Å–º–µ–Ω–µ —Å cash –Ω–∞ online pending –±–∞–ª–ª—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å',
        data: {
          issue: 'pending_not_processed_on_payment_change',
          orderId,
          userId,
          oldPaymentMethod,
          newPaymentMethod,
          pendingPointsEarned,
          actualPointsEarned,
        },
      });
    }
  }

  debug.log('‚úÖ Payment method change check completed', { orderId, passed: true });
}
```

---

## 3. –¢–û–ß–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –î–õ–Ø –ö–ê–ñ–î–û–ì–û –°–¶–ï–ù–ê–†–ò–Ø

### 3.1. –°—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ (EARNED)

#### 3.1.1. –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (POST)

**–§–∞–π–ª:** `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∏ 681-707)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 681
if (order.paymentMethod === 'card' || order.paymentMethod === 'sbp') {
  // üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.2
  console.log('[DEBUG SCENARIO 1.2] –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (POST)', {
    scenario: 'earned_online_post',
    userId,
    orderId: nocoOrder.Id,
    orderTotal: orderTotalNum,
    pointsUsed,
    expectedPoints: actualPointsEarned,
    paymentMethod: order.paymentMethod,
  });

  const userBefore = await fetchUserById(userId, true);
  const pointsBefore = userBefore?.loyalty_points || 0;
  const totalSpentBefore = userBefore?.total_spent || 0;

  await awardLoyaltyPoints(userId, orderTotalNum, 0, actualPointsEarned, nocoOrder.Id);

  const userAfter = await fetchUserById(userId, true);
  const pointsAfter = userAfter?.loyalty_points || 0;
  const totalSpentAfter = userAfter?.total_spent || 0;

  // üîç DEBUG: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  console.log('[DEBUG SCENARIO 1.2] –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è', {
    scenario: 'earned_online_post',
    pointsBefore,
    pointsAfter,
    pointsChange: pointsAfter - pointsBefore,
    expectedChange: actualPointsEarned - pointsUsed,
    totalSpentBefore,
    totalSpentAfter,
    totalSpentChange: totalSpentAfter - totalSpentBefore,
    expectedTotalSpentChange: orderTotalNum - pointsUsed,
  });

  // üîç DEBUG: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  if (typeof window !== 'undefined' && (window as any).__debugRecorder) {
    await checkLoyaltyPointsAwarded((window as any).__debugRecorder, {
      paymentMethod: order.paymentMethod,
      orderTotal: orderTotalNum,
      expectedPoints: actualPointsEarned,
      actualPointsAwarded: pointsAfter - pointsBefore,
      oldPoints: pointsBefore,
      newPoints: pointsAfter,
      userId,
      orderId: nocoOrder.Id,
    });
  }
}
```

#### 3.1.2. –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–ø–ª–∞—Ç–µ (PATCH full)

**–§–∞–π–ª:** `app/api/orders/[id]/route.ts` (—Å—Ç—Ä–æ–∫–∏ 330-380)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 110
if (!wasPaid && willBePaid && orderTotal > 0) {
  const existingPointsEarned = currentOrder.loyalty_points_earned || 0;
  
  // üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.3
  console.log('[DEBUG SCENARIO 1.3] –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–ø–ª–∞—Ç–µ (PATCH full)', {
    scenario: 'earned_online_patch_full',
    orderId: id,
    userId: currentOrder.user_id,
    wasPaid,
    willBePaid,
    existingPointsEarned,
    orderTotal,
    pointsUsed,
  });

  if (existingPointsEarned === 0) {
    const userBefore = await fetchUserById(currentOrder.user_id, true);
    const pointsBefore = userBefore?.loyalty_points || 0;
    const totalSpentBefore = userBefore?.total_spent || 0;

    loyaltyPointsEarned = calculateEarnedPoints(orderTotal, pointsUsed, currentTotalSpent);
    await awardLoyaltyPoints(currentOrder.user_id, orderTotal, 0, loyaltyPointsEarned, Number(id));

    const userAfter = await fetchUserById(currentOrder.user_id, true);
    const pointsAfter = userAfter?.loyalty_points || 0;
    const totalSpentAfter = userAfter?.total_spent || 0;

    // üîç DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç
    console.log('[DEBUG SCENARIO 1.3] –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è', {
      scenario: 'earned_online_patch_full',
      pointsBefore,
      pointsAfter,
      pointsChange: pointsAfter - pointsBefore,
      expectedChange: loyaltyPointsEarned - pointsUsed,
      totalSpentBefore,
      totalSpentAfter,
    });
  }
}
```

#### 3.1.3. –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ - Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (POST)

**–§–∞–π–ª:** `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∏ 707-724)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 707
if (order.paymentMethod === 'cash') {
  // üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.5
  console.log('[DEBUG SCENARIO 1.5] –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ - Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (POST)', {
    scenario: 'earned_cash_pending_post',
    userId,
    orderId: nocoOrder.Id,
    orderTotal: orderTotalNum,
    expectedPoints: actualPointsEarned,
    deliveryDate: order.startDate,
  });

  const userBefore = await fetchUserById(userId, true);
  const pointsBefore = userBefore?.loyalty_points || 0;
  const totalSpentBefore = userBefore?.total_spent || 0;

  await createPendingLoyaltyPoints(userId, orderTotalNum, 0, actualPointsEarned, nocoOrder.Id);

  const userAfter = await fetchUserById(userId, true);
  const pointsAfter = userAfter?.loyalty_points || 0;
  const totalSpentAfter = userAfter?.total_spent || 0;

  // üîç DEBUG: –ü—Ä–æ–≤–µ—Ä–∫–∞ (–±–∞–ª–ª—ã –ù–ï –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω–∏—Ç—å—Å—è, total_spent –î–û–õ–ñ–ï–ù)
  console.log('[DEBUG SCENARIO 1.5] –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è pending', {
    scenario: 'earned_cash_pending_post',
    pointsBefore,
    pointsAfter,
    pointsShouldNotChange: pointsAfter === pointsBefore,
    totalSpentBefore,
    totalSpentAfter,
    totalSpentChange: totalSpentAfter - totalSpentBefore,
    expectedTotalSpentChange: orderTotalNum - pointsUsed,
  });

  // üîç DEBUG: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  if (typeof window !== 'undefined' && (window as any).__debugRecorder) {
    await checkPendingTransaction((window as any).__debugRecorder, {
      transactionId: 0, // –ë—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
      orderId: nocoOrder.Id,
      userId,
      expectedPoints: actualPointsEarned,
      deliveryDate: order.startDate,
      paymentMethod: 'cash',
    });
  }
}
```

#### 3.1.4. –°—Ü–µ–Ω–∞—Ä–∏–π 7: –°–º–µ–Ω–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –æ–Ω–ª–∞–π–Ω

**–§–∞–π–ª:** `app/api/orders/[id]/route.ts` (—Å—Ç—Ä–æ–∫–∏ 432-506)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 257
if (isPaymentMethodChangedFromCash) {
  // üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.8
  console.log('[DEBUG SCENARIO 1.8] –°–º–µ–Ω–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –æ–Ω–ª–∞–π–Ω', {
    scenario: 'earned_payment_method_change',
    orderId: id,
    userId: currentOrder.user_id,
    oldPaymentMethod,
    newPaymentMethod: order.paymentMethod,
  });

  const userBefore = await fetchUserById(currentOrder.user_id, true);
  const pointsBefore = userBefore?.loyalty_points || 0;

  pendingPointsEarned = await processPendingTransactionsForOrder(Number(id), currentOrder.user_id);

  const userAfter = await fetchUserById(currentOrder.user_id, true);
  const pointsAfter = userAfter?.loyalty_points || 0;

  // üîç DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç
  console.log('[DEBUG SCENARIO 1.8] –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ pending', {
    scenario: 'earned_payment_method_change',
    pendingPointsEarned,
    pointsBefore,
    pointsAfter,
    pointsChange: pointsAfter - pointsBefore,
  });

  // üîç DEBUG: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  if (typeof window !== 'undefined' && (window as any).__debugRecorder) {
    await checkPaymentMethodChange((window as any).__debugRecorder, {
      orderId: Number(id),
      userId: currentOrder.user_id,
      oldPaymentMethod,
      newPaymentMethod: order.paymentMethod,
      pendingPointsEarned,
      actualPointsEarned: pointsAfter - pointsBefore,
    });
  }
}
```

### 3.2. –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ (USED)

#### 3.2.1. –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (POST)

**–§–∞–π–ª:** `app/api/orders/route.ts` (—Å—Ç—Ä–æ–∫–∏ 615-639)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 617
if (pointsUsed > 0) {
  // üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 2.2
  console.log('[DEBUG SCENARIO 2.2] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (POST)', {
    scenario: 'used_post',
    userId,
    orderId: nocoOrder.Id,
    pointsUsed,
  });

  const userBefore = await fetchUserById(userId, true);
  const pointsBefore = userBefore?.loyalty_points || 0;
  const totalSpentBefore = userBefore?.total_spent || 0;

  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ...

  const userAfter = await fetchUserById(userId, true);
  const pointsAfter = userAfter?.loyalty_points || 0;
  const totalSpentAfter = userAfter?.total_spent || 0;

  // üîç DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç
  console.log('[DEBUG SCENARIO 2.2] –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ø–∏—Å–∞–Ω–∏—è', {
    scenario: 'used_post',
    pointsBefore,
    pointsAfter,
    pointsChange: pointsAfter - pointsBefore,
    expectedChange: -pointsUsed,
    totalSpentBefore,
    totalSpentAfter,
  });
}
```

#### 3.2.2. –°—Ü–µ–Ω–∞—Ä–∏–π 5: –í–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (DELETE)

**–§–∞–π–ª:** `app/api/orders/[id]/route.ts` (—Å—Ç—Ä–æ–∫–∏ 1500-1600)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º refundLoyaltyPoints
// üîç DEBUG: –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è 2.6
console.log('[DEBUG SCENARIO 2.6] –í–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (DELETE)', {
  scenario: 'refund_delete',
  orderId: id,
  userId: currentOrder.user_id,
  finalPointsEarned,
  finalPointsUsed,
  orderTotal,
});

const userBefore = await fetchUserById(currentOrder.user_id, true);
const pointsBefore = userBefore?.loyalty_points || 0;
const totalSpentBefore = userBefore?.total_spent || 0;

await refundLoyaltyPoints(currentOrder.user_id, finalPointsEarned, finalPointsUsed, orderTotal, Number(id));

const userAfter = await fetchUserById(currentOrder.user_id, true);
const pointsAfter = userAfter?.loyalty_points || 0;
const totalSpentAfter = userAfter?.total_spent || 0;

// üîç DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç
console.log('[DEBUG SCENARIO 2.6] –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞', {
  scenario: 'refund_delete',
  pointsBefore,
  pointsAfter,
  pointsChange: pointsAfter - pointsBefore,
  expectedChange: finalPointsUsed - finalPointsEarned,
  totalSpentBefore,
  totalSpentAfter,
  totalSpentChange: totalSpentAfter - totalSpentBefore,
  expectedTotalSpentChange: -orderTotal + finalPointsUsed,
});

// üîç DEBUG: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
if (typeof window !== 'undefined' && (window as any).__debugRecorder) {
  await checkLoyaltyPointsRefund((window as any).__debugRecorder, {
    orderId: Number(id),
    userId: currentOrder.user_id,
    pointsEarned: finalPointsEarned,
    pointsUsed: finalPointsUsed,
    oldPoints: pointsBefore,
    newPoints: pointsAfter,
    oldTotalSpent: totalSpentBefore,
    newTotalSpent: totalSpentAfter,
    orderTotal,
  });
}
```

### 3.3. –†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏

#### 3.3.1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –≤ OrderModal

**–§–∞–π–ª:** `components/order-modal.tsx` (—Ñ—É–Ω–∫—Ü–∏—è `handleApplyPromo`)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–∏–¥–∫–∏
// üîç DEBUG: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
console.log('[DEBUG PROMO] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞', {
  scenario: 'promo_apply',
  promoCode: code,
  orderTotal: totalBeforeDiscount,
  discount: calculatedDiscount,
  minOrderAmount: promo.min_order_amount,
  maxDiscount: promo.max_discount,
  usageType: promo.usage_type,
  timesUsed: promo.times_used,
  userId: userProfile?.id,
});

// üîç DEBUG: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
if (typeof window !== 'undefined' && (window as any).__debugRecorder) {
  await checkPromoCode((window as any).__debugRecorder, {
    promoCode: code,
    orderTotal: totalBeforeDiscount,
    minOrderAmount: promo.min_order_amount,
    discount: calculatedDiscount,
    maxDiscount: promo.max_discount,
    usageType: promo.usage_type,
    timesUsed: promo.times_used,
    userId: userProfile?.id || 0,
  });
}
```

---

## 4. –¢–ï–ì–ò –ò –§–ò–õ–¨–¢–†–´ –î–õ–Ø –ì–†–£–ü–ü–ò–†–û–í–ö–ò

### 4.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–≥–æ–≤

**–§–æ—Ä–º–∞—Ç:** `[DEBUG SCENARIO X.Y]` –∏–ª–∏ `[DEBUG PROMO]`

**–¢–µ–≥–∏ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
- `earned_online_post` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.2
- `earned_online_patch_full` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.3
- `earned_online_patch_partial` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.4
- `earned_cash_pending_post` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.5
- `earned_cash_pending_patch` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.6
- `earned_cron_process` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.7
- `earned_payment_method_change` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.8
- `earned_undefined` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 1.9
- `used_post` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.2
- `used_patch_partial` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.3
- `used_patch_full` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.4
- `refund_patch` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.5
- `refund_delete` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.6
- `refund_pending_cancel` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.7
- `refund_paid_delete` ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π 2.8
- `promo_apply` ‚Äî –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `promo_increment` ‚Äî –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞

### 4.2. –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

**–î–æ–±–∞–≤–∏—Ç—å –≤ `hooks/useDebugRecorder.tsx`:**

```typescript
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é
export function filterLogsByScenario(logs: LogEntry[], scenario: string): LogEntry[] {
  return logs.filter(log => 
    log.message.includes(`[DEBUG SCENARIO ${scenario}]`) ||
    log.message.includes(`scenario: '${scenario}'`)
  );
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –ø–æ —Ç–∏–ø—É —Å—Ü–µ–Ω–∞—Ä–∏—è
export function filterLogsByType(logs: LogEntry[], type: 'earned' | 'used' | 'refund' | 'promo'): LogEntry[] {
  return logs.filter(log => {
    const message = log.message.toLowerCase();
    if (type === 'earned') return message.includes('earned');
    if (type === 'used') return message.includes('used') && !message.includes('refund');
    if (type === 'refund') return message.includes('refund');
    if (type === 'promo') return message.includes('promo');
    return false;
  });
}
```

---

## 5. –ù–ê–°–¢–†–û–ô–ö–ê –î–ï–ë–ê–ì–ì–ï–†–ê –î–õ–Ø –ö–û–ù–ö–†–ï–¢–ù–´–• –°–¶–ï–ù–ê–†–ò–ï–í

### 5.1. –í–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

**–í `components/debug/DebugConsole.tsx` –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã:**

```typescript
const [filterScenario, setFilterScenario] = useState<string>('all');
const [filterType, setFilterType] = useState<'all' | 'earned' | 'used' | 'refund' | 'promo'>('all');

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤
const filteredLogs = useMemo(() => {
  let result = logs;
  
  if (filterType !== 'all') {
    result = filterLogsByType(result, filterType);
  }
  
  if (filterScenario !== 'all') {
    result = filterLogsByScenario(result, filterScenario);
  }
  
  return result;
}, [logs, filterScenario, filterType]);
```

### 5.2. UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è

**–î–æ–±–∞–≤–∏—Ç—å –≤ `DebugConsole`:**

```tsx
<div className="flex gap-2 mb-4">
  <select 
    value={filterType} 
    onChange={(e) => setFilterType(e.target.value as any)}
    className="px-3 py-1 border rounded"
  >
    <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
    <option value="earned">–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ (earned)</option>
    <option value="used">–°–ø–∏—Å–∞–Ω–∏–µ (used)</option>
    <option value="refund">–í–æ–∑–≤—Ä–∞—Ç (refund)</option>
    <option value="promo">–ü—Ä–æ–º–æ–∫–æ–¥—ã (promo)</option>
  </select>
  
  <select 
    value={filterScenario} 
    onChange={(e) => setFilterScenario(e.target.value)}
    className="px-3 py-1 border rounded"
  >
    <option value="all">–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</option>
    <option value="1.2">1.2: –û–Ω–ª–∞–π–Ω POST</option>
    <option value="1.3">1.3: –û–Ω–ª–∞–π–Ω PATCH full</option>
    <option value="1.5">1.5: Cash POST</option>
    <option value="1.8">1.8: –°–º–µ–Ω–∞ –æ–ø–ª–∞—Ç—ã</option>
    <option value="2.2">2.2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ POST</option>
    <option value="2.6">2.6: –í–æ–∑–≤—Ä–∞—Ç DELETE</option>
  </select>
</div>
```

---

## 6. –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

### 6.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

**–®–∞–≥ 1:** –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Debug Console
- –û—Ç–∫—Ä—ã—Ç—å Debug Console (–∫–Ω–æ–ø–∫–∞ üêû –∏–ª–∏ `Ctrl+Shift+D`)
- –í–∫–ª—é—á–∏—Ç—å "–ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞"

**–®–∞–≥ 2:** –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π
- –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–æ–π
- –í—Å–µ –ª–æ–≥–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å–∞–Ω—ã

**–®–∞–≥ 3:** –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
- –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Å—Ü–µ–Ω–∞—Ä–∏—è (earned/used/refund/promo)
- –í—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–ø–∏—Å–∫–∞

**–®–∞–≥ 4:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
- –ù–∞–∂–∞—Ç—å `Ctrl+Enter` –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç"
- –í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∑–∞—Ç—å: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.2"

### 6.2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ü—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–∞–ª–ª–æ–≤
- –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤
- –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –±–∞–ª–ª–æ–≤
- –ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç—á–µ—Ç
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `debug_reports/`

### 6.3. –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–∞:**
```
debug_reports/
  ‚îú‚îÄ‚îÄ 2026-01-15T10-30-00_user-123_logs.txt
  ‚îî‚îÄ‚îÄ index.json
```

**–í –ª–æ–≥–∞—Ö –∏—â–∏—Ç–µ:**
- `[DEBUG SCENARIO X.Y]` ‚Äî –Ω–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
- `–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- `‚úÖ` –∏–ª–∏ `‚ö†Ô∏è` ‚Äî —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞:**
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –ª–æ–≥–∏ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é 1.2
grep "SCENARIO 1.2" debug_reports/*.txt

# –ù–∞–π—Ç–∏ –≤—Å–µ –æ—à–∏–±–∫–∏
grep "‚ö†Ô∏è\|üö®" debug_reports/*.txt

# –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å total_spent
grep "total_spent" debug_reports/*.txt
```

---

## 7. –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `lib/debug-auto-checks.ts`
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é

### –≠—Ç–∞–ø 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `app/api/orders/route.ts` (POST)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `app/api/orders/[id]/route.ts` (PATCH, DELETE)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `components/order-modal.tsx` (–ø—Ä–æ–º–æ–∫–æ–¥—ã)
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `app/api/cron/process-pending-points/route.ts`

### –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ `useDebugRecorder`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å UI —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `DebugConsole`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ª–æ–≥–æ–≤
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç—á–µ—Ç–æ–≤

---

## 8. –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü—Ä–∏–º–µ—Ä 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è 1.2

```
1. –û—Ç–∫—Ä—ã—Ç—å Debug Console
2. –í–∫–ª—é—á–∏—Ç—å "–ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞"
3. –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä "earned" ‚Üí "1.2"
4. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–æ–π
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - [DEBUG SCENARIO 1.2] –ù–∞—á–∞–ª–æ
   - [DEBUG SCENARIO 1.2] –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
   - ‚úÖ Loyalty points check completed
6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º "–¢–µ—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è 1.2"
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º—ã —Å total_spent

```
1. –û—Ç–∫—Ä—ã—Ç—å Debug Console
2. –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä "refund"
3. –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - [DEBUG SCENARIO 2.6] –í–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤
   - üö® total_spent –ù–ï –æ—Ç–∫–∞—Ç–∏–ª—Å—è (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –µ—Å—Ç—å)
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `debug-auto-checks.ts`
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ Debug Console
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
