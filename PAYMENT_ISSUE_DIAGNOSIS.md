# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–ø–ª–∞—Ç–æ–π

**–î–∞—Ç–∞:** $(date)  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–û–ø–ª–∞—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∏

### 1. –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥

**–§–∞–π–ª:** `app/api/payments/yookassa/create/route.ts`
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç `useWidget` –ø–∞—Ä–∞–º–µ—Ç—Ä
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `embedded` –∏ `redirect` —Ç–∏–ø—ã confirmation
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `confirmationToken` –∏ `confirmationUrl`

**–§–∞–π–ª:** `components/payment-modal.tsx`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `detectPlatform()` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ (–Ω–µ –í–ö/–¢–ì)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∏–¥–∂–µ—Ç —Å `confirmationToken`
- ‚úÖ –ò–º–µ–µ—Ç fallback –Ω–∞ redirect –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 2. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–¥ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–∏–ª—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç `useWidget` –≤ –∫–æ–¥–µ
- –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–∞—Ä—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
./deploy-increment-fix.expect
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500
- –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –æ—à–∏–±–∫–∏ YooKassa SDK

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ssh root@5.129.194.168
pm2 logs ogfoody --err --lines 100 | grep -i payment
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:**
- `confirmationToken` –Ω–µ –ø–æ–ª—É—á–µ–Ω
- –°–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ `YooMoneyCheckoutWidget is not defined`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ JavaScript
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ —Å–∫—Ä–∏–ø—Ç `checkout-widget.js`

#### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í–∏–¥–∂–µ—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –í–ö/–¢–ì
- –ò–ª–∏ redirect –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É `detectPlatform()`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `shouldUseRedirect` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

---

## üöÄ –î–µ–π—Å—Ç–≤–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
2. ‚úÖ –ó–∞–ø—É—â–µ–Ω –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ `deploy-increment-fix.expect`
3. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `quick-check-and-deploy.sh`

### –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚è≥ –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è (—á–µ—Ä–µ–∑ 3-5 –º–∏–Ω—É—Ç)
2. ‚è≥ –õ–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. ‚è≥ –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. ‚è≥ –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@5.129.194.168
cd /var/www/ogfoody
git log --oneline -1
pm2 status
pm2 logs ogfoody --err --lines 50 | grep -i payment
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@5.129.194.168
cd /var/www/ogfoody
grep -n "useWidget" app/api/payments/yookassa/create/route.ts
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –¥–µ–ø–ª–æ—è:
```bash
tail -100 /tmp/deploy-now.log
```

---

## üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—Ä—É—á–Ω—É—é
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–ø–ª–∞—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –≤ DevTools (–∑–∞–ø—Ä–æ—Å—ã –∫ `/api/payments/yookassa/create`)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (YOOKASSA_SHOP_ID, YOOKASSA_SECRET_KEY)

---

**–î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3-5 –º–∏–Ω—É—Ç.**
