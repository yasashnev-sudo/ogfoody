# üß™ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `Fraud_Alerts` —Å–æ–∑–¥–∞–Ω–∞ –≤ NocoDB (ID: mr9txejs65nk1yi)
2. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `Loyalty_Points_Transactions` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø–æ–ª—è–º–∏ `transaction_status` –∏ `processed_at`
3. ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `NOCODB_TABLE_FRAUD_ALERTS` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `.idx/dev.nix`

## üîÑ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!** –ò–Ω–∞—á–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è.

```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä:
Ctrl+C  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
npm run dev  # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö URL (–¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫):
- http://localhost:3000/api/menu
- http://localhost:3000/api/db/Fraud_Alerts/records?limit=1

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (–¥–∞–∂–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤) - –æ—Ç–ª–∏—á–Ω–æ!

### –®–∞–≥ 3: –¢–µ—Å—Ç 1 - –ó–∞–∫–∞–∑ –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∞–π—Ç–∞
2. –í—ã–±–µ—Ä–∏—Ç–µ **–æ–ø–ª–∞—Ç—É –Ω–∞–ª–∏—á–Ω—ã–º–∏**
3. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
   - –ë–∞–ª–ª—ã –ù–ï –Ω–∞—á–∏—Å–ª–µ–Ω—ã —Å—Ä–∞–∑—É
   - –í –æ—Ç–≤–µ—Ç–µ API –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: *"–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –±–∞–ª–ª—ã (X) –±—É–¥—É—Ç –Ω–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏"*

### –®–∞–≥ 4: –¢–µ—Å—Ç 2 - –ó–∞–∫–∞–∑ –æ–Ω–ª–∞–π–Ω

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –í—ã–±–µ—Ä–∏—Ç–µ **–æ–ø–ª–∞—Ç—É –∫–∞—Ä—Ç–æ–π/–°–ë–ü**
3. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
   - –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã –°–†–ê–ó–£
   - –í –æ—Ç–≤–µ—Ç–µ API: *"–ù–∞—á–∏—Å–ª–µ–Ω–æ X –±–∞–ª–ª–æ–≤"*

### –®–∞–≥ 5: –¢–µ—Å—Ç 3 - –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ (—à–∞–≥ 3)
2. –í –º–µ–Ω—é –∑–∞–∫–∞–∑–æ–≤ –æ–ø–ª–∞—Ç–∏—Ç–µ –µ–≥–æ –æ–Ω–ª–∞–π–Ω (—Å–º–µ–Ω–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã)
3. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - Pending –±–∞–ª–ª—ã —Å—Ä–∞–∑—É –Ω–∞—á–∏—Å–ª–µ–Ω—ã
   - –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—ë–Ω

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ Cron Job

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:3000/api/cron/process-pending-points
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- JSON –æ—Ç–≤–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

### –®–∞–≥ 7: –¢–µ—Å—Ç Fraud Detection

1. –°–æ–∑–¥–∞–π—Ç–µ 3 –∑–∞–∫–∞–∑–∞ —Å –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–æ–π
2. –û—Ç–º–µ–Ω–∏—Ç–µ –≤—Å–µ 3 –∑–∞–∫–∞–∑–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ NocoDB —Ç–∞–±–ª–∏—Ü—É `Fraud_Alerts`
4. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - –ü–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –£–∫–∞–∑–∞–Ω–æ: 3 –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞
   - –°—Ç–∞—Ç—É—Å: "active"

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ NocoDB

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Fraud_Alerts:
https://noco.povarnakolesah.ru/nc/p9id5v4q0ukk9iz/Fraud_Alerts

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Loyalty_Points_Transactions:
https://noco.povarnakolesah.ru/nc/p9id5v4q0ukk9iz/Loyalty_Points_Transactions

–ò—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å:
- `transaction_status = "pending"` - –æ–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `transaction_status = "completed"` - –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- `processed_at` - –¥–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "TABLE_NOT_FOUND:Orders"
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C, –∑–∞—Ç–µ–º npm run dev)

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ userId –ø–µ—Ä–µ–¥–∞–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É Loyalty_Points_Transactions –≤ NocoDB

### –ü—Ä–æ–±–ª–µ–º–∞: Fraud_Alerts –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–∫–∞–∑—ã –±—ã–ª–∏ –û–ü–õ–ê–ß–ï–ù–´ (paid=true)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–º–µ–Ω–µ–Ω–æ –∏–º–µ–Ω–Ω–æ 3+ –∑–∞–∫–∞–∑–∞
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ –ù–∞–ª–∏—á–Ω—ã–µ ‚Üí pending –±–∞–ª–ª—ã + –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –û–Ω–ª–∞–π–Ω ‚Üí –±–∞–ª–ª—ã —Å—Ä–∞–∑—É + —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–∞—á–∏—Å–ª–µ–Ω–æ X"
- ‚úÖ –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –æ–Ω–ª–∞–π–Ω ‚Üí –±–∞–ª–ª—ã —Å—Ä–∞–∑—É
- ‚úÖ Cron job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ 3 –æ—Ç–º–µ–Ω—ã ‚Üí –∑–∞–ø–∏—Å—å –≤ Fraud_Alerts

## üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
node test-loyalty-system.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.




