{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sergejasasnev/Downloads/my-project%20%281%29/lib/nocodb.ts"],"sourcesContent":["// NocoDB API client - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API proxy\n// –¢–æ–∫–µ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL –¥–ª—è API proxy\n// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL, –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π\nconst getApiBaseUrl = () => {\n  if (typeof window !== \"undefined\") {\n    return \"/api/db\"\n  }\n  return null\n}\n\nfunction getNocoDBUrl(): string {\n  return process.env.NOCODB_URL || \"\"\n}\n\nfunction getNocoDBToken(): string {\n  return process.env.NOCODB_TOKEN || \"\"\n}\n\nfunction getTableId(tableName: string): string {\n  const tableIds: Record<string, string | undefined> = {\n    Meals: process.env.NOCODB_TABLE_MEALS,\n    Extras: process.env.NOCODB_TABLE_EXTRAS,\n    Delivery_Zones: process.env.NOCODB_TABLE_DELIVERY_ZONES,\n    Users: process.env.NOCODB_TABLE_USERS,\n    Orders: process.env.NOCODB_TABLE_ORDERS,\n    Order_Persons: process.env.NOCODB_TABLE_ORDER_PERSONS,\n    Order_Meals: process.env.NOCODB_TABLE_ORDER_MEALS,\n    Order_Extras: process.env.NOCODB_TABLE_ORDER_EXTRAS,\n    Promo_Codes: process.env.NOCODB_TABLE_PROMO_CODES,\n    Reviews: process.env.NOCODB_TABLE_REVIEWS,\n    Loyalty_Points_Transactions: process.env.NOCODB_TABLE_LOYALTY_POINTS_TRANSACTIONS,\n    Fraud_Alerts: process.env.NOCODB_TABLE_FRAUD_ALERTS || \"mr9txejs65nk1yi\", // –§–æ–ª–±—ç–∫ –¥–ª—è Fraud_Alerts\n  }\n\n  return tableIds[tableName] || \"\"\n}\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏\nfunction validateNocoDBConfig(): { isValid: boolean; error?: string } {\n  const url = getNocoDBUrl()\n  const token = getNocoDBToken()\n  const mealsTable = process.env.NOCODB_TABLE_MEALS\n\n  if (!url || !token) {\n    return { isValid: false, error: \"NOCODB_URL or NOCODB_TOKEN not set\" }\n  }\n  if (!mealsTable) {\n    return { isValid: false, error: \"NOCODB_TABLE_MEALS not set\" }\n  }\n  return { isValid: true }\n}\n\nexport function isNocoDBConfigured(): boolean {\n  return validateNocoDBConfig().isValid\n}\n\n// –¢–∏–ø—ã –¥–ª—è NocoDB –æ—Ç–≤–µ—Ç–æ–≤\ninterface NocoDBResponse<T> {\n  list: T[]\n  pageInfo?: {\n    totalRows: number\n    page: number\n    pageSize: number\n    isFirstPage: boolean\n    isLastPage: boolean\n  }\n}\n\nfunction buildNocoDBUrl(tableName: string, params: Record<string, string> = {}): string {\n  const queryString = new URLSearchParams(params).toString()\n  let baseUrl = getNocoDBUrl().replace(/\\/$/, \"\")\n\n  if (!baseUrl.endsWith(\"/api/v2\")) {\n    baseUrl = `${baseUrl}/api/v2`\n  }\n\n  const tableId = getTableId(tableName)\n\n  if (!tableId) {\n    throw new Error(`TABLE_NOT_CONFIGURED:${tableName}`)\n  }\n\n  return `${baseUrl}/tables/${tableId}/records${queryString ? `?${queryString}` : \"\"}`\n}\n\n// –°–µ—Ä–≤–µ—Ä–Ω—ã–π fetch –Ω–∞–ø—Ä—è–º—É—é –∫ NocoDB (–¥–ª—è ISR)\nasync function serverFetch<T>(tableName: string, params: Record<string, string> = {}): Promise<T> {\n  const config = validateNocoDBConfig()\n  if (!config.isValid) {\n    throw new Error(`NocoDB is not configured: ${config.error}`)\n  }\n\n  const url = buildNocoDBUrl(tableName, params)\n  const token = getNocoDBToken()\n\n  console.log(`üåê serverFetch: ${tableName}`, { url })\n\n  const response = await fetch(url, {\n    headers: {\n      \"xc-token\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    // –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 1 –º–∏–Ω—É—Ç—É –¥–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\n    next: { revalidate: 60 },\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    console.error(`‚ùå serverFetch error for ${tableName}:`, {\n      status: response.status,\n      url,\n      response: text.substring(0, 500),\n    })\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`NocoDB API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch {\n    throw new Error(`NocoDB returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// –í–µ—Ä—Å–∏—è serverFetch –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)\nasync function serverFetchNoCache<T>(tableName: string, params: Record<string, string> = {}): Promise<T> {\n  const config = validateNocoDBConfig()\n  if (!config.isValid) {\n    throw new Error(`NocoDB is not configured: ${config.error}`)\n  }\n\n  const url = buildNocoDBUrl(tableName, params)\n  const token = getNocoDBToken()\n\n  const response = await fetch(url, {\n    headers: {\n      \"xc-token\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    // –û—Ç–∫–ª—é—á–∞–µ–º –∫—ç—à –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n    cache: 'no-store',\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`NocoDB API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch {\n    throw new Error(`NocoDB returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –Ω–∞–ø—Ä—è–º—É—é –∫ NocoDB\nasync function serverCreateRecord<T>(\n  tableName: string,\n  data: any,\n  method: \"POST\" | \"PATCH\" = \"POST\",\n  recordId?: number,\n): Promise<T> {\n  const config = validateNocoDBConfig()\n  if (!config.isValid) {\n    throw new Error(`NocoDB is not configured: ${config.error}`)\n  }\n\n  let baseUrl = getNocoDBUrl().replace(/\\/$/, \"\")\n  if (!baseUrl.endsWith(\"/api/v2\")) {\n    baseUrl = `${baseUrl}/api/v2`\n  }\n\n  const tableId = getTableId(tableName)\n  if (!tableId) {\n    throw new Error(`TABLE_NOT_CONFIGURED:${tableName}`)\n  }\n\n  // NocoDB API v2 –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç bulk update —á–µ—Ä–µ–∑ PATCH –∫ /tables/{tableId}/records\n  // —Å –º–∞—Å—Å–∏–≤–æ–º –∑–∞–ø–∏—Å–µ–π, –≥–¥–µ –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç Id –∏ –æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ –ø–æ–ª—è\n  let url: string\n  let actualMethod = method\n  let bodyData: any = data\n  \n  if (method === \"PATCH\" && recordId) {\n    // –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º bulk update —Ñ–æ—Ä–º–∞—Ç\n    url = `${baseUrl}/tables/${tableId}/records`\n    bodyData = [{ Id: recordId, ...data }]\n  } else if (method === \"PUT\" && recordId) {\n    // PUT —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º bulk update\n    url = `${baseUrl}/tables/${tableId}/records`\n    bodyData = [{ Id: recordId, ...data }]\n    actualMethod = \"PATCH\" // NocoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PATCH –¥–ª—è bulk update\n  } else {\n    url = `${baseUrl}/tables/${tableId}/records`\n  }\n\n  const token = getNocoDBToken()\n\n  const response = await fetch(url, {\n    method: actualMethod,\n    headers: {\n      \"xc-token\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(bodyData),\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    console.error(`‚ùå NocoDB ${method} error for ${tableName}:`, {\n      status: response.status,\n      statusText: response.statusText,\n      url,\n      data,\n      response: text.substring(0, 500),\n    })\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`NocoDB API error: ${response.status} - ${text.substring(0, 200)}`)\n  }\n\n  try {\n    const result = JSON.parse(text)\n    // NocoDB –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö\n    if (Array.isArray(result)) {\n      // –î–ª—è bulk update –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è —Ç–æ–ª—å–∫–æ Id, —Ç–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—É—é –∑–∞–ø–∏—Å—å\n      if (result.length > 0 && Object.keys(result[0]).length === 1 && 'Id' in result[0] && recordId) {\n        console.log(`‚ö†Ô∏è Bulk update returned only Id, fetching full record ${recordId}...`)\n        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n        await new Promise(resolve => setTimeout(resolve, 500))\n        // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ë–ï–ó –∫—ç—à–∞\n        const fetchedResponse: any = await serverFetchNoCache<any>(tableName, { where: `(Id,eq,${recordId})` })\n        const fetchedList = fetchedResponse?.list || []\n        if (fetchedList.length > 0) {\n          console.log(`‚úÖ Fetched full record after update:`, {\n            Id: fetchedList[0].Id,\n            loyalty_points_earned: fetchedList[0].loyalty_points_earned,\n            'Loyalty Points Earned': fetchedList[0]['Loyalty Points Earned'],\n          })\n          return fetchedList[0] as T\n        } else {\n          console.warn(`‚ö†Ô∏è Failed to fetch full record ${recordId}, returning bulk update result`)\n        }\n      }\n      return result[0] as T\n    }\n    if (result && typeof result === 'object' && 'Id' in result) {\n      return result as T\n    }\n    if (result && typeof result === 'object' && 'record' in result) {\n      return result.record as T\n    }\n    return result as T\n  } catch {\n    throw new Error(`NocoDB returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π fetch —á–µ—Ä–µ–∑ API proxy\nasync function clientFetch<T>(\n  tableName: string,\n  params: Record<string, string> = {},\n  options: RequestInit = {},\n): Promise<T> {\n  const queryString = new URLSearchParams(params).toString()\n  const url = `/api/db/${tableName}/records${queryString ? `?${queryString}` : \"\"}`\n\n  const response = await fetch(url, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...options.headers,\n    },\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch {\n    throw new Error(`API returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fetch\nexport async function nocoFetch<T>(\n  tableName: string,\n  params: Record<string, string> = {},\n  options: RequestInit = {},\n): Promise<T> {\n  const apiBaseUrl = getApiBaseUrl()\n\n  if (apiBaseUrl === null) {\n    return serverFetch<T>(tableName, params)\n  } else {\n    return clientFetch<T>(tableName, params, options)\n  }\n}\n\n// –í–µ—Ä—Å–∏—è nocoFetch –±–µ–∑ –∫—ç—à–∞ (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)\nexport async function nocoFetchNoCache<T>(\n  tableName: string,\n  params: Record<string, string> = {},\n  options: RequestInit = {},\n): Promise<T> {\n  const apiBaseUrl = getApiBaseUrl()\n\n  if (apiBaseUrl === null) {\n    return serverFetchNoCache<T>(tableName, params)\n  } else {\n    return clientFetch<T>(tableName, params, { ...options, cache: 'no-store' })\n  }\n}\n\n// === MEALS ===\n\nexport interface NocoDBMeal {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  name?: string\n  Name?: string\n  category?: string\n  Category?: string\n  ingredients?: string\n  Ingredients?: string\n  description?: string\n  Description?: string\n  price?: number | string\n  Price?: number | string\n  price_single?: number | string\n  \"Price (Single)\"?: number | string\n  price_medium?: number | string\n  \"Price (Medium)\"?: number | string\n  price_large?: number | string\n  \"Price (Large)\"?: number | string\n  weight?: number | string\n  Weight?: number | string\n  weight_single?: number | string\n  \"Weight (Single)\"?: number | string\n  weight_medium?: number | string\n  \"Weight (Medium)\"?: number | string\n  weight_large?: number | string\n  \"Weight (Large)\"?: number | string\n  image?: string\n  \"Image (URL)\"?: string\n  needs_garnish?: boolean | string\n  \"Needs Garnish\"?: boolean | string\n  calories?: number | string\n  Calories?: number | string\n  protein?: number | string\n  Protein?: number | string\n  fats?: number | string\n  Fats?: number | string\n  carbs?: number | string\n  Carbs?: number | string\n  is_current_week?: boolean | string\n  \"Current Week\"?: boolean | string\n  is_next_week?: boolean | string\n  \"Next Week\"?: boolean | string\n}\n\nexport async function fetchMeals(weekFilter?: \"current\" | \"next\"): Promise<NocoDBMeal[]> {\n  try {\n    const params: Record<string, string> = {\n      limit: \"1000\",\n    }\n\n    const response = await nocoFetch<NocoDBResponse<NocoDBMeal>>(\"Meals\", params)\n    console.log(\n      `[v0] fetchMeals: got ${response.list?.length || 0} meals, first item:`,\n      JSON.stringify(response.list?.[0] || {}).substring(0, 200),\n    )\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Meals not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === EXTRAS ===\n\nexport interface NocoDBExtra {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  name?: string\n  Name?: string\n  category?: string\n  Category?: string\n  ingredients?: string\n  Ingredients?: string\n  description?: string\n  Description?: string\n  price?: number | string\n  Price?: number | string\n  image?: string\n  \"Image (URL)\"?: string\n  is_current_week?: boolean | string\n  \"Current Week\"?: boolean | string\n  is_next_week?: boolean | string\n  \"Next Week\"?: boolean | string\n  calories?: number | string\n  Calories?: number | string\n  protein?: number | string\n  Protein?: number | string\n  fats?: number | string\n  Fats?: number | string\n  carbs?: number | string\n  Carbs?: number | string\n  weight?: number | string\n  Weight?: number | string\n}\n\nexport async function fetchExtras(): Promise<NocoDBExtra[]> {\n  try {\n    const response = await nocoFetch<NocoDBResponse<NocoDBExtra>>(\"Extras\", {\n      limit: \"1000\",\n    })\n    console.log(\n      `[v0] fetchExtras: got ${response.list?.length || 0} extras, first item:`,\n      JSON.stringify(response.list?.[0] || {}).substring(0, 200),\n    )\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Extras not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === DELIVERY ZONES ===\n\nexport interface NocoDBDeliveryZone {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: API /api/menu –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ camelCase\n  city?: string\n  City?: string\n  district?: string\n  District?: string\n  delivery_fee?: number | string\n  \"Delivery Fee\"?: number | string\n  deliveryFee?: number | string  // ‚úÖ –ù–û–í–û–ï: –∏–∑ /api/menu\n  min_order_amount?: number | string\n  \"Min Order Amount\"?: number | string\n  is_available?: boolean | string\n  Available?: boolean | string\n  available_intervals?: string\n  \"Available Intervals\"?: string | string[]\n}\n\nexport async function fetchDeliveryZones(): Promise<NocoDBDeliveryZone[]> {\n  try {\n    const response = await nocoFetch<NocoDBResponse<NocoDBDeliveryZone>>(\"Delivery_Zones\", {\n      // where: \"(is_available,eq,true)\",\n    })\n    console.log(`[v0] fetchDeliveryZones: got ${response.list?.length || 0} zones, first item:`, response.list?.[0])\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Delivery_Zones not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === USERS ===\n\nexport interface NocoDBUser {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  phone?: string\n  Phone?: string\n  password_hash?: string\n  \"Password Hash\"?: string\n  name?: string\n  Name?: string\n  additional_phone?: string\n  \"Additional Phone\"?: string\n  street?: string\n  Street?: string\n  building?: string\n  Building?: string\n  building_section?: string\n  \"Building Section\"?: string\n  apartment?: string\n  Apartment?: string\n  entrance?: string\n  Entrance?: string\n  floor?: string\n  Floor?: string\n  intercom?: string\n  Intercom?: string\n  district?: string\n  District?: string\n  delivery_comment?: string\n  \"Delivery Comment\"?: string\n  loyalty_points?: number | string\n  \"Loyalty Points\"?: number | string\n  total_spent?: number | string\n  \"Total Spent\"?: number | string\n  created_at?: string\n  \"Created At\"?: string\n  updated_at?: string\n  \"Updated At\"?: string\n  user_id?: number\n  \"User ID\"?: number\n}\n\nexport async function fetchUserByPhone(phone: string): Promise<NocoDBUser | null> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ (titles) –≤ where-—É—Å–ª–æ–≤–∏—è—Ö, –∞ –Ω–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n  // –í —Ç–∞–±–ª–∏—Ü–µ Users –∫–æ–ª–æ–Ω–∫–∞ phone –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"Phone\"\n  console.log(`üîç fetchUserByPhone: –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º=${phone}`)\n  const response = await nocoFetch<NocoDBResponse<any>>(\"Users\", {\n    where: `(Phone,eq,${phone})`,\n  })\n  const rawUser = response.list?.[0]\n  if (!rawUser) {\n    console.warn(`‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º=${phone} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`)\n    return null\n  }\n  console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É:`, {\n    rawKeys: Object.keys(rawUser),\n    hasId: 'Id' in rawUser,\n    hasid: 'id' in rawUser,\n    hasUserId: 'User ID' in rawUser,\n    Id: rawUser.Id,\n    id: rawUser.id,\n    userId: rawUser['User ID'] || rawUser.user_id,\n    phone: rawUser.phone || rawUser[\"Phone\"],\n  })\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ API (—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫) –≤ —Ñ–æ—Ä–º–∞—Ç NocoDBUser\n  // –í–ê–ñ–ù–û: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º Id —è–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –≤ NocoDB –º–æ–∂–µ—Ç –±—ã—Ç—å Id, id, –∏–ª–∏ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n  const internalId = rawUser.Id !== undefined \n    ? rawUser.Id \n    : (rawUser.id !== undefined ? rawUser.id : (rawUser[\"Id\"] !== undefined ? rawUser[\"Id\"] : undefined))\n  \n  if (internalId === undefined) {\n    console.error(\"‚ùå –ü–æ–ª–µ Id –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –æ—Ç–≤–µ—Ç–µ API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\", rawUser)\n    console.error(\"–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è:\", Object.keys(rawUser))\n  }\n  \n  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º User ID (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ —á–∏—Å–ª–æ–º)\n  const userIdValue = rawUser.user_id !== undefined \n    ? rawUser.user_id \n    : (rawUser[\"User ID\"] !== undefined \n      ? (typeof rawUser[\"User ID\"] === \"string\" ? parseInt(rawUser[\"User ID\"]) || undefined : rawUser[\"User ID\"])\n      : undefined)\n  \n  // –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º User ID –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, fallback –Ω–∞ internalId –µ—Å–ª–∏ User ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ò–õ–ò null\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ userIdValue –Ω–µ null –∏ –Ω–µ undefined\n  const finalUserId = (userIdValue !== undefined && userIdValue !== null) ? userIdValue : internalId\n  \n  console.log(`üìù –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã ID:`)\n  console.log(`  internalId = ${internalId} (${typeof internalId})`)\n  console.log(`  userIdValue = ${userIdValue} (${typeof userIdValue})`)\n  console.log(`  finalUserId = ${finalUserId} (${typeof finalUserId})`)\n  \n  const userId = finalUserId !== undefined ? (typeof finalUserId === 'number' ? finalUserId : parseInt(String(finalUserId))) : 0\n  \n  console.log(`üî¢ userId = ${userId} (${typeof userId}), isNaN = ${isNaN(userId)}`)\n  \n  // ‚úÖ –í–´–ß–ò–°–õ–Ø–ï–ú –±–∞–ª–∞–Ω—Å –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã!)\n  // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ userId –≤–∞–ª–∏–¥–µ–Ω (–Ω–µ 0, –Ω–µ NaN)\n  const calculatedBalance = (userId && !isNaN(userId)) ? await calculateUserBalance(userId) : 0\n  \n  console.log(`‚úÖ fetchUserByPhone: –±–∞–ª–∞–Ω—Å –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π = ${calculatedBalance} (userId=${userId}, isValid=${userId && !isNaN(userId)})`)\n  \n  return {\n    ...rawUser,\n    Id: userId,\n    phone: rawUser.phone || rawUser[\"Phone\"] || \"\",\n    name: rawUser.name || rawUser[\"Name\"] || \"\",\n    password_hash: rawUser.password_hash || rawUser[\"Password Hash\"] || undefined,\n    additional_phone: rawUser.additional_phone || rawUser[\"Additional Phone\"] || undefined,\n    street: rawUser.street || rawUser[\"Street\"] || undefined,\n    building: rawUser.building || rawUser[\"Building\"] || undefined,\n    building_section: rawUser.building_section || rawUser[\"Building Section\"] || undefined,\n    apartment: rawUser.apartment || rawUser[\"Apartment\"] || undefined,\n    entrance: rawUser.entrance || rawUser[\"Entrance\"] || undefined,\n    floor: rawUser.floor || rawUser[\"Floor\"] || undefined,\n    intercom: rawUser.intercom || rawUser[\"Intercom\"] || undefined,\n    district: rawUser.district || rawUser[\"District\"] || undefined,\n    delivery_comment: rawUser.delivery_comment || rawUser[\"Delivery Comment\"] || undefined,\n    loyalty_points: calculatedBalance, // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å!\n    total_spent: rawUser.total_spent !== undefined ? rawUser.total_spent : (rawUser[\"Total Spent\"] !== undefined ? rawUser[\"Total Spent\"] : 0),\n    created_at: rawUser.created_at || rawUser[\"Created At\"] || \"\",\n    updated_at: rawUser.updated_at || rawUser[\"Updated At\"] || \"\",\n    user_id: userIdValue,\n    \"User ID\": rawUser[\"User ID\"] !== undefined ? rawUser[\"User ID\"] : rawUser.user_id,\n  } as NocoDBUser\n}\n\n/**\n * –í—ã—á–∏—Å–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π\n * –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–µ Users.loyalty_points\n * @param userId ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * @param noCache –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n * @returns –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤\n */\nexport async function calculateUserBalance(userId: number, noCache: boolean = false): Promise<number> {\n  try {\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º nocoFetch - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (—á–µ—Ä–µ–∑ API proxy) –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ\n    const fetchFn = noCache ? nocoFetchNoCache : nocoFetch\n    const response = await fetchFn<NocoDBResponse<any>>(\"Loyalty_Points_Transactions\", {\n      where: `(User ID,eq,${userId})`,\n      limit: 10000,\n    })\n    \n    const transactions = response.list || []\n    \n    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã\n    // - undefined/null/\"\": —É—á–∏—Ç—ã–≤–∞–µ–º (—Å—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞ –∏–ª–∏ NocoDB –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª)\n    // - 'completed': —É—á–∏—Ç—ã–≤–∞–µ–º (–±–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã)\n    // - 'pending': –ù–ï —É—á–∏—Ç—ã–≤–∞–µ–º (–±–∞–ª–ª—ã –µ—â–µ –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã, –∂–¥—É—Ç –æ–ø–ª–∞—Ç—ã)\n    // - 'cancelled': –ù–ï —É—á–∏—Ç—ã–≤–∞–µ–º (–±–∞–ª–ª—ã –æ—Ç–º–µ–Ω–µ–Ω—ã - –í–ê–ñ–ù–û: —ç—Ç–æ —Å—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–µ —Ç–∏–ø!)\n    const activeTransactions = transactions.filter((t: any) => {\n      const status = t['Transaction Status'] || t.transaction_status\n      // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å undefined, null, –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ - —Å—á–∏—Ç–∞–µ–º completed\n      // –≠—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ NocoDB –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –ø–æ–ª–µ –∏–ª–∏ –≤–µ—Ä–Ω—É–ª null\n      if (!status || status === undefined || status === null || status === '') return true\n      // –£—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ completed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n      return status === 'completed'\n    })\n    \n    // –í—ã—á–∏—Å–ª—è–µ–º –±–∞–ª–∞–Ω—Å\n    let balance = 0\n    activeTransactions.forEach((t: any) => {\n      const type = t['Transaction Type'] || t.transaction_type\n      const amount = t['Points'] || t.points || t['Points Amount'] || 0\n      \n      // –í—Å–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ Points –Ω–∞–ø—Ä—è–º—É—é\n      // (Points —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–Ω–∞–∫: +141 –¥–ª—è earned, -141 –¥–ª—è cancelled)\n      balance += amount\n    })\n    \n    console.log(`üí∞ calculateUserBalance(${userId}): ${balance} –±–∞–ª–ª–æ–≤ (–∏–∑ ${activeTransactions.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≤—Å–µ–≥–æ ${transactions.length})`)\n    \n    return Math.max(0, balance)\n  } catch (error) {\n    console.error(`‚ùå –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è userId=${userId}:`, error)\n    return 0\n  }\n}\n\nexport async function fetchUserById(id: number, noCache: boolean = false): Promise<NocoDBUser | null> {\n  console.log(`üîç fetchUserById: –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å Id=${id} (noCache=${noCache})`)\n  const fetchFn = noCache ? nocoFetchNoCache : nocoFetch\n  \n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—â–µ–º –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É Id, –∞ –Ω–µ –ø–æ User ID\n  const response = await fetchFn<NocoDBResponse<any>>(\"Users\", {\n    where: `(Id,eq,${id})`,\n  })\n  const rawUser = response.list?.[0]\n  if (!rawUser) {\n    console.warn(`‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å Id=${id} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`)\n    return null\n  }\n  console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:`, {\n    rawKeys: Object.keys(rawUser),\n    hasId: 'Id' in rawUser,\n    hasid: 'id' in rawUser,\n    hasUserId: 'User ID' in rawUser,\n    Id: rawUser.Id,\n    id: rawUser.id,\n    userId: rawUser['User ID'] || rawUser.user_id,\n    phone: rawUser.phone || rawUser[\"Phone\"],\n    'Loyalty Points': rawUser['Loyalty Points'],\n    loyalty_points: rawUser.loyalty_points,\n    'Total Spent': rawUser['Total Spent'],\n    total_spent: rawUser.total_spent,\n  })\n  \n  // üîç –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ê–î–†–ï–°–ù–´–• –ü–û–õ–ï–ô\n  console.log(`üîç [fetchUserById] Address fields from rawUser:`, {\n    'District': rawUser.District,\n    'district': rawUser.district,\n    'Street': rawUser.Street,\n    'street': rawUser.street,\n    'Building': rawUser.Building,\n    'building': rawUser.building,\n    'Apartment': rawUser.Apartment,\n    'apartment': rawUser.apartment,\n  })\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ API (—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫) –≤ —Ñ–æ—Ä–º–∞—Ç NocoDBUser\n  // –í–ê–ñ–ù–û: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º Id —è–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –≤ NocoDB –º–æ–∂–µ—Ç –±—ã—Ç—å Id, id, –∏–ª–∏ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n  const userId = rawUser.Id !== undefined \n    ? rawUser.Id \n    : (rawUser.id !== undefined ? rawUser.id : (rawUser[\"Id\"] !== undefined ? rawUser[\"Id\"] : undefined))\n  \n  if (userId === undefined) {\n    console.error(\"‚ùå –ü–æ–ª–µ Id –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –æ—Ç–≤–µ—Ç–µ API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\", rawUser)\n    console.error(\"–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è:\", Object.keys(rawUser))\n  }\n  \n  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º User ID (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ —á–∏—Å–ª–æ–º)\n  const userIdValue = rawUser.user_id !== undefined \n    ? rawUser.user_id \n    : (rawUser[\"User ID\"] !== undefined \n      ? (typeof rawUser[\"User ID\"] === \"string\" ? parseInt(rawUser[\"User ID\"]) || undefined : rawUser[\"User ID\"])\n      : undefined)\n  \n  const normalizedUser = {\n    ...rawUser,\n    Id: userId !== undefined ? (typeof userId === 'number' ? userId : parseInt(String(userId))) : 0,\n    phone: rawUser.phone || rawUser[\"Phone\"] || \"\",\n    name: rawUser.name || rawUser[\"Name\"] || \"\",\n    password_hash: rawUser.password_hash || rawUser[\"Password Hash\"] || undefined,\n    additional_phone: rawUser.additional_phone || rawUser[\"Additional Phone\"] || undefined,\n    street: rawUser.street || rawUser[\"Street\"] || undefined,\n    building: rawUser.building || rawUser[\"Building\"] || undefined,\n    building_section: rawUser.building_section || rawUser[\"Building Section\"] || undefined,\n    apartment: rawUser.apartment || rawUser[\"Apartment\"] || undefined,\n    entrance: rawUser.entrance || rawUser[\"Entrance\"] || undefined,\n    floor: rawUser.floor || rawUser[\"Floor\"] || undefined,\n    intercom: rawUser.intercom || rawUser[\"Intercom\"] || undefined,\n    district: rawUser.district || rawUser[\"District\"] || undefined,\n    delivery_comment: rawUser.delivery_comment || rawUser[\"Delivery Comment\"] || undefined,\n    loyalty_points: 0, // –ë—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–æ –Ω–∏–∂–µ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π\n    total_spent: rawUser.total_spent !== undefined ? rawUser.total_spent : (rawUser[\"Total Spent\"] !== undefined ? rawUser[\"Total Spent\"] : 0),\n    created_at: rawUser.created_at || rawUser[\"Created At\"] || \"\",\n    updated_at: rawUser.updated_at || rawUser[\"Updated At\"] || \"\",\n    user_id: userIdValue,\n    \"User ID\": rawUser[\"User ID\"] !== undefined ? rawUser[\"User ID\"] : rawUser.user_id,\n  } as NocoDBUser\n  \n  // –í–ê–ñ–ù–û: –í—ã—á–∏—Å–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫!)\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ userIdValue –Ω–µ null –∏ –Ω–µ undefined, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º userId\n  const finalUserIdForBalance = (userIdValue !== undefined && userIdValue !== null) ? userIdValue : userId\n  const calculatedBalance = (finalUserIdForBalance && !isNaN(finalUserIdForBalance)) \n    ? await calculateUserBalance(finalUserIdForBalance, noCache) \n    : 0\n  normalizedUser.loyalty_points = calculatedBalance\n  \n  console.log(`‚úÖ fetchUserById normalized result:`, {\n    Id: normalizedUser.Id,\n    loyalty_points: calculatedBalance,\n    total_spent: normalizedUser.total_spent,\n    balanceSource: 'calculated from transactions',\n  })\n  \n  // üîç –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–ù–´–• –ê–î–†–ï–°–ù–´–• –ü–û–õ–ï–ô\n  console.log(`üîç [fetchUserById] Address fields in normalizedUser:`, {\n    'District': normalizedUser.District,\n    'district': normalizedUser.district,\n    'Street': normalizedUser.Street,\n    'street': normalizedUser.street,\n    'Building': normalizedUser.Building,\n    'building': normalizedUser.building,\n    'Apartment': normalizedUser.Apartment,\n    'apartment': normalizedUser.apartment,\n  })\n\n  return normalizedUser\n}\n\nexport async function createUser(user: Omit<NocoDBUser, \"Id\"> & { created_at?: string; updated_at?: string }): Promise<NocoDBUser> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º created_at –∏ updated_at, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã\n  const now = new Date().toISOString()\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–µ–º Title Case –¥–ª—è NocoDB API\n  const mappedUser: any = {}\n  \n  if (user.name !== undefined) mappedUser[\"Name\"] = user.name\n  if (user.phone !== undefined) mappedUser[\"Phone\"] = user.phone\n  if (user.additional_phone !== undefined) mappedUser[\"Additional Phone\"] = user.additional_phone\n  if (user.street !== undefined) mappedUser[\"Street\"] = user.street\n  if (user.building !== undefined) mappedUser[\"Building\"] = user.building\n  if (user.building_section !== undefined) mappedUser[\"Building Section\"] = user.building_section\n  if (user.apartment !== undefined) mappedUser[\"Apartment\"] = user.apartment\n  if (user.entrance !== undefined) mappedUser[\"Entrance\"] = user.entrance\n  if (user.floor !== undefined) mappedUser[\"Floor\"] = user.floor\n  if (user.intercom !== undefined) mappedUser[\"Intercom\"] = user.intercom\n  if (user.district !== undefined) mappedUser[\"District\"] = user.district\n  if (user.delivery_comment !== undefined) mappedUser[\"Delivery Comment\"] = user.delivery_comment\n  if (user.loyalty_points !== undefined) mappedUser[\"Loyalty Points\"] = user.loyalty_points\n  if (user.total_spent !== undefined) mappedUser[\"Total Spent\"] = user.total_spent\n  if (user.user_id !== undefined) mappedUser[\"User ID\"] = user.user_id\n  \n  mappedUser[\"Created At\"] = user.created_at || now\n  mappedUser[\"Updated At\"] = user.updated_at || now\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBUser>(\"Users\", mappedUser, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Users\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(mappedUser),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBUser\n    }\n    \n    return response as NocoDBUser\n  }\n}\n\nexport async function updateUser(id: number, data: Partial<NocoDBUser>): Promise<NocoDBUser> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–µ–º Title Case –¥–ª—è NocoDB API\n  const mappedData: any = {}\n  \n  if (data.name !== undefined) mappedData[\"Name\"] = data.name\n  if (data.phone !== undefined) mappedData[\"Phone\"] = data.phone\n  if (data.additional_phone !== undefined) mappedData[\"Additional Phone\"] = data.additional_phone\n  if (data.street !== undefined) mappedData[\"Street\"] = data.street\n  if (data.building !== undefined) mappedData[\"Building\"] = data.building\n  if (data.building_section !== undefined) mappedData[\"Building Section\"] = data.building_section\n  if (data.apartment !== undefined) mappedData[\"Apartment\"] = data.apartment\n  if (data.entrance !== undefined) mappedData[\"Entrance\"] = data.entrance\n  if (data.floor !== undefined) mappedData[\"Floor\"] = data.floor\n  if (data.intercom !== undefined) mappedData[\"Intercom\"] = data.intercom\n  if (data.district !== undefined) mappedData[\"District\"] = data.district\n  if (data.delivery_comment !== undefined) mappedData[\"Delivery Comment\"] = data.delivery_comment\n  // –í–ê–ñ–ù–û: loyalty_points –û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø —á–µ—Ä–µ–∑ updateUser (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è!)\n  if (data.loyalty_points !== undefined) mappedData[\"Loyalty Points\"] = data.loyalty_points\n  if (data.total_spent !== undefined) mappedData[\"Total Spent\"] = data.total_spent\n  if (data.updated_at !== undefined) mappedData[\"Updated At\"] = data.updated_at\n  if (data.user_id !== undefined) mappedData[\"User ID\"] = data.user_id\n  \n  console.log(`üìù updateUser(${id}):`, {\n    originalData: data,\n    mappedData,\n    hasTotalSpent: 'Total Spent' in mappedData,\n    totalSpentValue: mappedData[\"Total Spent\"],\n  })\n  \n  if (apiBaseUrl === null) {\n    const result = await serverCreateRecord<NocoDBUser>(\"Users\", mappedData, \"PATCH\", id)\n    \n    // –ü–æ—Å–ª–µ bulk update –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–µ –≤—Å–µ –ø–æ–ª—è, –ø–æ—ç—Ç–æ–º—É –º–µ—Ä–¥–∂–∏–º —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n    const mergedResult = {\n      ...result,\n      // loyalty_points –±–æ–ª—å—à–µ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)\n      total_spent: data.total_spent !== undefined ? data.total_spent : result.total_spent,\n    } as NocoDBUser\n    \n    console.log(`‚úÖ updateUser result merged with input:`, {\n      Id: mergedResult.Id,\n      total_spent: mergedResult.total_spent,\n    })\n    \n    return mergedResult\n  } else {\n    // –í–ê–ñ–ù–û: NocoDB v2 API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç bulk update —Ñ–æ—Ä–º–∞—Ç\n    // –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ú–ê–°–°–ò–í –∑–∞–ø–∏—Å–µ–π —Å Id\n    const response = await fetch(`/api/db/Users/records`, {\n      method: \"PATCH\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify([{\n        Id: id,\n        ...mappedData,\n      }]),\n    })\n    \n    if (!response.ok) {\n      const text = await response.text()\n      console.error(`‚ùå Failed to update user ${id}:`, response.status, text)\n      // –ù–µ –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å\n      // –ü—Ä–æ—Ñ–∏–ª—å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ localStorage\n      return {\n        Id: id,\n        ...data,\n      } as NocoDBUser\n    }\n    \n    const result = await response.json()\n    \n    if (Array.isArray(result)) {\n      return result[0] as NocoDBUser\n    }\n    \n    if (result && typeof result === 'object' && 'Id' in result) {\n      return result as NocoDBUser\n    }\n    \n    if (result && typeof result === 'object' && 'record' in result) {\n      return result.record as NocoDBUser\n    }\n    \n    return result as NocoDBUser\n  }\n}\n\n// === LOYALTY POINTS FUNCTIONS ===\n\n/**\n * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –∫—ç—à–±—ç–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–µ–π —Å—É–º–º—ã –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤\n */\nexport function calculateCashbackPercent(totalSpent: number): number {\n  if (totalSpent >= 50000) return 7 // Gold\n  if (totalSpent >= 20000) return 5 // Silver\n  return 3 // Bronze\n}\n\n/**\n * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –Ω–∞—á–∏—Å–ª–µ–Ω—ã –∑–∞ –∑–∞–∫–∞–∑\n */\nexport function calculateEarnedPoints(orderTotal: number, pointsUsed: number, totalSpent: number): number {\n  if (orderTotal <= 0) {\n    console.warn(`‚ö†Ô∏è calculateEarnedPoints: orderTotal <= 0 (${orderTotal}), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0`)\n    return 0\n  }\n  \n  const cashbackPercent = calculateCashbackPercent(totalSpent)\n  // –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Å —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –º–∏–Ω—É—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã\n  const amountForPoints = Math.max(0, orderTotal - pointsUsed)\n  const earnedPoints = Math.floor(amountForPoints * (cashbackPercent / 100))\n  \n  console.log(`üî¢ calculateEarnedPoints:`, {\n    orderTotal,\n    pointsUsed,\n    totalSpent,\n    cashbackPercent,\n    amountForPoints,\n    earnedPoints,\n  })\n  \n  return earnedPoints\n}\n\n/**\n * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–π–æ–Ω–∞ –∏ —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞\n * @param district - –†–∞–π–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏\n * @param orderSubtotal - –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –ë–ï–ó –¥–æ—Å—Ç–∞–≤–∫–∏\n * @param deliveryZones - –°–ø–∏—Å–æ–∫ –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è)\n * @returns –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏\n */\nexport async function calculateDeliveryFee(\n  district: string | undefined,\n  orderSubtotal: number,\n  deliveryZones?: NocoDBDeliveryZone[]\n): Promise<number> {\n  // –ï—Å–ª–∏ —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ >= 2300‚ÇΩ, –¥–æ—Å—Ç–∞–≤–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è\n  if (orderSubtotal >= 2300) {\n    console.log(`‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è: —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ ${orderSubtotal}‚ÇΩ >= 2300‚ÇΩ`)\n    return 0\n  }\n  \n  // –ï—Å–ª–∏ —Ä–∞–π–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω, –Ω–µ –º–æ–∂–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É\n  if (!district) {\n    console.warn(`‚ö†Ô∏è –†–∞–π–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0`)\n    return 0\n  }\n  \n  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã\n  if (!deliveryZones) {\n    deliveryZones = await fetchDeliveryZones()\n  }\n  \n  // –ò—â–µ–º –∑–æ–Ω—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞\n  const zone = deliveryZones.find(z => {\n    const zoneDistrict = z.District || z.district || \"\"\n    return zoneDistrict.toLowerCase().trim() === district.toLowerCase().trim()\n  })\n  \n  if (!zone) {\n    console.warn(`‚ö†Ô∏è –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ä–∞–π–æ–Ω–∞ \"${district}\" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`)\n    return 0\n  }\n  \n  // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑ –∑–æ–Ω—ã\n  const deliveryFee = typeof zone[\"Delivery Fee\"] === 'number' \n    ? zone[\"Delivery Fee\"]\n    : typeof zone.delivery_fee === 'number'\n    ? zone.delivery_fee\n    : parseFloat(String(zone[\"Delivery Fee\"] || zone.delivery_fee || 0))\n  \n  console.log(`üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ä–∞–π–æ–Ω–∞ \"${district}\": ${deliveryFee}‚ÇΩ (—Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: ${orderSubtotal}‚ÇΩ)`)\n  \n  return deliveryFee\n}\n\n/**\n * –ù–∞—á–∏—Å–ª—è–µ—Ç –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞ –∑–∞–∫–∞–∑\n * @param userId ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * @param orderTotal –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞\n * @param pointsUsed –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –≤ –∑–∞–∫–∞–∑–µ\n * @param pointsEarned –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∏—Å–ª—è–µ–º—ã—Ö –±–∞–ª–ª–æ–≤ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)\n * @param orderId ID –∑–∞–∫–∞–∑–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å–≤—è–∑–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∑–∞–∫–∞–∑–æ–º)\n * @returns –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n */\nexport async function createPendingLoyaltyPoints(\n  userId: number,\n  orderTotal: number,\n  pointsUsed: number = 0,\n  pointsEarned?: number,\n  orderId?: number\n): Promise<void> {\n  const user = await fetchUserById(userId)\n  if (!user) {\n    throw new Error(`User with ID ${userId} not found`)\n  }\n\n  const currentTotalSpent = typeof user.total_spent === 'number' ? user.total_spent : parseFloat(String(user.total_spent)) || 0\n  const currentLoyaltyPoints = typeof user.loyalty_points === 'number' ? user.loyalty_points : parseInt(String(user.loyalty_points)) || 0\n\n  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã\n  const earnedPoints = pointsEarned !== undefined \n    ? pointsEarned \n    : calculateEarnedPoints(orderTotal, pointsUsed, currentTotalSpent)\n\n  const now = new Date().toISOString()\n  \n  // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–∞–ª–ª—ã, —Å–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ (completed)\n  if (pointsUsed > 0) {\n    try {\n      await createLoyaltyPointsTransaction({\n        user_id: userId,\n        order_id: orderId,\n        transaction_type: \"used\",\n        transaction_status: \"completed\",\n        points: -pointsUsed,\n        description: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${pointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞`,\n        created_at: now,\n        updated_at: now,\n        processed_at: now,\n      })\n    } catch (error) {\n      console.error(\"Failed to create loyalty points transaction for used points:\", error)\n    }\n  }\n\n  // –°–æ–∑–¥–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤\n  if (earnedPoints > 0) {\n    try {\n      console.log(`‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤:`, {\n        user_id: userId,\n        order_id: orderId,\n        transaction_type: \"earned\",\n        transaction_status: \"pending\",\n        points: earnedPoints,\n        description: `–û–∂–∏–¥–∞–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è ${earnedPoints} –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${orderTotal} —Ä—É–±. (–Ω–∞–ª–∏—á–Ω—ã–µ)`,\n      })\n      \n      await createLoyaltyPointsTransaction({\n        user_id: userId,\n        order_id: orderId,\n        transaction_type: \"earned\",\n        transaction_status: \"pending\",\n        points: earnedPoints,\n        description: `–û–∂–∏–¥–∞–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è ${earnedPoints} –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${orderTotal} —Ä—É–±. (–Ω–∞–ª–∏—á–Ω—ã–µ)`,\n        created_at: now,\n        updated_at: now,\n      })\n      \n      console.log(`‚úÖ Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ`)\n    } catch (error) {\n      console.error(\"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\", error)\n    }\n  }\n\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –û–±–Ω–æ–≤–ª—è–µ–º totalSpent –í–°–ï–ì–î–ê –¥–ª—è –Ω–∞–ª–∏—á–Ω—ã—Ö\n  // –ë–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º (pending), –Ω–æ totalSpent –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É\n  const newTotalSpent = currentTotalSpent + orderTotal - pointsUsed\n  \n  if (pointsUsed > 0) {\n    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–∞–ª–ª—ã - –æ–±–Ω–æ–≤–ª—è–µ–º –∏ –±–∞–ª–∞–Ω—Å, –∏ totalSpent\n    const newLoyaltyPoints = currentLoyaltyPoints - pointsUsed\n\n    console.log(`üí≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤):`, {\n      currentLoyaltyPoints,\n      pointsUsed,\n      newLoyaltyPoints,\n      currentTotalSpent,\n      orderTotal,\n      newTotalSpent,\n      calculation: `${currentTotalSpent} + ${orderTotal} - ${pointsUsed} = ${newTotalSpent}`\n    })\n\n    await updateUser(userId, {\n      loyalty_points: newLoyaltyPoints,\n      total_spent: newTotalSpent,\n    })\n  } else {\n    // –ï—Å–ª–∏ –±–∞–ª–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ totalSpent\n    console.log(`üí≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ totalSpent (–Ω–∞–ª–∏—á–Ω—ã–µ –±–µ–∑ –±–∞–ª–ª–æ–≤):`, {\n      currentTotalSpent,\n      orderTotal,\n      newTotalSpent,\n      calculation: `${currentTotalSpent} + ${orderTotal} = ${newTotalSpent}`\n    })\n\n    await updateUser(userId, {\n      total_spent: newTotalSpent,\n    })\n  }\n\n  console.log(`‚è≥ Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞. –ë–∞–ª–ª—ã –±—É–¥—É—Ç –Ω–∞—á–∏—Å–ª–µ–Ω—ã –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ cron job`)\n}\n\nexport async function awardLoyaltyPoints(\n  userId: number,\n  orderTotal: number,\n  pointsUsed: number = 0,\n  pointsEarned?: number,\n  orderId?: number\n): Promise<NocoDBUser> {\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞\n  const user = await fetchUserById(userId, true)\n  if (!user) {\n    throw new Error(`User with ID ${userId} not found`)\n  }\n\n  const currentTotalSpent = typeof user.total_spent === 'number' ? user.total_spent : parseFloat(String(user.total_spent)) || 0\n\n  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã\n  const earnedPoints = pointsEarned !== undefined \n    ? pointsEarned \n    : calculateEarnedPoints(orderTotal, pointsUsed, currentTotalSpent)\n\n  // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏\n  const now = new Date().toISOString()\n  \n  // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–∞–ª–ª—ã, —Å–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ\n  if (pointsUsed > 0) {\n    await createLoyaltyPointsTransaction({\n      user_id: userId,\n      order_id: orderId,\n      transaction_type: \"used\",\n      transaction_status: \"completed\",\n      points: -pointsUsed,\n      description: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${pointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞`,\n      created_at: now,\n      updated_at: now,\n      processed_at: now,\n    })\n    console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"used\" —Å–æ–∑–¥–∞–Ω–∞: -${pointsUsed} –±–∞–ª–ª–æ–≤`)\n  }\n\n  // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤\n  if (earnedPoints > 0) {\n    await createLoyaltyPointsTransaction({\n      user_id: userId,\n      order_id: orderId,\n      transaction_type: \"earned\",\n      transaction_status: \"completed\",\n      points: earnedPoints,\n      description: `–ù–∞—á–∏—Å–ª–µ–Ω–æ ${earnedPoints} –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${orderTotal} —Ä—É–±.`,\n      created_at: now,\n      updated_at: now,\n      processed_at: now,\n    })\n    console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"earned\" —Å–æ–∑–¥–∞–Ω–∞: +${earnedPoints} –±–∞–ª–ª–æ–≤`)\n  }\n\n  // –û–±–Ω–æ–≤–ª—è–µ–º total_spent –∏ loyalty_points\n  const newTotalSpent = currentTotalSpent + orderTotal - pointsUsed\n  \n  // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å + –Ω–∞—á–∏—Å–ª–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ\n  const currentBalance = typeof user.loyalty_points === 'number' \n    ? user.loyalty_points \n    : parseFloat(String(user.loyalty_points)) || 0\n  const newBalance = currentBalance + earnedPoints - pointsUsed\n\n  console.log(`üí≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:`, {\n    currentBalance,\n    earnedPoints,\n    pointsUsed,\n    newBalance,\n    calculation: `${currentBalance} + ${earnedPoints} - ${pointsUsed} = ${newBalance}`,\n    currentTotalSpent,\n    orderTotal,\n    newTotalSpent,\n    calculation_totalSpent: `${currentTotalSpent} + ${orderTotal} - ${pointsUsed} = ${newTotalSpent}`,\n  })\n\n  // –û–±–Ω–æ–≤–ª—è–µ–º –∏ total_spent –∏ loyalty_points!\n  console.log(`üìù [awardLoyaltyPoints] –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, {\n    total_spent: newTotalSpent,\n    loyalty_points: newBalance,\n  })\n  \n  await updateUser(userId, {\n    total_spent: newTotalSpent,\n    loyalty_points: newBalance,\n    updated_at: now,\n  })\n  \n  console.log(`‚úÖ [awardLoyaltyPoints] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –ë–î`)\n\n  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º\n  const updatedUser = await fetchUserById(userId, true) // noCache –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n  if (!updatedUser) {\n    throw new Error(`User with ID ${userId} not found after update`)\n  }\n\n  console.log(`‚úÖ awardLoyaltyPoints –∑–∞–≤–µ—Ä—à–µ–Ω–æ:`, {\n    userId,\n    earnedPoints,\n    pointsUsed,\n    actualBalance: updatedUser.loyalty_points,\n    totalSpent: updatedUser.total_spent,\n  })\n\n  return updatedUser\n}\n\n/**\n * –°–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞\n * @param userId ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * @param pointsEarned –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å\n * @param pointsUsed –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å\n * @param orderTotal –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ total_spent\n * @param orderId ID –∑–∞–∫–∞–∑–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å–≤—è–∑–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∑–∞–∫–∞–∑–æ–º)\n * @returns –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n */\nexport async function refundLoyaltyPoints(\n  userId: number,\n  pointsEarned: number,\n  pointsUsed: number,\n  orderTotal: number,\n  orderId?: number\n): Promise<NocoDBUser> {\n  const user = await fetchUserById(userId)\n  if (!user) {\n    throw new Error(`User with ID ${userId} not found`)\n  }\n\n  // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏\n  const now = new Date().toISOString()\n\n  // –ï—Å–ª–∏ –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –±–∞–ª–ª—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö\n  if (pointsUsed > 0) {\n    console.log(`üìù –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é \"refunded\": points=+${pointsUsed}`)\n    const refundedTransaction = await createLoyaltyPointsTransaction({\n      user_id: userId,\n      order_id: orderId,\n      transaction_type: \"refunded\",\n      transaction_status: \"completed\", // –ö–†–ò–¢–ò–ß–ù–û: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å—Ä–∞–∑—É completed\n      points: pointsUsed, // ‚Üê –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–û–ï —á–∏—Å–ª–æ (–≤–æ–∑–≤—Ä–∞—Ç –±–∞–ª–ª–æ–≤)\n      description: `–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${pointsUsed} –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞`,\n      created_at: now,\n      updated_at: now,\n      processed_at: now,\n    })\n    console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"refunded\" —Å–æ–∑–¥–∞–Ω–∞:`, {\n      Id: refundedTransaction.Id,\n      points: refundedTransaction.points,\n      type: refundedTransaction.transaction_type,\n      status: refundedTransaction.transaction_status,\n    })\n  }\n\n  // –°–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã\n  if (pointsEarned > 0) {\n    console.log(`üìù –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é \"cancelled\": points=-${pointsEarned}`)\n    const cancelledTransaction = await createLoyaltyPointsTransaction({\n      user_id: userId,\n      order_id: orderId,\n      transaction_type: \"cancelled\",\n      transaction_status: \"completed\", // –ö–†–ò–¢–ò–ß–ù–û: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å—Ä–∞–∑—É completed\n      points: -pointsEarned, // ‚Üê –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–û–ï —á–∏—Å–ª–æ (—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤)\n      description: `–°–ø–∏—Å–∞–Ω–æ ${pointsEarned} –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞`,\n      created_at: now,\n      updated_at: now,\n      processed_at: now,\n    })\n    console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"cancelled\" —Å–æ–∑–¥–∞–Ω–∞:`, {\n      Id: cancelledTransaction.Id,\n      points: cancelledTransaction.points,\n      type: cancelledTransaction.transaction_type,\n      status: cancelledTransaction.transaction_status,\n    })\n  }\n\n  // ‚úÖ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º loyalty_points –Ω–∞–ø—Ä—è–º—É—é!\n  // –ë–∞–ª–∞–Ω—Å –≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ calculateUserBalance\n  console.log(`üí≥ refundLoyaltyPoints - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã:`, {\n    userId,\n    orderId,\n    pointsUsed: pointsUsed > 0 ? `+${pointsUsed}` : 0,\n    pointsEarned: pointsEarned > 0 ? `-${pointsEarned}` : 0,\n    explanation: `–ë–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º fetchUserById`,\n  })\n\n  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º (–ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã–º –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)\n  const updatedUser = await fetchUserById(userId, true) // noCache –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n  if (!updatedUser) {\n    throw new Error(`User with ID ${userId} not found after refund`)\n  }\n\n  console.log(`‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞: ${updatedUser.loyalty_points} –±–∞–ª–ª–æ–≤ (–ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)`)\n\n  return updatedUser\n}\n\n// === ORDERS ===\n\nexport interface NocoDBOrder {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  user_id?: number\n  \"User ID\"?: number\n  order_number?: string\n  \"Order Number\"?: string\n  start_date?: string\n  \"Start Date\"?: string\n  delivery_time?: string\n  \"Delivery Time\"?: string\n  \n  // –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã\n  payment_status?: \"pending\" | \"paid\" | \"refunded\" | \"failed\"\n  \"Payment Status\"?: \"pending\" | \"paid\" | \"refunded\" | \"failed\"\n  payment_method?: \"cash\" | \"card\" | \"sbp\" | \"online\"\n  \"Payment Method\"?: \"cash\" | \"card\" | \"sbp\" | \"online\"\n  paid?: boolean | string\n  Paid?: boolean | string\n  paid_at?: string\n  \"Paid At\"?: string\n  payment_id?: string\n  \"Payment ID\"?: string\n  \n  // –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (–±–µ–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏)\n  order_status?: \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\"\n  \"Order Status\"?: \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\"\n  \n  // –£–î–ê–õ–ï–ù–û: delivered, cancelled, status - —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —É–±—Ä–∞–Ω—ã\n  \n  // üÜï –î–û–°–¢–ê–í–ö–ê\n  delivery_fee?: number | string\n  \"Delivery Fee\"?: number | string\n  delivery_district?: string\n  \"Delivery District\"?: string\n  delivery_address?: string\n  \"Delivery Address\"?: string\n  \n  promo_code?: string\n  \"Promo Code\"?: string\n  promo_discount?: number | string\n  \"Promo Discount\"?: number | string\n  loyalty_points_used?: number | string\n  \"Loyalty Points Used\"?: number | string\n  loyalty_points_earned?: number | string\n  \"Loyalty Points Earned\"?: number | string\n  subtotal?: number | string\n  Subtotal?: number | string\n  total?: number | string\n  Total?: number | string\n  guest_phone?: string\n  \"Guest Phone\"?: string\n  guest_address?: string\n  \"Guest Address\"?: string\n  created_at?: string\n  \"Created At\"?: string\n  updated_at?: string\n  \"Updated At\"?: string\n}\n\nexport async function fetchOrders(userId?: number): Promise<NocoDBOrder[]> {\n  const params: Record<string, string> = {\n    limit: \"1000\",\n    sort: \"-Start Date\", // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: NocoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Title Case –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤\n  }\n\n  if (userId) {\n    // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n    // –í —Ç–∞–±–ª–∏—Ü–µ Orders –∫–æ–ª–æ–Ω–∫–∞ user_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"User ID\"\n    // ‚úÖ –§–ò–õ–¨–¢–†–£–ï–ú –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î\n    params.where = `(User ID,eq,${userId})~and(Order Status,neq,cancelled)`\n  } else {\n    // ‚úÖ –ï—Å–ª–∏ userId –Ω–µ —É–∫–∞–∑–∞–Ω, –≤—Å–µ —Ä–∞–≤–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã\n    params.where = `(Order Status,neq,cancelled)`\n  }\n\n  const response = await nocoFetch<NocoDBResponse<any>>(\"Orders\", params)\n  \n  console.log(`üì¶ fetchOrders: –ø–æ–ª—É—á–µ–Ω–æ ${response.list?.length || 0} –∑–∞–∫–∞–∑–æ–≤ –∏–∑ –ë–î (userId=${userId || 'all'})`)\n  \n  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ (Title Case ‚Üí snake_case)\n  const normalizedOrders = (response.list || []).map(rawOrder => ({\n    ...rawOrder,\n    Id: rawOrder.Id || rawOrder.id || 0,\n    user_id: rawOrder.user_id ?? rawOrder[\"User ID\"],\n    \"User ID\": rawOrder[\"User ID\"] ?? rawOrder.user_id,\n    order_number: rawOrder.order_number ?? rawOrder[\"Order Number\"] ?? \"\",\n    \"Order Number\": rawOrder[\"Order Number\"] ?? rawOrder.order_number ?? \"\",\n    start_date: rawOrder.start_date ?? rawOrder[\"Start Date\"] ?? \"\",\n    \"Start Date\": rawOrder[\"Start Date\"] ?? rawOrder.start_date ?? \"\",\n    delivery_time: rawOrder.delivery_time ?? rawOrder[\"Delivery Time\"] ?? \"\",\n    \"Delivery Time\": rawOrder[\"Delivery Time\"] ?? rawOrder.delivery_time ?? \"\",\n    payment_status: (rawOrder.payment_status ?? rawOrder[\"Payment Status\"] ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    \"Payment Status\": (rawOrder[\"Payment Status\"] ?? rawOrder.payment_status ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    payment_method: (rawOrder.payment_method ?? rawOrder[\"Payment Method\"] ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    \"Payment Method\": (rawOrder[\"Payment Method\"] ?? rawOrder.payment_method ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    paid: rawOrder.paid !== undefined ? rawOrder.paid : (rawOrder[\"Paid\"] === true || rawOrder[\"Paid\"] === \"True\"),\n    Paid: rawOrder[\"Paid\"] !== undefined ? rawOrder[\"Paid\"] : rawOrder.paid,\n    paid_at: rawOrder.paid_at ?? rawOrder[\"Paid At\"],\n    \"Paid At\": rawOrder[\"Paid At\"] ?? rawOrder.paid_at,\n    payment_id: rawOrder.payment_id ?? rawOrder[\"Payment ID\"],\n    \"Payment ID\": rawOrder[\"Payment ID\"] ?? rawOrder.payment_id,\n    order_status: (rawOrder.order_status ?? rawOrder[\"Order Status\"] ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    \"Order Status\": (rawOrder[\"Order Status\"] ?? rawOrder.order_status ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    promo_code: rawOrder.promo_code ?? rawOrder[\"Promo Code\"],\n    \"Promo Code\": rawOrder[\"Promo Code\"] ?? rawOrder.promo_code,\n    promo_discount: rawOrder.promo_discount ?? rawOrder[\"Promo Discount\"],\n    \"Promo Discount\": rawOrder[\"Promo Discount\"] ?? rawOrder.promo_discount,\n    loyalty_points_used: rawOrder.loyalty_points_used ?? rawOrder[\"Loyalty Points Used\"] ?? 0,\n    \"Loyalty Points Used\": rawOrder[\"Loyalty Points Used\"] ?? rawOrder.loyalty_points_used ?? 0,\n    loyalty_points_earned: rawOrder.loyalty_points_earned ?? rawOrder[\"Loyalty Points Earned\"] ?? 0,\n    \"Loyalty Points Earned\": rawOrder[\"Loyalty Points Earned\"] ?? rawOrder.loyalty_points_earned ?? 0,\n    subtotal: rawOrder.subtotal ?? rawOrder.Subtotal ?? 0,\n    Subtotal: rawOrder.Subtotal ?? rawOrder.subtotal ?? 0,\n    total: rawOrder.total ?? rawOrder.Total ?? 0,\n    Total: rawOrder.Total ?? rawOrder.total ?? 0,\n    guest_phone: rawOrder.guest_phone ?? rawOrder[\"Guest Phone\"],\n    \"Guest Phone\": rawOrder[\"Guest Phone\"] ?? rawOrder.guest_phone,\n    guest_address: rawOrder.guest_address ?? rawOrder[\"Guest Address\"],\n    \"Guest Address\": rawOrder[\"Guest Address\"] ?? rawOrder.guest_address,\n    created_at: rawOrder.created_at ?? rawOrder[\"Created At\"] ?? \"\",\n    \"Created At\": rawOrder[\"Created At\"] ?? rawOrder.created_at ?? \"\",\n    updated_at: rawOrder.updated_at ?? rawOrder[\"Updated At\"] ?? \"\",\n    \"Updated At\": rawOrder[\"Updated At\"] ?? rawOrder.updated_at ?? \"\",\n  } as NocoDBOrder))\n  \n  return normalizedOrders\n}\n\nexport async function fetchOrdersByUser(userId: number): Promise<NocoDBOrder[]> {\n  return fetchOrders(userId)\n}\n\n/**\n * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ (persons, meals, extras)\n * @param userId ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * @returns –ú–∞—Å—Å–∏–≤ –∑–∞–∫–∞–∑–æ–≤ —Å –¥–µ—Ç–∞–ª—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Order[]\n */\nexport async function fetchOrdersWithDetails(userId: number, noCache: boolean = true): Promise<any[]> {\n  // ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ë–ï–ó –∫—ç—à–∞ –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n  const params: Record<string, string> = {\n    limit: \"1000\",\n    sort: \"-Start Date\",\n  }\n  params.where = `(User ID,eq,${userId})~and(Order Status,neq,cancelled)`\n  \n  const fetchFn = noCache ? nocoFetchNoCache : nocoFetch\n  const response = await fetchFn<NocoDBResponse<any>>(\"Orders\", params)\n  const orders = response.list || []\n  \n  console.log(`üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è ${orders.length} –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId} (noCache=${noCache})...`)\n  \n  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ\n  const ordersWithDetails = await Promise.all(\n    orders.map(async (order) => {\n      try {\n        // –ó–∞–≥—Ä—É–∂–∞–µ–º persons –∏ extras\n        const [dbPersons, dbExtras] = await Promise.all([\n          fetchOrderPersons(order.Id),\n          fetchOrderExtras(order.Id),\n        ])\n        \n        // –î–ª—è –∫–∞–∂–¥–æ–≥–æ person –∑–∞–≥—Ä—É–∂–∞–µ–º meals –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç Person\n        const persons = await Promise.all(\n          dbPersons.map(async (dbPerson: any) => {\n            const dbMeals = await fetchOrderMeals(dbPerson.Id || dbPerson.id)\n            \n            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É day1 –∏ day2\n            const day1: any = {\n              breakfast: { dish: null },\n              lunch: { salad: null, soup: null, main: null },\n              dinner: { salad: null, soup: null, main: null },\n            }\n            const day2: any = {\n              breakfast: { dish: null },\n              lunch: { salad: null, soup: null, main: null },\n              dinner: { salad: null, soup: null, main: null },\n            }\n            \n            // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –°–û–•–†–ê–ù–ï–ù–ù–´–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ Order_Meals (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ –∏–∑ Meals!)\n            await Promise.all(\n              dbMeals.map(async (dbMeal: any) => {\n                const mealId = dbMeal.meal_id || dbMeal[\"Meal ID\"]\n                if (!mealId) return\n                \n                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª—é–¥–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è)\n                const meal = await fetchMealById(mealId)\n                if (!meal) return\n                \n                const day = (dbMeal.day || dbMeal.Day) as \"day1\" | \"day2\"\n                const mealTime = (dbMeal.meal_time || dbMeal[\"Meal Time\"]) as \"breakfast\" | \"lunch\" | \"dinner\"\n                const mealType = (dbMeal.meal_type || dbMeal[\"Meal Type\"]) as \"dish\" | \"salad\" | \"soup\" | \"main\"\n                const portionSize = (dbMeal.portion_size || dbMeal[\"Portion Size\"] || \"single\") as \"single\" | \"medium\" | \"large\"\n                \n                // ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú –°–û–•–†–ê–ù–ï–ù–ù–£–Æ –¶–ï–ù–£ –∏–∑ Order_Meals (—É–∂–µ –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—É—é!)\n                const savedPrice = dbMeal.price || dbMeal.Price || 0\n                \n                // ‚úÖ –ó–ê–ú–ï–ù–Ø–ï–ú —Ü–µ–Ω—ã –≤ prices –Ω–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ –∏–∑ Order_Meals!\n                const roundedPrices = {\n                  single: portionSize === 'single' ? savedPrice : (meal.prices?.single ? Math.round(meal.prices.single) : 0),\n                  medium: portionSize === 'medium' ? savedPrice : (meal.prices?.medium ? Math.round(meal.prices.medium) : undefined),\n                  large: portionSize === 'large' ? savedPrice : (meal.prices?.large ? Math.round(meal.prices.large) : undefined),\n                }\n                \n                // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≥–∞—Ä–Ω–∏—Ä –µ—Å–ª–∏ –µ—Å—Ç—å\n                let garnishObject = null\n                const garnishId = dbMeal.garnish_id || dbMeal[\"Garnish ID\"]\n                if (garnishId) {\n                  const garnish = await fetchMealById(garnishId)\n                  if (garnish) {\n                    const garnishPortion = (dbMeal.garnish_portion_size || dbMeal[\"Garnish Portion Size\"] || \"single\") as \"single\" | \"medium\" | \"large\"\n                    const savedGarnishPrice = dbMeal.garnish_price || dbMeal[\"Garnish Price\"] || 0\n                    \n                    const roundedGarnishPrices = {\n                      single: garnishPortion === 'single' ? savedGarnishPrice : (garnish.prices?.single ? Math.round(garnish.prices.single) : 0),\n                      medium: garnishPortion === 'medium' ? savedGarnishPrice : (garnish.prices?.medium ? Math.round(garnish.prices.medium) : undefined),\n                      large: garnishPortion === 'large' ? savedGarnishPrice : (garnish.prices?.large ? Math.round(garnish.prices.large) : undefined),\n                    }\n                    \n                    garnishObject = {\n                      id: garnish.Id,\n                      name: garnish.name || garnish.Name || \"\",\n                      price: savedGarnishPrice,\n                      prices: roundedGarnishPrices,\n                      weights: garnish.weights,\n                      portion: garnishPortion,\n                      category: garnish.category || garnish.Category || \"\",\n                    }\n                  }\n                }\n                \n                // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –±–ª—é–¥–∞\n                const mealObject = {\n                  id: meal.Id,\n                  name: meal.name || meal.Name || \"\",\n                  price: savedPrice, // ‚úÖ –¶–µ–Ω–∞ –∏–∑ Order_Meals (–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞)\n                  prices: roundedPrices, // ‚úÖ –í–°–ï —Ü–µ–Ω—ã –æ–∫—Ä—É–≥–ª–µ–Ω—ã!\n                  weights: meal.weights, // ‚úÖ –ì—Ä–∞–º–º–æ–≤–∫–∏ –∏–∑ Meals\n                  portion: portionSize, // ‚úÖ –°—Ç—Ä–æ–∫–∞: \"single\" | \"medium\" | \"large\"\n                  category: meal.category || meal.Category || \"\",\n                  garnish: garnishObject, // ‚úÖ –ì–∞—Ä–Ω–∏—Ä —Å –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏\n                }\n                \n                // –†–∞–∑–º–µ—â–∞–µ–º –±–ª—é–¥–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–æ—Ç\n                const dayObj = day === \"day1\" ? day1 : day2\n                if (mealTime === \"breakfast\" && mealType === \"dish\") {\n                  dayObj.breakfast.dish = mealObject\n                } else if (mealTime === \"lunch\") {\n                  if (mealType === \"salad\") dayObj.lunch.salad = mealObject\n                  else if (mealType === \"soup\") dayObj.lunch.soup = mealObject\n                  else if (mealType === \"main\") dayObj.lunch.main = mealObject\n                } else if (mealTime === \"dinner\") {\n                  if (mealType === \"salad\") dayObj.dinner.salad = mealObject\n                  else if (mealType === \"soup\") dayObj.dinner.soup = mealObject\n                  else if (mealType === \"main\") dayObj.dinner.main = mealObject\n                }\n              })\n            )\n            \n            return {\n              id: dbPerson.Id || dbPerson.id,\n              day1,\n              day2,\n            }\n          })\n        )\n        \n        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º extras –≤ —Ñ–æ—Ä–º–∞—Ç Extra[]\n        const extras = await Promise.all(\n          dbExtras.map(async (dbExtra: any) => {\n            const extraId = dbExtra.extra_id || dbExtra[\"Extra ID\"]\n            if (!extraId) return null\n            \n            // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–Ω–∞–∑–≤–∞–Ω–∏–µ) –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Extras\n            const extraResponse = await nocoFetch<NocoDBResponse<any>>(\"Extras\", {\n              where: `(Id,eq,${extraId})`,\n            })\n            const extraData = extraResponse.list?.[0]\n            if (!extraData) return null\n            \n            // ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú –°–û–•–†–ê–ù–ï–ù–ù–£–Æ –¶–ï–ù–£ –∏–∑ Order_Extras (—É–∂–µ –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—É—é!)\n            const savedPrice = dbExtra.price || dbExtra.Price || 0\n            \n            return {\n              id: extraData.Id,\n              name: extraData.name || extraData.Name || \"\",\n              price: savedPrice, // ‚úÖ –¶–µ–Ω–∞ –∏–∑ Order_Extras (–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞)\n              quantity: parseInt(String(dbExtra.quantity || dbExtra.Quantity || 1)),\n            }\n          })\n        )\n        \n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º total –∏–∑ Order_Meals, –µ—Å–ª–∏ –≤ –ë–î –æ–Ω —Ä–∞–≤–µ–Ω 0\n        let calculatedTotal = order.total || order.Total || 0\n        let calculatedSubtotal = order.subtotal || order.Subtotal || 0\n        \n        // –ï—Å–ª–∏ total === 0 (–±–∞–≥ –æ—Ç —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞), –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–∑ —Ü–µ–Ω\n        if (calculatedTotal === 0 && (persons.length > 0 || extras.filter((e: any) => e !== null).length > 0)) {\n          console.log(`üîß [fetchOrdersWithDetails] –ó–∞–∫–∞–∑ ${order.Id}: total=0, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–∑ —Ü–µ–Ω...`)\n          \n          // –°—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –±–ª—é–¥\n          persons.forEach((person: any) => {\n            ['day1', 'day2'].forEach((day) => {\n              const dayMeals = person[day]\n              // –ó–∞–≤—Ç—Ä–∞–∫\n              if (dayMeals?.breakfast?.dish?.price) {\n                calculatedTotal += dayMeals.breakfast.dish.price\n                if (dayMeals.breakfast.dish.garnish?.price) {\n                  calculatedTotal += dayMeals.breakfast.dish.garnish.price\n                }\n              }\n              // –û–±–µ–¥\n              if (dayMeals?.lunch?.salad?.price) calculatedTotal += dayMeals.lunch.salad.price\n              if (dayMeals?.lunch?.salad?.garnish?.price) calculatedTotal += dayMeals.lunch.salad.garnish.price\n              if (dayMeals?.lunch?.soup?.price) calculatedTotal += dayMeals.lunch.soup.price\n              if (dayMeals?.lunch?.soup?.garnish?.price) calculatedTotal += dayMeals.lunch.soup.garnish.price\n              if (dayMeals?.lunch?.main?.price) calculatedTotal += dayMeals.lunch.main.price\n              if (dayMeals?.lunch?.main?.garnish?.price) calculatedTotal += dayMeals.lunch.main.garnish.price\n              // –£–∂–∏–Ω\n              if (dayMeals?.dinner?.salad?.price) calculatedTotal += dayMeals.dinner.salad.price\n              if (dayMeals?.dinner?.salad?.garnish?.price) calculatedTotal += dayMeals.dinner.salad.garnish.price\n              if (dayMeals?.dinner?.soup?.price) calculatedTotal += dayMeals.dinner.soup.price\n              if (dayMeals?.dinner?.soup?.garnish?.price) calculatedTotal += dayMeals.dinner.soup.garnish.price\n              if (dayMeals?.dinner?.main?.price) calculatedTotal += dayMeals.dinner.main.price\n              if (dayMeals?.dinner?.main?.garnish?.price) calculatedTotal += dayMeals.dinner.main.garnish.price\n            })\n          })\n          \n          // –°—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å extras\n          extras.filter((e: any) => e !== null).forEach((extra: any) => {\n            calculatedTotal += (extra.price || 0) * (extra.quantity || 1)\n          })\n          \n          calculatedSubtotal = calculatedTotal\n          console.log(`‚úÖ [fetchOrdersWithDetails] –ó–∞–∫–∞–∑ ${order.Id}: –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω total=${calculatedTotal}`)\n        }\n        \n        // ‚úÖ –ú–∞–ø–ø–∏–º –ø–æ–ª—è NocoDB –≤ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n        return {\n          id: order.Id,\n          orderNumber: order.order_number || order[\"Order Number\"],\n          startDate: order.start_date || order[\"Start Date\"],\n          deliveryTime: order.delivery_time || order[\"Delivery Time\"] || \"\",\n          paymentMethod: order.payment_method || order[\"Payment Method\"] || \"cash\",\n          paid: order.paid ?? order.Paid ?? false,\n          paidAt: order.paid_at || order[\"Paid At\"],\n          paymentStatus: order.payment_status || order[\"Payment Status\"] || \"pending\",\n          orderStatus: order.order_status || order[\"Order Status\"] || \"pending\",\n          total: calculatedTotal,\n          subtotal: calculatedSubtotal,\n          deliveryFee: order.delivery_fee || order[\"Delivery Fee\"] || 0,\n          deliveryDistrict: order.delivery_district || order[\"Delivery District\"],\n          deliveryAddress: order.delivery_address || order[\"Delivery Address\"],\n          loyaltyPointsUsed: order.loyalty_points_used || order[\"Loyalty Points Used\"] || 0,\n          loyaltyPointsEarned: order.loyalty_points_earned || order[\"Loyalty Points Earned\"] || 0,\n          persons,\n          extras: extras.filter((e: any) => e !== null),\n        }\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ ${order.Id}:`, error)\n        return {\n          id: order.Id,\n          orderNumber: order.order_number || order[\"Order Number\"],\n          startDate: order.start_date || order[\"Start Date\"],\n          deliveryTime: order.delivery_time || order[\"Delivery Time\"] || \"\",\n          paymentMethod: order.payment_method || order[\"Payment Method\"] || \"cash\",\n          paid: order.paid ?? order.Paid ?? false,\n          paidAt: order.paid_at || order[\"Paid At\"],\n          paymentStatus: order.payment_status || order[\"Payment Status\"] || \"pending\",\n          orderStatus: order.order_status || order[\"Order Status\"] || \"pending\",\n          total: order.total || order.Total || 0,\n          subtotal: order.subtotal || order.Subtotal || 0,\n          deliveryFee: order.delivery_fee || order[\"Delivery Fee\"] || 0,\n          deliveryDistrict: order.delivery_district || order[\"Delivery District\"],\n          deliveryAddress: order.delivery_address || order[\"Delivery Address\"],\n          loyaltyPointsUsed: order.loyalty_points_used || order[\"Loyalty Points Used\"] || 0,\n          loyaltyPointsEarned: order.loyalty_points_earned || order[\"Loyalty Points Earned\"] || 0,\n          persons: [],\n          extras: [],\n        }\n      }\n    })\n  )\n  \n  console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–µ—Ç–∞–ª–∏ –¥–ª—è ${ordersWithDetails.length} –∑–∞–∫–∞–∑–æ–≤`)\n  return ordersWithDetails\n}\n\nexport function generateOrderNumber(): string {\n  const now = new Date()\n  const date = now.toISOString().slice(0, 10).replace(/-/g, \"\")\n  const random = Math.random().toString(36).substring(2, 8).toUpperCase()\n  return `ORD-${date}-${random}`\n}\n\nexport async function fetchOrderById(id: number, noCache: boolean = false): Promise<NocoDBOrder | null> {\n  const fetchFn = noCache ? nocoFetchNoCache : nocoFetch\n  const response = await fetchFn<NocoDBResponse<any>>(\"Orders\", {\n    where: `(Id,eq,${id})`,\n  })\n  const rawOrder = response.list?.[0]\n  if (!rawOrder) return null\n  \n  console.log(`üîç fetchOrderById(${id}, noCache=${noCache}) raw data:`, {\n    'Loyalty Points Earned': rawOrder[\"Loyalty Points Earned\"],\n    'loyalty_points_earned': rawOrder.loyalty_points_earned,\n    'Total': rawOrder.Total,\n    'total': rawOrder.total,\n  })\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ API (—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫) –≤ —Ñ–æ—Ä–º–∞—Ç NocoDBOrder\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)\n  return {\n    ...rawOrder,\n    Id: rawOrder.Id || rawOrder.id || 0,\n    user_id: rawOrder.user_id ?? rawOrder[\"User ID\"],\n    \"User ID\": rawOrder[\"User ID\"] ?? rawOrder.user_id,\n    order_number: rawOrder.order_number ?? rawOrder[\"Order Number\"] ?? \"\",\n    \"Order Number\": rawOrder[\"Order Number\"] ?? rawOrder.order_number ?? \"\",\n    start_date: rawOrder.start_date ?? rawOrder[\"Start Date\"] ?? \"\",\n    \"Start Date\": rawOrder[\"Start Date\"] ?? rawOrder.start_date ?? \"\",\n    delivery_time: rawOrder.delivery_time ?? rawOrder[\"Delivery Time\"] ?? \"\",\n    \"Delivery Time\": rawOrder[\"Delivery Time\"] ?? rawOrder.delivery_time ?? \"\",\n    payment_status: (rawOrder.payment_status ?? rawOrder[\"Payment Status\"] ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    \"Payment Status\": (rawOrder[\"Payment Status\"] ?? rawOrder.payment_status ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    payment_method: (rawOrder.payment_method ?? rawOrder[\"Payment Method\"] ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    \"Payment Method\": (rawOrder[\"Payment Method\"] ?? rawOrder.payment_method ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    paid: rawOrder.paid !== undefined ? rawOrder.paid : (rawOrder[\"Paid\"] === true || rawOrder[\"Paid\"] === \"True\"),\n    Paid: rawOrder[\"Paid\"] !== undefined ? rawOrder[\"Paid\"] : rawOrder.paid,\n    paid_at: rawOrder.paid_at ?? rawOrder[\"Paid At\"],\n    \"Paid At\": rawOrder[\"Paid At\"] ?? rawOrder.paid_at,\n    payment_id: rawOrder.payment_id ?? rawOrder[\"Payment ID\"],\n    \"Payment ID\": rawOrder[\"Payment ID\"] ?? rawOrder.payment_id,\n    order_status: (rawOrder.order_status ?? rawOrder[\"Order Status\"] ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    \"Order Status\": (rawOrder[\"Order Status\"] ?? rawOrder.order_status ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    promo_code: rawOrder.promo_code ?? rawOrder[\"Promo Code\"],\n    \"Promo Code\": rawOrder[\"Promo Code\"] ?? rawOrder.promo_code,\n    promo_discount: rawOrder.promo_discount ?? rawOrder[\"Promo Discount\"],\n    \"Promo Discount\": rawOrder[\"Promo Discount\"] ?? rawOrder.promo_discount,\n    loyalty_points_used: rawOrder.loyalty_points_used ?? rawOrder[\"Loyalty Points Used\"] ?? 0,\n    \"Loyalty Points Used\": rawOrder[\"Loyalty Points Used\"] ?? rawOrder.loyalty_points_used ?? 0,\n    loyalty_points_earned: rawOrder.loyalty_points_earned ?? rawOrder[\"Loyalty Points Earned\"] ?? 0,\n    \"Loyalty Points Earned\": rawOrder[\"Loyalty Points Earned\"] ?? rawOrder.loyalty_points_earned ?? 0,\n    subtotal: rawOrder.subtotal ?? rawOrder.Subtotal ?? 0,\n    Subtotal: rawOrder.Subtotal ?? rawOrder.subtotal ?? 0,\n    total: rawOrder.total ?? rawOrder.Total ?? 0,\n    Total: rawOrder.Total ?? rawOrder.total ?? 0,\n    guest_phone: rawOrder.guest_phone ?? rawOrder[\"Guest Phone\"],\n    \"Guest Phone\": rawOrder[\"Guest Phone\"] ?? rawOrder.guest_phone,\n    guest_address: rawOrder.guest_address ?? rawOrder[\"Guest Address\"],\n    \"Guest Address\": rawOrder[\"Guest Address\"] ?? rawOrder.guest_address,\n    created_at: rawOrder.created_at ?? rawOrder[\"Created At\"] ?? \"\",\n    \"Created At\": rawOrder[\"Created At\"] ?? rawOrder.created_at ?? \"\",\n    updated_at: rawOrder.updated_at ?? rawOrder[\"Updated At\"] ?? \"\",\n    \"Updated At\": rawOrder[\"Updated At\"] ?? rawOrder.updated_at ?? \"\",\n  } as NocoDBOrder\n}\n\nexport async function fetchOrderByNumber(orderNumber: string): Promise<NocoDBOrder | null> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Orders –∫–æ–ª–æ–Ω–∫–∞ order_number –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"Order Number\"\n  const response = await nocoFetch<NocoDBResponse<any>>(\"Orders\", {\n    where: `(Order Number,eq,${orderNumber})`,\n  })\n  const rawOrder = response.list?.[0]\n  if (!rawOrder) return null\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ API (—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫) –≤ —Ñ–æ—Ä–º–∞—Ç NocoDBOrder\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)\n  return {\n    ...rawOrder,\n    Id: rawOrder.Id || rawOrder.id || 0,\n    user_id: rawOrder.user_id ?? rawOrder[\"User ID\"],\n    \"User ID\": rawOrder[\"User ID\"] ?? rawOrder.user_id,\n    order_number: rawOrder.order_number ?? rawOrder[\"Order Number\"] ?? \"\",\n    \"Order Number\": rawOrder[\"Order Number\"] ?? rawOrder.order_number ?? \"\",\n    start_date: rawOrder.start_date ?? rawOrder[\"Start Date\"] ?? \"\",\n    \"Start Date\": rawOrder[\"Start Date\"] ?? rawOrder.start_date ?? \"\",\n    delivery_time: rawOrder.delivery_time ?? rawOrder[\"Delivery Time\"] ?? \"\",\n    \"Delivery Time\": rawOrder[\"Delivery Time\"] ?? rawOrder.delivery_time ?? \"\",\n    payment_status: (rawOrder.payment_status ?? rawOrder[\"Payment Status\"] ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    \"Payment Status\": (rawOrder[\"Payment Status\"] ?? rawOrder.payment_status ?? \"pending\") as \"pending\" | \"paid\" | \"refunded\" | \"failed\",\n    payment_method: (rawOrder.payment_method ?? rawOrder[\"Payment Method\"] ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    \"Payment Method\": (rawOrder[\"Payment Method\"] ?? rawOrder.payment_method ?? \"cash\") as \"cash\" | \"card\" | \"sbp\" | \"online\",\n    paid: rawOrder.paid !== undefined ? rawOrder.paid : (rawOrder[\"Paid\"] === true || rawOrder[\"Paid\"] === \"True\"),\n    Paid: rawOrder[\"Paid\"] !== undefined ? rawOrder[\"Paid\"] : rawOrder.paid,\n    paid_at: rawOrder.paid_at ?? rawOrder[\"Paid At\"],\n    \"Paid At\": rawOrder[\"Paid At\"] ?? rawOrder.paid_at,\n    payment_id: rawOrder.payment_id ?? rawOrder[\"Payment ID\"],\n    \"Payment ID\": rawOrder[\"Payment ID\"] ?? rawOrder.payment_id,\n    order_status: (rawOrder.order_status ?? rawOrder[\"Order Status\"] ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    \"Order Status\": (rawOrder[\"Order Status\"] ?? rawOrder.order_status ?? \"pending\") as \"pending\" | \"confirmed\" | \"preparing\" | \"ready\" | \"cancelled\",\n    promo_code: rawOrder.promo_code ?? rawOrder[\"Promo Code\"],\n    \"Promo Code\": rawOrder[\"Promo Code\"] ?? rawOrder.promo_code,\n    promo_discount: rawOrder.promo_discount ?? rawOrder[\"Promo Discount\"],\n    \"Promo Discount\": rawOrder[\"Promo Discount\"] ?? rawOrder.promo_discount,\n    loyalty_points_used: rawOrder.loyalty_points_used ?? rawOrder[\"Loyalty Points Used\"] ?? 0,\n    \"Loyalty Points Used\": rawOrder[\"Loyalty Points Used\"] ?? rawOrder.loyalty_points_used ?? 0,\n    loyalty_points_earned: rawOrder.loyalty_points_earned ?? rawOrder[\"Loyalty Points Earned\"] ?? 0,\n    \"Loyalty Points Earned\": rawOrder[\"Loyalty Points Earned\"] ?? rawOrder.loyalty_points_earned ?? 0,\n    subtotal: rawOrder.subtotal ?? rawOrder.Subtotal ?? 0,\n    Subtotal: rawOrder.Subtotal ?? rawOrder.subtotal ?? 0,\n    total: rawOrder.total ?? rawOrder.Total ?? 0,\n    Total: rawOrder.Total ?? rawOrder.total ?? 0,\n    guest_phone: rawOrder.guest_phone ?? rawOrder[\"Guest Phone\"],\n    \"Guest Phone\": rawOrder[\"Guest Phone\"] ?? rawOrder.guest_phone,\n    guest_address: rawOrder.guest_address ?? rawOrder[\"Guest Address\"],\n    \"Guest Address\": rawOrder[\"Guest Address\"] ?? rawOrder.guest_address,\n    created_at: rawOrder.created_at ?? rawOrder[\"Created At\"] ?? \"\",\n    \"Created At\": rawOrder[\"Created At\"] ?? rawOrder.created_at ?? \"\",\n    updated_at: rawOrder.updated_at ?? rawOrder[\"Updated At\"] ?? \"\",\n    \"Updated At\": rawOrder[\"Updated At\"] ?? rawOrder.updated_at ?? \"\",\n  } as NocoDBOrder\n}\n\nexport async function createOrder(order: Omit<NocoDBOrder, \"Id\" | \"created_at\" | \"updated_at\">): Promise<NocoDBOrder> {\n  // –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ NocoDB, –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - —á–µ—Ä–µ–∑ proxy\n  const apiBaseUrl = getApiBaseUrl()\n  \n  console.log(`üìù createOrder - –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:`, {\n    order,\n    keys: Object.keys(order),\n    user_id: order.user_id,\n    'User ID': order[\"User ID\"],\n  })\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–µ–º Title Case –¥–ª—è NocoDB API\n  // –í–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è\n  const mappedOrder: any = {}\n  \n  const userId = order.user_id ?? order[\"User ID\"]\n  if (userId !== undefined && userId !== null) mappedOrder[\"User ID\"] = userId\n  \n  const orderNumber = order.order_number ?? order[\"Order Number\"]\n  if (orderNumber !== undefined && orderNumber !== null) mappedOrder[\"Order Number\"] = orderNumber\n  \n  const startDate = order.start_date ?? order[\"Start Date\"]\n  if (startDate !== undefined && startDate !== null) mappedOrder[\"Start Date\"] = startDate\n  \n  const deliveryTime = order.delivery_time ?? order[\"Delivery Time\"]\n  if (deliveryTime !== undefined && deliveryTime !== null) mappedOrder[\"Delivery Time\"] = deliveryTime\n  \n  const paymentStatus = order.payment_status ?? order[\"Payment Status\"]\n  if (paymentStatus !== undefined && paymentStatus !== null) mappedOrder[\"Payment Status\"] = paymentStatus\n  \n  const paymentMethod = order.payment_method ?? order[\"Payment Method\"]\n  if (paymentMethod !== undefined && paymentMethod !== null) mappedOrder[\"Payment Method\"] = paymentMethod\n  \n  mappedOrder[\"Paid\"] = order.paid ?? order.Paid ?? false\n  \n  const paidAt = order.paid_at ?? order[\"Paid At\"]\n  if (paidAt !== undefined && paidAt !== null) mappedOrder[\"Paid At\"] = paidAt\n  \n  const paymentId = order.payment_id ?? order[\"Payment ID\"]\n  if (paymentId !== undefined && paymentId !== null) mappedOrder[\"Payment ID\"] = paymentId\n  \n  mappedOrder[\"Order Status\"] = order.order_status ?? order[\"Order Status\"] ?? \"pending\"\n  \n  const promoCode = order.promo_code ?? order[\"Promo Code\"]\n  if (promoCode !== undefined && promoCode !== null) mappedOrder[\"Promo Code\"] = promoCode\n  \n  const promoDiscount = order.promo_discount ?? order[\"Promo Discount\"]\n  if (promoDiscount !== undefined && promoDiscount !== null) mappedOrder[\"Promo Discount\"] = promoDiscount\n  \n  mappedOrder[\"Loyalty Points Used\"] = order.loyalty_points_used ?? order[\"Loyalty Points Used\"] ?? 0\n  mappedOrder[\"Loyalty Points Earned\"] = order.loyalty_points_earned ?? order[\"Loyalty Points Earned\"] ?? 0\n  mappedOrder[\"Subtotal\"] = order.subtotal ?? order.Subtotal ?? 0\n  mappedOrder[\"Total\"] = order.total ?? order.Total ?? 0\n  \n  const guestPhone = order.guest_phone ?? order[\"Guest Phone\"]\n  if (guestPhone !== undefined && guestPhone !== null) mappedOrder[\"Guest Phone\"] = guestPhone\n  \n  const guestAddress = order.guest_address ?? order[\"Guest Address\"]\n  if (guestAddress !== undefined && guestAddress !== null) mappedOrder[\"Guest Address\"] = guestAddress\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º created_at –∏ updated_at –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å\n  const createdAt = (order as any).created_at ?? (order as any)[\"Created At\"]\n  if (createdAt !== undefined && createdAt !== null) mappedOrder[\"Created At\"] = createdAt\n  \n  const updatedAt = (order as any).updated_at ?? (order as any)[\"Updated At\"]\n  if (updatedAt !== undefined && updatedAt !== null) mappedOrder[\"Updated At\"] = updatedAt\n  \n  console.log(`üìù createOrder - –º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:`, {\n    mappedOrder,\n    keys: Object.keys(mappedOrder),\n    hasUserId: 'User ID' in mappedOrder,\n    hasOrderNumber: 'Order Number' in mappedOrder,\n    hasStartDate: 'Start Date' in mappedOrder,\n  })\n  \n  let createdOrder: NocoDBOrder\n  \n  if (apiBaseUrl === null) {\n    // –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–∞ - –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ NocoDB\n    createdOrder = await serverCreateRecord<NocoDBOrder>(\"Orders\", mappedOrder, \"POST\")\n  } else {\n    // –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ä–µ–¥–∞ - —á–µ—Ä–µ–∑ API proxy\n    const response = await clientFetch<any>(\n      \"Orders\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(mappedOrder),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      createdOrder = response[0] as NocoDBOrder\n    } else if (response && typeof response === 'object' && 'Id' in response) {\n      createdOrder = response as NocoDBOrder\n    } else if (response && typeof response === 'object' && 'record' in response) {\n      createdOrder = response.record as NocoDBOrder\n    } else {\n      createdOrder = response as NocoDBOrder\n    }\n  }\n  \n  // NocoDB —á–∞—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ Id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –ø–æ—ç—Ç–æ–º—É –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç\n  if (createdOrder?.Id) {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–∞–∑–≤–∞–Ω–∏–π)\n    const orderNumber = createdOrder.order_number ?? createdOrder[\"Order Number\"]\n    if (!orderNumber || Object.keys(createdOrder).length < 5) {\n      console.log(`‚ö†Ô∏è Order created but incomplete response, fetching full order ${createdOrder.Id}...`)\n      try {\n        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å—å —Ç–æ—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å\n        await new Promise(resolve => setTimeout(resolve, 300))\n        const fullOrder = await fetchOrderById(createdOrder.Id)\n        const fullOrderNumber = fullOrder?.order_number ?? fullOrder?.[\"Order Number\"]\n        if (fullOrder && fullOrderNumber) {\n          console.log(`‚úÖ Fetched full order with order_number: ${fullOrderNumber}`)\n          return fullOrder\n        } else {\n          console.warn(`‚ö†Ô∏è Fetched order also incomplete, but using it anyway`)\n          if (fullOrder) return fullOrder\n        }\n      } catch (error) {\n        console.warn(`‚ö†Ô∏è Failed to fetch full order:`, error)\n        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å, –Ω–æ –µ—Å—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ\n        if ('order_number' in order) {\n          return { ...createdOrder, order_number: order.order_number } as NocoDBOrder\n        }\n      }\n    } else {\n      console.log(`‚úÖ Order created with complete data, order_number: ${createdOrder.order_number}`)\n    }\n  }\n  \n  return createdOrder\n}\n\nexport async function updateOrder(id: number, data: Partial<NocoDBOrder>): Promise<NocoDBOrder> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  console.log(`üìù updateOrder(${id}):`, {\n    data,\n    hasLoyaltyPointsEarned: 'loyalty_points_earned' in data,\n    loyaltyPointsEarnedValue: data.loyalty_points_earned,\n  })\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–µ–º Title Case –¥–ª—è NocoDB API\n  const mappedData: any = {}\n  if (data.user_id !== undefined || data[\"User ID\"] !== undefined) {\n    mappedData[\"User ID\"] = data.user_id ?? data[\"User ID\"]\n  }\n  if (data.order_number !== undefined || data[\"Order Number\"] !== undefined) {\n    mappedData[\"Order Number\"] = data.order_number ?? data[\"Order Number\"]\n  }\n  if (data.start_date !== undefined || data[\"Start Date\"] !== undefined) {\n    mappedData[\"Start Date\"] = data.start_date ?? data[\"Start Date\"]\n  }\n  if (data.delivery_time !== undefined || data[\"Delivery Time\"] !== undefined) {\n    mappedData[\"Delivery Time\"] = data.delivery_time ?? data[\"Delivery Time\"]\n  }\n  if (data.payment_status !== undefined || data[\"Payment Status\"] !== undefined) {\n    mappedData[\"Payment Status\"] = data.payment_status ?? data[\"Payment Status\"]\n  }\n  if (data.payment_method !== undefined || data[\"Payment Method\"] !== undefined) {\n    mappedData[\"Payment Method\"] = data.payment_method ?? data[\"Payment Method\"]\n  }\n  if (data.paid !== undefined || data.Paid !== undefined) {\n    mappedData[\"Paid\"] = data.paid ?? data.Paid\n  }\n  if (data.paid_at !== undefined || data[\"Paid At\"] !== undefined) {\n    mappedData[\"Paid At\"] = data.paid_at ?? data[\"Paid At\"]\n  }\n  if (data.payment_id !== undefined || data[\"Payment ID\"] !== undefined) {\n    mappedData[\"Payment ID\"] = data.payment_id ?? data[\"Payment ID\"]\n  }\n  if (data.order_status !== undefined || data[\"Order Status\"] !== undefined) {\n    mappedData[\"Order Status\"] = data.order_status ?? data[\"Order Status\"]\n  }\n  if (data.promo_code !== undefined || data[\"Promo Code\"] !== undefined) {\n    mappedData[\"Promo Code\"] = data.promo_code ?? data[\"Promo Code\"]\n  }\n  if (data.promo_discount !== undefined || data[\"Promo Discount\"] !== undefined) {\n    mappedData[\"Promo Discount\"] = data.promo_discount ?? data[\"Promo Discount\"]\n  }\n  if (data.loyalty_points_used !== undefined || data[\"Loyalty Points Used\"] !== undefined) {\n    mappedData[\"Loyalty Points Used\"] = data.loyalty_points_used ?? data[\"Loyalty Points Used\"]\n  }\n  if (data.loyalty_points_earned !== undefined || data[\"Loyalty Points Earned\"] !== undefined) {\n    mappedData[\"Loyalty Points Earned\"] = data.loyalty_points_earned ?? data[\"Loyalty Points Earned\"]\n  }\n  if (data.subtotal !== undefined || data.Subtotal !== undefined) {\n    mappedData[\"Subtotal\"] = data.subtotal ?? data.Subtotal\n  }\n  if (data.total !== undefined || data.Total !== undefined) {\n    mappedData[\"Total\"] = data.total ?? data.Total\n  }\n  // üÜï –ü–û–õ–Ø –î–û–°–¢–ê–í–ö–ò\n  if (data.delivery_fee !== undefined || data[\"Delivery Fee\"] !== undefined) {\n    mappedData[\"Delivery Fee\"] = data.delivery_fee ?? data[\"Delivery Fee\"]\n  }\n  if (data.delivery_district !== undefined || data[\"Delivery District\"] !== undefined) {\n    mappedData[\"Delivery District\"] = data.delivery_district ?? data[\"Delivery District\"]\n  }\n  if (data.delivery_address !== undefined || data[\"Delivery Address\"] !== undefined) {\n    mappedData[\"Delivery Address\"] = data.delivery_address ?? data[\"Delivery Address\"]\n  }\n  if (data.guest_phone !== undefined || data[\"Guest Phone\"] !== undefined) {\n    mappedData[\"Guest Phone\"] = data.guest_phone ?? data[\"Guest Phone\"]\n  }\n  if (data.guest_address !== undefined || data[\"Guest Address\"] !== undefined) {\n    mappedData[\"Guest Address\"] = data.guest_address ?? data[\"Guest Address\"]\n  }\n  if (data.updated_at !== undefined || data[\"Updated At\"] !== undefined) {\n    mappedData[\"Updated At\"] = data.updated_at ?? data[\"Updated At\"]\n  }\n  \n  console.log(`üìù updateOrder(${id}) - –º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:`, {\n    mappedData,\n    hasLoyaltyPointsEarned: 'Loyalty Points Earned' in mappedData,\n    loyaltyPointsEarnedValue: mappedData[\"Loyalty Points Earned\"],\n  })\n  \n  if (apiBaseUrl === null) {\n    // –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–∞ - –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ NocoDB\n    const result = await serverCreateRecord<NocoDBOrder>(\"Orders\", mappedData, \"PATCH\", id)\n    console.log(`‚úÖ updateOrder(${id}) result:`, {\n      Id: result.Id,\n      loyalty_points_earned: result.loyalty_points_earned,\n      'Loyalty Points Earned': (result as any)['Loyalty Points Earned'],\n    })\n    return result\n  } else {\n    // –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ä–µ–¥–∞ - —á–µ—Ä–µ–∑ API proxy\n    const response = await clientFetch<any>(\n      `Orders/${id}`,\n      {},\n      {\n        method: \"PATCH\",\n        body: JSON.stringify(mappedData),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrder\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrder\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrder\n    }\n    \n    return response as NocoDBOrder\n  }\n}\n\n// === ORDER PERSONS ===\n\nexport interface NocoDBOrderPerson {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  order_id?: number\n  \"Order ID\"?: number\n  person_number?: number\n  \"Person Number\"?: number\n}\n\nexport async function createOrderPerson(orderPerson: Omit<NocoDBOrderPerson, \"Id\">): Promise<NocoDBOrderPerson> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderPerson>(\"Order_Persons\", orderPerson, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Persons\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderPerson),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderPerson\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderPerson\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderPerson\n    }\n    \n    return response as NocoDBOrderPerson\n  }\n}\n\n// === ORDER MEALS ===\n\nexport interface NocoDBOrderMeal {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  order_person_id?: number\n  \"Order Person ID\"?: number\n  day?: \"day1\" | \"day2\"\n  Day?: \"day1\" | \"day2\"\n  meal_time?: \"breakfast\" | \"lunch\" | \"dinner\"\n  \"Meal Time\"?: \"breakfast\" | \"lunch\" | \"dinner\"\n  meal_type?: \"dish\" | \"salad\" | \"soup\" | \"main\"\n  \"Meal Type\"?: \"dish\" | \"salad\" | \"soup\" | \"main\"\n  meal_id?: number\n  \"Meal ID\"?: number\n  portion_size?: \"single\" | \"medium\" | \"large\"\n  \"Portion Size\"?: \"single\" | \"medium\" | \"large\"\n  price?: number | string\n  Price?: number | string\n  garnish_id?: number\n  \"Garnish ID\"?: number\n  garnish_portion_size?: \"single\" | \"medium\" | \"large\"\n  \"Garnish Portion Size\"?: \"single\" | \"medium\" | \"large\"\n  garnish_price?: number | string\n  \"Garnish Price\"?: number | string\n}\n\nexport async function createOrderMeal(orderMeal: Omit<NocoDBOrderMeal, \"Id\">): Promise<NocoDBOrderMeal> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderMeal>(\"Order_Meals\", orderMeal, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Meals\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderMeal),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderMeal\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderMeal\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderMeal\n    }\n    \n    return response as NocoDBOrderMeal\n  }\n}\n\n// === ORDER EXTRAS ===\n\nexport interface NocoDBOrderExtra {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  order_id?: number\n  \"Order ID\"?: number\n  extra_id?: number\n  \"Extra ID\"?: number\n  quantity?: number | string\n  Quantity?: number | string\n  price?: number | string\n  Price?: number | string\n}\n\nexport async function createOrderExtra(orderExtra: Omit<NocoDBOrderExtra, \"Id\">): Promise<NocoDBOrderExtra> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderExtra>(\"Order_Extras\", orderExtra, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Extras\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderExtra),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderExtra\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderExtra\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderExtra\n    }\n    \n    return response as NocoDBOrderExtra\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞\nexport async function fetchOrderPersons(orderId: number): Promise<NocoDBOrderPerson[]> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Order_Persons –∫–æ–ª–æ–Ω–∫–∞ order_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"Order ID\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderPerson>>(\"Order_Persons\", {\n    where: `(Order ID,eq,${orderId})`,\n  })\n  return response.list || []\n}\n\nexport async function fetchOrderMeals(orderPersonId: number): Promise<NocoDBOrderMeal[]> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Order_Meals –∫–æ–ª–æ–Ω–∫–∞ order_person_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"Order Person ID\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderMeal>>(\"Order_Meals\", {\n    where: `(Order Person ID,eq,${orderPersonId})`,\n  })\n  return response.list || []\n}\n\nexport async function fetchOrderExtras(orderId: number): Promise<NocoDBOrderExtra[]> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Order_Extras –∫–æ–ª–æ–Ω–∫–∞ order_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"Order ID\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderExtra>>(\"Order_Extras\", {\n    where: `(Order ID,eq,${orderId})`,\n  })\n  return response.list || []\n}\n\n// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞\nexport async function deleteOrderPerson(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    // –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ NocoDB\n    const tableId = getTableId(\"Order_Persons\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order person: ${response.status}`)\n    }\n  } else {\n    // –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º API proxy\n    const response = await fetch(`/api/db/Order_Persons/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order person: ${response.status}`)\n    }\n  }\n}\n\nexport async function deleteOrderMeal(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    const tableId = getTableId(\"Order_Meals\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order meal: ${response.status}`)\n    }\n  } else {\n    const response = await fetch(`/api/db/Order_Meals/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order meal: ${response.status}`)\n    }\n  }\n}\n\nexport async function deleteOrderExtra(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    const tableId = getTableId(\"Order_Extras\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order extra: ${response.status}`)\n    }\n  } else {\n    const response = await fetch(`/api/db/Order_Extras/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order extra: ${response.status}`)\n    }\n  }\n}\n\n// === PROMO CODES ===\n\nexport interface NocoDBPromoCode {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  code?: string\n  Code?: string\n  discount_type?: \"percentage\" | \"fixed\"\n  \"Discount Type\"?: \"percentage\" | \"fixed\"\n  discount_value?: number | string\n  \"Discount Value\"?: number | string\n  min_order_amount?: number | string\n  \"Min Order Amount\"?: number | string\n  max_discount?: number | string\n  \"Max Discount\"?: number | string\n  valid_from?: string\n  \"Valid From\"?: string\n  valid_until?: string\n  \"Valid Until\"?: string\n  usage_limit?: number | string\n  \"Usage Limit\"?: number | string\n  times_used?: number | string\n  \"Times Used\"?: number | string\n  active?: boolean | string\n  Active?: boolean | string\n}\n\nexport async function fetchPromoCode(code: string): Promise<NocoDBPromoCode | null> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Promo_Codes –∫–æ–ª–æ–Ω–∫–∏ code –∏ active –∏–º–µ—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ \"Code\" –∏ \"Active\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBPromoCode>>(\"Promo_Codes\", {\n    where: `(Code,eq,${code})~and(Active,eq,true)`,\n  })\n  return response.list?.[0] || null\n}\n\nexport async function incrementPromoCodeUsage(id: number): Promise<void> {\n  await clientFetch(\n    \"Promo_Codes\",\n    {},\n    {\n      method: \"PATCH\",\n      body: JSON.stringify({ Id: id, times_used: { increment: 1 } }),\n    },\n  )\n}\n\n// === REVIEWS ===\n\nexport interface NocoDBReview {\n  Id: number\n  // NocoDB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–∞–º–∏ –∫–∞–∫ title (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏ –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)\n  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: column_name (snake_case) –∏ title\n  order_id?: number\n  \"Order ID\"?: number\n  user_id?: number\n  \"User ID\"?: number\n  rating?: number | string\n  Rating?: number | string\n  text?: string\n  \"Review Text\"?: string\n  created_at?: string\n  \"Created At\"?: string\n  updated_at?: string\n  \"Updated At\"?: string\n}\n\nexport async function fetchReviewsForUser(userId: number): Promise<NocoDBReview[]> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Reviews –∫–æ–ª–æ–Ω–∫–∞ user_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"User ID\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBReview>>(\"Reviews\", {\n    where: `(User ID,eq,${userId})`,\n  })\n  return response.list || []\n}\n\nexport async function createReview(\n  review: Omit<NocoDBReview, \"Id\" | \"created_at\" | \"updated_at\"> & { created_at?: string; updated_at?: string },\n): Promise<NocoDBReview> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º created_at –∏ updated_at, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã\n  const now = new Date().toISOString()\n  const reviewData = {\n    ...review,\n    created_at: review.created_at || now,\n    updated_at: review.updated_at || now,\n  }\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBReview>(\"Reviews\", reviewData, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Reviews\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(reviewData),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBReview\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBReview\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBReview\n    }\n    \n    return response as NocoDBReview\n  }\n}\n\n// === LOYALTY POINTS TRANSACTIONS ===\n\nexport interface NocoDBLoyaltyPointsTransaction {\n  Id: number\n  user_id: number\n  order_id?: number\n  transaction_type: \"earned\" | \"used\" | \"refunded\" | \"cancelled\"\n  transaction_status: \"pending\" | \"completed\" | \"cancelled\"\n  points: number | string\n  description?: string\n  created_at: string\n  updated_at: string\n  processed_at?: string\n}\n\nexport async function createLoyaltyPointsTransaction(\n  transaction: Omit<NocoDBLoyaltyPointsTransaction, \"Id\" | \"created_at\" | \"updated_at\"> & { created_at?: string; updated_at?: string },\n): Promise<NocoDBLoyaltyPointsTransaction> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º created_at –∏ updated_at, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã\n  const now = new Date().toISOString()\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: snake_case -> Title Case –¥–ª—è NocoDB\n  const transactionData = {\n    \"User ID\": transaction.user_id,\n    \"Order ID\": transaction.order_id,\n    \"Transaction Type\": transaction.transaction_type,\n    \"Transaction Status\": transaction.transaction_status,\n    \"Points\": transaction.points, // –í–ê–ñ–ù–û: –º–∞–ø–ø–∏–º points -> Points\n    \"Points Amount\": transaction.points, // –î–æ–±–∞–≤–ª—è–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n    \"Description\": transaction.description,\n    \"Created At\": transaction.created_at || now,\n    \"Updated At\": transaction.updated_at || now,\n    \"Processed At\": transaction.processed_at,\n  }\n  \n  console.log(`üìù createLoyaltyPointsTransaction: –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:`, {\n    table: \"Loyalty_Points_Transactions\",\n    data: transactionData,\n    apiBaseUrl: apiBaseUrl || \"server-side\",\n  })\n  \n  try {\n    let result: NocoDBLoyaltyPointsTransaction\n    \n    if (apiBaseUrl === null) {\n      console.log(`üì§ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ serverCreateRecord`)\n      result = await serverCreateRecord<NocoDBLoyaltyPointsTransaction>(\"Loyalty_Points_Transactions\", transactionData, \"POST\")\n    } else {\n      console.log(`üì§ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ clientFetch`)\n      const response = await clientFetch<any>(\n        \"Loyalty_Points_Transactions\",\n        {},\n        {\n          method: \"POST\",\n          body: JSON.stringify(transactionData),\n        },\n      )\n      \n      console.log(`üì• –û—Ç–≤–µ—Ç –æ—Ç clientFetch:`, response)\n      \n      if (Array.isArray(response)) {\n        result = response[0] as NocoDBLoyaltyPointsTransaction\n      } else if (response && typeof response === 'object' && 'Id' in response) {\n        result = response as NocoDBLoyaltyPointsTransaction\n      } else if (response && typeof response === 'object' && 'record' in response) {\n        result = response.record as NocoDBLoyaltyPointsTransaction\n      } else {\n        result = response as NocoDBLoyaltyPointsTransaction\n      }\n    }\n    \n    console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞:`, result)\n    return result\n  } catch (error) {\n    console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:`, error)\n    throw error\n  }\n}\n\nexport async function fetchLoyaltyPointsTransactions(userId: number): Promise<NocoDBLoyaltyPointsTransaction[]> {\n  // NocoDB API v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ where-—É—Å–ª–æ–≤–∏—è—Ö\n  // –í —Ç–∞–±–ª–∏—Ü–µ Loyalty_Points_Transactions –∫–æ–ª–æ–Ω–∫–∞ user_id –∏–º–µ–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ \"User ID\"\n  const response = await nocoFetch<NocoDBResponse<NocoDBLoyaltyPointsTransaction>>(\"Loyalty_Points_Transactions\", {\n    where: `(User ID,eq,${userId})`,\n    sort: \"-created_at\",\n    limit: \"1000\",\n  })\n  return response.list || []\n}\n\nexport async function fetchPendingTransactionsByOrder(orderId: number): Promise<NocoDBLoyaltyPointsTransaction[]> {\n  // –ü–æ–ª—É—á–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞\n  // NocoDB —Ç—Ä–µ–±—É–µ—Ç Title –∏–º–µ–Ω–∞ –≤ where-–∑–∞–ø—Ä–æ—Å–∞—Ö\n  const response = await nocoFetch<NocoDBResponse<any>>(\"Loyalty_Points_Transactions\", {\n    where: `(Order ID,eq,${orderId})~and(Transaction Status,eq,pending)`,\n    limit: \"1000\",\n  })\n  \n  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ - NocoDB –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å title –ø–æ–ª—è\n  const transactions = (response.list || []).map((t: any) => ({\n    Id: t.Id || t.id,\n    user_id: t.user_id || t[\"User ID\"] || t[\"user_id\"],\n    order_id: t.order_id || t[\"Order ID\"] || t[\"order_id\"],\n    transaction_type: t.transaction_type || t[\"Transaction Type\"] || t[\"transaction_type\"],\n    transaction_status: t.transaction_status || t[\"Transaction Status\"] || t[\"transaction_status\"],\n    points: t.points || t[\"Points\"] || t[\"points\"] || 0,\n    description: t.description || t[\"Description\"] || t[\"description\"],\n    created_at: t.created_at || t[\"Created At\"] || t[\"created_at\"],\n    updated_at: t.updated_at || t[\"Updated At\"] || t[\"updated_at\"],\n    processed_at: t.processed_at || t[\"Processed At\"] || t[\"processed_at\"],\n  }))\n  \n  console.log(`üîç fetchPendingTransactionsByOrder(${orderId}): –Ω–∞–π–¥–µ–Ω–æ ${transactions.length} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π`, \n    transactions.map(t => ({ Id: t.Id, points: t.points, type: t.transaction_type, status: t.transaction_status })))\n  \n  return transactions\n}\n\nexport async function updateLoyaltyTransaction(\n  transactionId: number,\n  updates: Partial<NocoDBLoyaltyPointsTransaction>\n): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: snake_case -> Title Case –¥–ª—è NocoDB\n  const updateData: any = {\n    \"Updated At\": new Date().toISOString(),\n  }\n  \n  if (updates.transaction_status !== undefined) {\n    updateData[\"Transaction Status\"] = updates.transaction_status\n  }\n  if (updates.processed_at !== undefined) {\n    updateData[\"Processed At\"] = updates.processed_at\n  }\n  if (updates.points !== undefined) {\n    updateData[\"Points\"] = updates.points\n    updateData[\"Points Amount\"] = updates.points\n  }\n  if (updates.description !== undefined) {\n    updateData[\"Description\"] = updates.description\n  }\n  \n  console.log(`üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ${transactionId}:`, updateData)\n  \n  if (apiBaseUrl === null) {\n    await serverCreateRecord(\"Loyalty_Points_Transactions\", updateData, \"PATCH\", transactionId)\n  } else {\n    await clientFetch(\n      `Loyalty_Points_Transactions/${transactionId}`,\n      {},\n      {\n        method: \"PATCH\",\n        pathSuffix: `/${transactionId}`,\n        body: JSON.stringify(updateData),\n      }\n    )\n  }\n  \n  console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ${transactionId} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞`)\n}\n\nexport async function processPendingTransactionsForOrder(\n  orderId: number,\n  userId: number | undefined\n): Promise<number> {\n  if (!userId) {\n    console.warn(`‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω userId –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞–∫–∞–∑–∞ ${orderId}`)\n    return 0\n  }\n  \n  console.log(`üí≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ ${orderId}, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId}`)\n  \n  // –ü–æ–ª—É—á–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞\n  const pendingTransactions = await fetchPendingTransactionsByOrder(orderId)\n  \n  if (pendingTransactions.length === 0) {\n    console.log(`‚ÑπÔ∏è –ù–µ—Ç pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ ${orderId}`)\n    return 0\n  }\n  \n  console.log(`üìä –ù–∞–π–¥–µ–Ω–æ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${pendingTransactions.length}`)\n  \n  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const user = await fetchUserById(userId)\n  if (!user) {\n    console.error(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –Ω–µ –Ω–∞–π–¥–µ–Ω`)\n    return 0\n  }\n  \n  let totalPointsToAdd = 0\n  const transactionsToUpdate: number[] = []\n  \n  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\n  for (const transaction of pendingTransactions) {\n    console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ${transaction.Id}:`, {\n      type: transaction.transaction_type,\n      points: transaction.points,\n      status: transaction.transaction_status,\n      description: transaction.description,\n    })\n    \n    if (transaction.transaction_type === 'earned') {\n      const points = typeof transaction.points === 'number' \n        ? transaction.points \n        : parseInt(String(transaction.points)) || 0\n      \n      if (points > 0) {\n        totalPointsToAdd += points\n        transactionsToUpdate.push(transaction.Id)\n        console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ${transaction.Id}: –¥–æ–±–∞–≤–∏–º ${points} –±–∞–ª–ª–æ–≤`)\n      } else {\n        console.warn(`‚ö†Ô∏è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ${transaction.Id}: points = ${points}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`)\n      }\n    }\n  }\n  \n  if (totalPointsToAdd > 0) {\n    // –ù–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n    const currentPoints = typeof user.loyalty_points === 'number' \n      ? user.loyalty_points \n      : parseInt(String(user.loyalty_points)) || 0\n    \n    const newPoints = currentPoints + totalPointsToAdd\n    \n    console.log(`üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤:`, {\n      currentPoints,\n      toAdd: totalPointsToAdd,\n      newPoints,\n    })\n    \n    await updateUser(userId, {\n      loyalty_points: newPoints,\n    })\n    \n    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π\n    const now = new Date().toISOString()\n    for (const transactionId of transactionsToUpdate) {\n      await updateLoyaltyTransaction(transactionId, {\n        transaction_status: 'completed',\n        processed_at: now,\n      })\n    }\n    \n    console.log(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${transactionsToUpdate.length} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –Ω–∞—á–∏—Å–ª–µ–Ω–æ ${totalPointsToAdd} –±–∞–ª–ª–æ–≤`)\n  } else {\n    console.log(`‚ÑπÔ∏è –ù–µ—Ç –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è`)\n  }\n  \n  return totalPointsToAdd\n}\n\n// === FRAUD ALERTS ===\n\nexport interface NocoDBFraudAlert {\n  Id: number\n  user_id: number\n  alert_type: string\n  paid_orders_count: number\n  cancelled_paid_orders_count: number\n  cancellation_rate: number\n  last_incident_date: string\n  status: \"active\" | \"reviewed\" | \"resolved\"\n  admin_notes?: string\n  created_at: string\n  updated_at: string\n}\n\nexport async function createFraudAlert(\n  userId: number,\n  stats: {\n    totalPaidOrders: number\n    cancelledPaidOrders: number\n    cancellationRate: number\n  }\n): Promise<NocoDBFraudAlert> {\n  const now = new Date().toISOString()\n  const apiBaseUrl = getApiBaseUrl()\n  \n  const alertData = {\n    user_id: userId,\n    alert_type: \"excessive_cancellations\",\n    paid_orders_count: stats.totalPaidOrders,\n    cancelled_paid_orders_count: stats.cancelledPaidOrders,\n    cancellation_rate: stats.cancellationRate,\n    last_incident_date: now,\n    status: \"active\" as const,\n    created_at: now,\n    updated_at: now,\n  }\n  \n  console.log(`üö® –°–æ–∑–¥–∞–Ω–∏–µ fraud alert –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, alertData)\n  \n  if (apiBaseUrl === null) {\n    return await serverCreateRecord<NocoDBFraudAlert>(\"Fraud_Alerts\", alertData, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Fraud_Alerts\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(alertData),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBFraudAlert\n    } else if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBFraudAlert\n    } else if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBFraudAlert\n    } else {\n      return response as NocoDBFraudAlert\n    }\n  }\n}\n\nexport async function getUserCancellationStats(userId: number): Promise<{\n  totalPaidOrders: number\n  cancelledPaidOrders: number\n  cancellationRate: number\n}> {\n  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const allOrders = await fetchOrdersByUser(userId)\n  \n  // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (paid=true –∏–ª–∏ payment_status='paid')\n  const paidOrders = allOrders.filter(order => {\n    const isPaid = order.paid === true || order.payment_status === \"paid\"\n    return isPaid\n  })\n  \n  // –°—á–∏—Ç–∞–µ–º –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã\n  const cancelledPaidOrders = paidOrders.filter(order => {\n    return order.order_status === \"cancelled\"\n  })\n  \n  const totalPaidOrders = paidOrders.length\n  const cancelledPaidOrdersCount = cancelledPaidOrders.length\n  const cancellationRate = totalPaidOrders > 0 ? (cancelledPaidOrdersCount / totalPaidOrders) * 100 : 0\n  \n  console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, {\n    totalPaidOrders,\n    cancelledPaidOrders: cancelledPaidOrdersCount,\n    cancellationRate: cancellationRate.toFixed(2) + '%',\n  })\n  \n  return {\n    totalPaidOrders,\n    cancelledPaidOrders: cancelledPaidOrdersCount,\n    cancellationRate,\n  }\n}\n\n/**\n * –í—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—É –±–ª—é–¥–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ—Ä—Ü–∏–∏\n * @param meal –û–±—ä–µ–∫—Ç –±–ª—é–¥–∞ —Å —Ü–µ–Ω–∞–º–∏\n * @param portionSize –†–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–∏\n * @returns –¶–µ–Ω–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞\n */\nexport function getMealPriceForPortion(meal: {\n  prices?: { single: number; medium?: number; large?: number }\n  portion?: \"single\" | \"medium\" | \"large\"\n}, portionSize?: \"single\" | \"medium\" | \"large\"): number {\n  if (!meal.prices) {\n    console.warn(`‚ö†Ô∏è Meal prices missing, returning 0`)\n    return 0\n  }\n  const portion = portionSize || meal.portion || \"single\"\n  if (portion === \"medium\" && meal.prices.medium) return meal.prices.medium\n  if (portion === \"large\" && meal.prices.large) return meal.prices.large\n  return meal.prices.single\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç –±–ª—é–¥–æ –ø–æ ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n * @param mealId ID –±–ª—é–¥–∞\n * @returns –û–±—ä–µ–∫—Ç –±–ª—é–¥–∞ –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n */\nexport async function fetchMealById(mealId: number): Promise<any | null> {\n  try {\n    const response = await serverFetch<NocoDBResponse<any>>(\"Meals\", {\n      where: `(Id,eq,${mealId})`,\n    })\n    \n    if (response.list && response.list.length > 0) {\n      const meal = response.list[0]\n      \n      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ü–µ–Ω—ã - NocoDB —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∫ \"Price (Single)\", \"Price (Medium)\", \"Price (Large)\"\n      const prices = {\n        single: meal[\"Price (Single)\"] || meal.prices?.single || 0,\n        medium: meal[\"Price (Medium)\"] || meal.prices?.medium || undefined,\n        large: meal[\"Price (Large)\"] || meal.prices?.large || undefined,\n      }\n      \n      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≥—Ä–∞–º–º–æ–≤–∫–∏ - NocoDB —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∫ \"Weight (Single)\", \"Weight (Medium)\", \"Weight (Large)\"\n      const weights = {\n        single: meal[\"Weight (Single)\"] || meal.weights?.single || 0,\n        medium: meal[\"Weight (Medium)\"] || meal.weights?.medium || undefined,\n        large: meal[\"Weight (Large)\"] || meal.weights?.large || undefined,\n      }\n      \n      return {\n        ...meal,\n        prices,\n        weights,\n      }\n    }\n    \n    return null\n  } catch (error) {\n    console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–ª—é–¥–∞ ${mealId} –∏–∑ –ë–î:`, error)\n    return null\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2241, "column": 0}, "map": {"version":3,"sources":["file:///Users/sergejasasnev/Downloads/my-project%20%281%29/app/api/orders/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport {\n  updateOrder,\n  fetchOrderPersons,\n  fetchOrderMeals,\n  fetchOrderExtras,\n  deleteOrderPerson,\n  deleteOrderMeal,\n  deleteOrderExtra,\n  createOrderPerson,\n  createOrderMeal,\n  createOrderExtra,\n  fetchOrderById,\n  generateOrderNumber,\n  calculateEarnedPoints,\n  calculateDeliveryFee,\n  awardLoyaltyPoints,\n  refundLoyaltyPoints,\n  fetchUserById,\n  getUserCancellationStats,\n  createFraudAlert,\n  processPendingTransactionsForOrder,\n  fetchPendingTransactionsByOrder,\n  updateLoyaltyTransaction,\n} from \"@/lib/nocodb\"\nimport type { Order, Meal, PortionSize } from \"@/lib/types\"\n\n// PATCH /api/orders/[id] - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞\nexport async function PATCH(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    console.log(`[PATCH /api/orders/${id}] Request received`)\n    const { order } = body as { order?: Order }\n    \n    let pendingPointsEarned = 0 // –•—Ä–∞–Ω–∏–º –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ API response\n\n    // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –∑–∞–∫–∞–∑–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ\n    if (order) {\n      console.log(`[PATCH /api/orders/${id}] Updating order with data:`, {\n        hasPersons: !!order.persons,\n        personsCount: order.persons?.length || 0,\n        paymentMethod: order.paymentMethod,\n        paymentStatus: order.paymentStatus,\n        paid: order.paid,\n      })\n      \n      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è order_number\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞\n      const currentOrder = await fetchOrderById(Number(id), true)\n      \n      if (!currentOrder) {\n        console.error(`[PATCH /api/orders/${id}] Order not found`)\n        return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑\n      // –†–∞–∑—Ä–µ—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤\n      const isPaymentOnlyUpdate = !order.persons && !order.extras && (\n        order.paid !== undefined || \n        order.paidAt !== undefined || \n        order.paymentStatus !== undefined || \n        order.paymentMethod !== undefined\n      )\n      \n      const today = new Date()\n      today.setHours(0, 0, 0, 0)\n      \n      const orderDate = currentOrder.start_date \n        ? new Date(currentOrder.start_date)\n        : null\n      if (orderDate) {\n        orderDate.setHours(0, 0, 0, 0)\n      }\n      \n      const isPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n      const isPastDate = orderDate && orderDate < today\n      const isToday = orderDate && orderDate.getTime() === today.getTime()\n      \n      // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–±–ª—é–¥, –ø–µ—Ä—Å–æ–Ω) –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤\n      // –ù–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã\n      if (!isPaymentOnlyUpdate && (isPaid || isPastDate || isToday)) {\n        const reason = isPaid \n          ? \"–ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω\" \n          : isToday \n          ? \"–î–æ—Å—Ç–∞–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è\" \n          : \"–ü—Ä–æ—à–µ–¥—à–∞—è –¥–∞—Ç–∞\"\n        console.error(`[PATCH /api/orders/${id}] Order is locked: ${reason}`)\n        return NextResponse.json({ \n          error: \"Order cannot be edited\",\n          reason,\n          details: isPaid \n            ? \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n            : isToday\n            ? \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n            : \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n        }, { status: 403 })\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã –∏ –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞–ª–ª–æ–≤\n      const wasPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n      const willBePaid = order.paid === true || order.paymentStatus === \"paid\"\n      const wasCancelled = currentOrder.order_status === \"cancelled\"\n      const willBeCancelled = order.orderStatus === \"cancelled\"\n      \n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞\n      // –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è PATCH –∏ DELETE\n      if (!wasCancelled && willBeCancelled && currentOrder.user_id) {\n        try {\n          const pointsEarned = typeof currentOrder.loyalty_points_earned === 'number' \n            ? currentOrder.loyalty_points_earned \n            : parseInt(String(currentOrder.loyalty_points_earned)) || 0\n          const pointsUsed = typeof currentOrder.loyalty_points_used === 'number'\n            ? currentOrder.loyalty_points_used\n            : parseInt(String(currentOrder.loyalty_points_used)) || 0\n          const orderTotal = typeof currentOrder.total === 'number'\n            ? currentOrder.total\n            : parseFloat(String(currentOrder.total)) || 0\n          const wasPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n\n          if (wasPaid) {\n            // –û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–ª—ã (–æ—Ç–º–µ–Ω—è–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ)\n            if (pointsEarned > 0 || pointsUsed > 0) {\n              await refundLoyaltyPoints(\n                currentOrder.user_id,\n                pointsEarned,\n                pointsUsed,\n                orderTotal,\n                Number(id)\n              )\n              console.log(`‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ ${id} –æ—Ç–º–µ–Ω–µ–Ω: –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${pointsUsed} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤, —Å–ø–∏—Å–∞–Ω–æ ${pointsEarned} –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö`)\n            }\n            \n            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ\n            try {\n              const stats = await getUserCancellationStats(currentOrder.user_id)\n              console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}:`, stats)\n              \n              if (stats.cancelledPaidOrders >= 3) {\n                console.warn(`üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${currentOrder.user_id} –æ—Ç–º–µ–Ω–∏–ª ${stats.cancelledPaidOrders} –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤`)\n                await createFraudAlert(currentOrder.user_id, stats)\n                console.log(`‚úÖ Fraud alert —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}`)\n              }\n            } catch (error) {\n              console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ:`, error)\n            }\n          } else {\n            // –ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ - –æ—Ç–º–µ–Ω—è–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n            const pendingTransactions = await fetchPendingTransactionsByOrder(Number(id))\n            console.log(`üîç –ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ ${id}. –ù–∞–π–¥–µ–Ω–æ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${pendingTransactions.length}`)\n            \n            if (pendingTransactions.length > 0) {\n              const now = new Date().toISOString()\n              for (const transaction of pendingTransactions) {\n                await updateLoyaltyTransaction(transaction.Id, {\n                  transaction_status: 'cancelled',\n                  processed_at: now,\n                })\n              }\n              console.log(`‚úÖ –û—Ç–º–µ–Ω–µ–Ω—ã ${pendingTransactions.length} pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}`)\n            } else {\n              console.log(`‚ÑπÔ∏è –ù–µ—Ç pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ${id}`)\n            }\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞:`, error)\n          // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞\n        }\n      }\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º order_number –µ—Å–ª–∏ –æ–Ω –±—ã–ª)\n      const now = new Date().toISOString()\n      let loyaltyPointsEarned = order.loyaltyPointsEarned !== undefined \n        ? order.loyaltyPointsEarned \n        : (typeof currentOrder.loyalty_points_earned === 'number' \n            ? currentOrder.loyalty_points_earned \n            : parseInt(String(currentOrder.loyalty_points_earned)) || 0)\n\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–ù–ê–ß–ê–õ–ê –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ–Ω—É —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –æ–Ω–ª–∞–π–Ω\n      // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –î–û –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –±–∞–ª–ª–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤\n      const oldPaymentMethod = currentOrder.payment_method || (currentOrder as any)[\"Payment Method\"]\n      const isPaymentMethodChangedFromCash = oldPaymentMethod === 'cash' && \n        order?.paymentMethod && \n        (order.paymentMethod === 'card' || order.paymentMethod === 'sbp')\n      \n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ –∑–∞–∫–∞–∑–µ\n      // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ù–ï–ó–ê–í–ò–°–ò–ú–û –æ—Ç —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã –∏ —Å—Ç–∞—Ç—É—Å–∞ paid\n      if (currentOrder.user_id && order.loyaltyPointsUsed && order.loyaltyPointsUsed > 0) {\n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∏ –ª–∏ –±–∞–ª–ª—ã —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã\n          const existingPointsUsed = typeof currentOrder.loyalty_points_used === 'number' \n            ? currentOrder.loyalty_points_used \n            : parseInt(String(currentOrder.loyalty_points_used)) || 0\n          \n          // –°–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–Ω–µ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ)\n          if (existingPointsUsed === 0 && order.loyaltyPointsUsed > 0) {\n            console.log(`\\nüîç ========== –°–ü–ò–°–ê–ù–ò–ï –ë–ê–õ–õ–û–í (PATCH) ==========`)\n            console.log(`üí≥ –°–ø–∏—Å—ã–≤–∞–µ–º ${order.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}`)\n            \n            const now = new Date().toISOString()\n            const { createLoyaltyPointsTransaction, updateUser, fetchUserById } = await import(\"@/lib/nocodb\")\n            \n            // ‚úÖ –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –±–∞–ª–ª–æ–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n            const user = await fetchUserById(currentOrder.user_id, true)\n            if (!user) {\n              console.error(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${currentOrder.user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω`)\n              throw new Error(`User ${currentOrder.user_id} not found`)\n            }\n            \n            const currentBalance = typeof user.loyalty_points === 'number' \n              ? user.loyalty_points \n              : parseFloat(String(user.loyalty_points)) || 0\n            \n            console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º:`, {\n              userId: currentOrder.user_id,\n              currentBalance,\n              requestedToUse: order.loyaltyPointsUsed,\n              sufficient: currentBalance >= order.loyaltyPointsUsed\n            })\n            \n            if (currentBalance < order.loyaltyPointsUsed) {\n              console.warn(`‚ö†Ô∏è –ó–ê–©–ò–¢–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è!`, {\n                available: currentBalance,\n                requested: order.loyaltyPointsUsed,\n                deficit: order.loyaltyPointsUsed - currentBalance\n              })\n              console.log(`‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ø–∏—Å–∞–Ω–∏–µ - –≤–æ–∑–º–æ–∂–Ω–æ –±–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã —Ä–∞–Ω–µ–µ`)\n              console.log(`üîç ========== –ö–û–ù–ï–¶ –°–ü–ò–°–ê–ù–ò–Ø –ë–ê–õ–õ–û–í (–ø—Ä–æ–ø—É—â–µ–Ω–æ) ==========\\n`)\n              // –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é\n              // –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ race condition\n            } else {\n              // –ë–∞–ª–ª–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ - —Å–ø–∏—Å—ã–≤–∞–µ–º\n              \n              // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ\n              await createLoyaltyPointsTransaction({\n              user_id: currentOrder.user_id,\n              order_id: Number(id),\n              transaction_type: \"used\",\n              transaction_status: \"completed\",\n              points: -order.loyaltyPointsUsed,\n              description: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${order.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞`,\n              created_at: now,\n              updated_at: now,\n              processed_at: now,\n            })\n            console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"used\" —Å–æ–∑–¥–∞–Ω–∞: -${order.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤`)\n            \n            // –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n            const newBalance = currentBalance - order.loyaltyPointsUsed\n            \n            await updateUser(currentOrder.user_id, {\n              loyalty_points: newBalance,\n              updated_at: now,\n            })\n            \n            console.log(`‚úÖ –ë–∞–ª–ª—ã —Å–ø–∏—Å–∞–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}:`, {\n              oldBalance: currentBalance,\n              used: order.loyaltyPointsUsed,\n              newBalance,\n            })\n            \n            console.log(`üîç ========== –ö–û–ù–ï–¶ –°–ü–ò–°–ê–ù–ò–Ø –ë–ê–õ–õ–û–í ==========\\n`)\n            }\n          } else {\n            console.log(`‚ÑπÔ∏è –ë–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã —Ä–∞–Ω–µ–µ (${existingPointsUsed}) –∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å`)\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤:`, error)\n          // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞\n        }\n      }\n      \n      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞–∫–∞–∑–∞\n      if (!wasPaid && willBePaid && currentOrder.user_id) {\n        console.log(`\\nüîç ========== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH full order) ==========`)\n        console.log(`üîç [PATCH ${id}] 1Ô∏è‚É£ –í—Ö–æ–¥—è—â–∏–π payload:`, {\n          'order.loyaltyPointsUsed': order.loyaltyPointsUsed,\n          'order.loyaltyPointsEarned': order.loyaltyPointsEarned,\n          'order.paymentMethod': order.paymentMethod,\n          'order.paid': order.paid,\n          'order.paymentStatus': order.paymentStatus,\n          'order.subtotal': order.subtotal,\n          'order.total': order.total,\n          userId: currentOrder.user_id,\n        })\n        \n        console.log(`üîç [PATCH ${id}] –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞:`, {\n          'currentOrder.total': currentOrder.total,\n          'currentOrder.subtotal': currentOrder.subtotal,\n          'currentOrder.delivery_fee': currentOrder.delivery_fee,\n          'currentOrder.loyalty_points_earned': currentOrder.loyalty_points_earned,\n          'currentOrder.loyalty_points_used': currentOrder.loyalty_points_used,\n        })\n        \n        try {\n          // ‚úÖ –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∏ –ª–∏ –±–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã\n          const existingPointsEarned = typeof currentOrder.loyalty_points_earned === 'number' \n            ? currentOrder.loyalty_points_earned \n            : parseInt(String(currentOrder.loyalty_points_earned)) || 0\n          \n          console.log(`üîç [PATCH ${id}] 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤:`, {\n            existingPointsEarned,\n            hasExistingPoints: existingPointsEarned > 0,\n          })\n          \n          if (existingPointsEarned > 0) {\n            console.warn(`‚ö†Ô∏è –ó–ê–©–ò–¢–ê –û–¢ –î–í–û–ô–ù–û–ì–û –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø: –ë–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}: ${existingPointsEarned}. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ.`)\n            loyaltyPointsEarned = existingPointsEarned\n          } else if (isPaymentMethodChangedFromCash) {\n            // ‚úÖ –ù–û–í–ê–Ø –ó–ê–©–ò–¢–ê: –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ –∏ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç—É/–°–ë–ü,\n            // –ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã, –∞ —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∏–∂–µ\n            console.log(`üîç [PATCH ${id}] 3Ô∏è‚É£ –°–º–µ–Ω–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ª–∏—á–Ω—ã—Ö:`, {\n              oldPaymentMethod,\n              newPaymentMethod: order.paymentMethod,\n            })\n            console.log(`üí≥ –ó–∞–∫–∞–∑ ${id}: —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∏–∑–º–µ–Ω–µ–Ω —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ ${order.paymentMethod}. Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –Ω–∏–∂–µ, –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã –ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º.`)\n            loyaltyPointsEarned = 0\n          } else {\n            console.log(`üîç [PATCH ${id}] 4Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤`)\n            const user = await fetchUserById(currentOrder.user_id)\n            if (user) {\n              console.log(`üîç [PATCH ${id}] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:`, {\n                userId: user.Id,\n                loyaltyPoints: user.loyalty_points,\n                totalSpent: user.total_spent,\n              })\n              \n              const orderTotal = order.total || (typeof currentOrder.total === 'number' \n                ? currentOrder.total \n                : parseFloat(String(currentOrder.total)) || 0)\n              const pointsUsed = order.loyaltyPointsUsed !== undefined \n                ? order.loyaltyPointsUsed \n                : (typeof currentOrder.loyalty_points_used === 'number'\n                    ? currentOrder.loyalty_points_used\n                    : parseInt(String(currentOrder.loyalty_points_used)) || 0)\n              const currentTotalSpent = typeof user.total_spent === 'number' \n                ? user.total_spent \n                : parseFloat(String(user.total_spent)) || 0\n\n              console.log(`üîç [PATCH ${id}] 5Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:`, {\n                orderTotal,\n                pointsUsed,\n                currentTotalSpent,\n                loyaltyLevel: currentTotalSpent >= 50000 ? \"gold\" : currentTotalSpent >= 20000 ? \"silver\" : \"bronze\",\n              })\n\n              // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª—è–µ–º—ã–µ –±–∞–ª–ª—ã\n              console.log(`üîç [PATCH ${id}] 6Ô∏è‚É£ –í—ã–∑–æ–≤ calculateEarnedPoints —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:`, {\n                orderTotal,\n                pointsUsed,\n                currentTotalSpent,\n              })\n              loyaltyPointsEarned = calculateEarnedPoints(orderTotal, pointsUsed, currentTotalSpent)\n              \n              console.log(`üîç [PATCH ${id}] 7Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç calculateEarnedPoints:`, {\n                loyaltyPointsEarned,\n              })\n              \n              // –ù–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n              console.log(`üîç [PATCH ${id}] 8Ô∏è‚É£ –í—ã–∑–æ–≤ awardLoyaltyPoints —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:`, {\n                userId: currentOrder.user_id,\n                orderTotal,\n                pointsUsed,\n                loyaltyPointsEarned,\n                orderId: id,\n              })\n              await awardLoyaltyPoints(currentOrder.user_id, orderTotal, pointsUsed, loyaltyPointsEarned, Number(id))\n              \n              console.log(`üîç [PATCH ${id}] 9Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç awardLoyaltyPoints: —É—Å–ø–µ—à–Ω–æ`)\n              console.log(`‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ ${loyaltyPointsEarned} –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${currentOrder.user_id} –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞–∫–∞–∑–∞ ${id}`)\n            }\n          }\n          console.log(`üîç ========== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH full order) ==========\\n`)\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ:`, error)\n          // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º order_number –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n      const existingOrderNumber = (currentOrder as any)?.order_number ?? (currentOrder as any)?.[\"Order Number\"]\n      const finalOrderNumber = existingOrderNumber ?? order.orderNumber ?? generateOrderNumber()\n      \n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ currentOrder –¥–ª—è –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ order\n      const existingStartDate = currentOrder.start_date || (currentOrder as any)[\"Start Date\"]\n      const existingDeliveryTime = currentOrder.delivery_time || (currentOrder as any)[\"Delivery Time\"]\n      const existingSubtotal = currentOrder.subtotal || (currentOrder as any)[\"Subtotal\"] || 0\n      const existingTotal = currentOrder.total || (currentOrder as any)[\"Total\"] || 0\n      \n      const updatedOrder = await updateOrder(Number(id), {\n        order_number: finalOrderNumber,\n        start_date: order.startDate \n          ? (typeof order.startDate === \"string\" ? order.startDate : order.startDate.toISOString().split(\"T\")[0])\n          : existingStartDate,\n        delivery_time: order.deliveryTime || existingDeliveryTime,\n        \n        // –ù–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã\n        payment_status: order.paymentStatus || (order.paid ? \"paid\" : \"pending\"),\n        payment_method: order.paymentMethod || \"cash\",\n        paid: order.paid !== undefined ? order.paid : currentOrder.paid,\n        paid_at: order.paidAt || (order.paid ? now : currentOrder.paid_at),\n        payment_id: order.paymentId || undefined,\n        \n        // –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞\n        order_status: order.orderStatus || currentOrder.order_status || \"pending\",\n        \n        // –£–î–ê–õ–ï–ù–û: delivered, cancelled, status - —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —É–±—Ä–∞–Ω—ã\n        \n        promo_code: order.promoCode !== undefined ? order.promoCode : currentOrder.promo_code,\n        promo_discount: order.promoDiscount !== undefined ? order.promoDiscount : currentOrder.promo_discount,\n        loyalty_points_used: order.loyaltyPointsUsed !== undefined \n          ? order.loyaltyPointsUsed \n          : (typeof currentOrder.loyalty_points_used === 'number'\n              ? currentOrder.loyalty_points_used\n              : parseInt(String(currentOrder.loyalty_points_used)) || 0),\n        loyalty_points_earned: loyaltyPointsEarned,\n        subtotal: (order.subtotal !== undefined && order.subtotal !== null) ? order.subtotal : existingSubtotal,\n        total: (order.total !== undefined && order.total !== null) ? order.total : existingTotal,\n        guest_phone: order.guestPhone !== undefined ? order.guestPhone : currentOrder.guest_phone,\n        guest_address: order.guestAddress !== undefined ? order.guestAddress : currentOrder.guest_address,\n        updated_at: now,\n      })\n\n      // ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –µ—Å–ª–∏ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∏–∑–º–µ–Ω–∏–ª—Å—è —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –æ–Ω–ª–∞–π–Ω\n      if (isPaymentMethodChangedFromCash) {\n        console.log(`üí≥ –ó–∞–∫–∞–∑ ${id} –æ–ø–ª–∞—á–µ–Ω –æ–Ω–ª–∞–π–Ω (–±—ã–ª–æ: ${oldPaymentMethod}, —Å—Ç–∞–ª–æ: ${order.paymentMethod}), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending –±–∞–ª–ª—ã`)\n        \n        try {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞\n          pendingPointsEarned = await processPendingTransactionsForOrder(Number(id), currentOrder.user_id)\n          \n          if (pendingPointsEarned > 0) {\n            console.log(`‚úÖ Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –Ω–∞—á–∏—Å–ª–µ–Ω–æ ${pendingPointsEarned} –±–∞–ª–ª–æ–≤`)\n            loyaltyPointsEarned = pendingPointsEarned // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–ª–ª—ã –∏–∑ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n          } else {\n            console.log(`‚úÖ Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –±–∞–ª–ª–æ–≤ –Ω–µ –±—ã–ª–æ`)\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}:`, error)\n          // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞\n        }\n      }\n\n      // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ\n      if (!isPaymentOnlyUpdate) {\n        // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä—Å–æ–Ω—ã, –±–ª—é–¥–∞ –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è\n        const existingPersons = await fetchOrderPersons(Number(id))\n        const existingExtras = await fetchOrderExtras(Number(id))\n\n        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±–ª—é–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä—Å–æ–Ω—ã\n        for (const person of existingPersons) {\n          try {\n            const meals = await fetchOrderMeals(person.Id)\n            for (const meal of meals) {\n              try {\n                await deleteOrderMeal(meal.Id)\n              } catch (error) {\n                console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å meal ${meal.Id}:`, error)\n                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å\n              }\n            }\n            await deleteOrderPerson(person.Id)\n          } catch (error) {\n            console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ person ${person.Id}:`, error)\n            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–º–∏\n          }\n        }\n\n        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è\n        for (const extra of existingExtras) {\n          try {\n            await deleteOrderExtra(extra.Id)\n          } catch (error) {\n            console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å extra ${extra.Id}:`, error)\n            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å\n          }\n        }\n\n        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –ø–µ—Ä—Å–æ–Ω—ã –∏ –±–ª—é–¥–∞\n        if (order.persons && order.persons.length > 0) {\n          for (const person of order.persons) {\n            const nocoOrderPerson = await createOrderPerson({\n              order_id: Number(id),\n              person_number: person.id,\n            })\n\n            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–ª—é–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è\n            for (const day of [\"day1\", \"day2\"] as const) {\n              const dayMeals = person[day]\n              if (!dayMeals) continue\n\n              // –ó–∞–≤—Ç—Ä–∞–∫\n              if (dayMeals.breakfast?.dish) {\n                await saveMeal(nocoOrderPerson.Id, day, \"breakfast\", \"dish\", dayMeals.breakfast.dish)\n              }\n\n              // –û–±–µ–¥\n              if (dayMeals.lunch) {\n                if (dayMeals.lunch.salad) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"lunch\", \"salad\", dayMeals.lunch.salad)\n                }\n                if (dayMeals.lunch.soup) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"lunch\", \"soup\", dayMeals.lunch.soup)\n                }\n                if (dayMeals.lunch.main) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"lunch\", \"main\", dayMeals.lunch.main)\n                }\n              }\n\n              // –£–∂–∏–Ω\n              if (dayMeals.dinner) {\n                if (dayMeals.dinner.salad) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"dinner\", \"salad\", dayMeals.dinner.salad)\n                }\n                if (dayMeals.dinner.soup) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"dinner\", \"soup\", dayMeals.dinner.soup)\n                }\n                if (dayMeals.dinner.main) {\n                  await saveMeal(nocoOrderPerson.Id, day, \"dinner\", \"main\", dayMeals.dinner.main)\n                }\n              }\n            }\n          }\n        }\n\n        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è\n        if (order.extras && order.extras.length > 0) {\n          for (const extra of order.extras) {\n            await createOrderExtra({\n              order_id: Number(id),\n              extra_id: extra.id,\n              quantity: extra.quantity,\n              price: extra.price,\n            })\n          }\n        }\n      }\n\n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ —Å order_number\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ updatedOrder —Å —Ç–µ–º, —á—Ç–æ –º—ã —Ç–æ—á–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç start_date –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n      const normalizeStartDate = (date: any): string => {\n        if (!date) return \"\"\n        if (typeof date === \"string\") {\n          // –ï—Å–ª–∏ —ç—Ç–æ ISO timestamp, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É\n          if (date.includes(\"T\")) {\n            return date.split(\"T\")[0]\n          }\n          // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å\n          return date\n        }\n        // –ï—Å–ª–∏ —ç—Ç–æ Date –æ–±—ä–µ–∫—Ç\n        if (date instanceof Date) {\n          return date.toISOString().split(\"T\")[0]\n        }\n        return String(date)\n      }\n      \n      const mergedOrder = {\n        ...updatedOrder,\n        // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã\n        loyalty_points_used: order.loyaltyPointsUsed !== undefined \n          ? order.loyaltyPointsUsed \n          : updatedOrder.loyalty_points_used,\n        loyalty_points_earned: loyaltyPointsEarned !== undefined\n          ? loyaltyPointsEarned\n          : updatedOrder.loyalty_points_earned,\n        // ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º start_date –∫ —Ñ–æ—Ä–º–∞—Ç—É YYYY-MM-DD\n        start_date: normalizeStartDate(updatedOrder.start_date || (updatedOrder as any)[\"Start Date\"]),\n      }\n      \n      return NextResponse.json({ \n        success: true, \n        order: mergedOrder,\n        orderNumber: (mergedOrder as any)?.order_number ?? (mergedOrder as any)?.[\"Order Number\"] \n      })\n    } else {\n      // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç–∏—á–Ω—ã–π –æ–±—ä–µ–∫—Ç (–±–µ–∑ order), –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è\n      // –≠—Ç–æ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã\n      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º camelCase –≤ snake_case –¥–ª—è NocoDB\n      const updateData: any = {}\n      if (body.paid !== undefined) updateData.paid = body.paid\n      if (body.paid_at !== undefined) updateData.paid_at = body.paid_at\n      if (body.paidAt !== undefined) updateData.paid_at = body.paidAt\n      if (body.payment_method !== undefined) updateData.payment_method = body.payment_method\n      if (body.paymentMethod !== undefined) updateData.payment_method = body.paymentMethod\n      if (body.payment_status !== undefined) updateData.payment_status = body.payment_status\n      if (body.paymentStatus !== undefined) updateData.payment_status = body.paymentStatus\n      if (body.updated_at !== undefined) updateData.updated_at = body.updated_at\n      if (body.updatedAt !== undefined) updateData.updated_at = body.updatedAt\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ pending –±–∞–ª–ª—ã\n      if (pendingPointsEarned > 0) {\n        updateData.loyalty_points_earned = pendingPointsEarned\n      }\n      \n      // –î–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ä–∞–∑—Ä–µ—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã –¥–∞–∂–µ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç—ã (–Ω–µ—Ç persons/extras)\n      const isPaymentOnlyUpdate = !body.persons && !body.extras && (\n        body.paid !== undefined || \n        body.paidAt !== undefined || \n        body.paid_at !== undefined ||\n        body.paymentStatus !== undefined || \n        body.payment_status !== undefined ||\n        body.paymentMethod !== undefined ||\n        body.payment_method !== undefined\n      )\n      \n      console.log(`[PATCH /api/orders/${id}] Partial update - isPaymentOnlyUpdate: ${isPaymentOnlyUpdate}`, {\n        hasPersons: !!body.persons,\n        hasExtras: !!body.extras,\n        hasPaid: body.paid !== undefined,\n        hasPaidAt: body.paidAt !== undefined || body.paid_at !== undefined,\n        hasPaymentStatus: body.paymentStatus !== undefined || body.payment_status !== undefined,\n        hasPaymentMethod: body.paymentMethod !== undefined || body.payment_method !== undefined,\n      })\n      \n      // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É\n      if (!isPaymentOnlyUpdate) {\n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞\n        const currentOrder = await fetchOrderById(Number(id), true)\n        if (currentOrder) {\n          const today = new Date()\n          today.setHours(0, 0, 0, 0)\n          \n          const orderDate = currentOrder.start_date \n            ? new Date(currentOrder.start_date)\n            : null\n          if (orderDate) {\n            orderDate.setHours(0, 0, 0, 0)\n          }\n          \n          const isPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n          const isPastDate = orderDate && orderDate < today\n          const isToday = orderDate && orderDate.getTime() === today.getTime()\n          \n          if (isPaid || isPastDate || isToday) {\n            const reason = isPaid \n              ? \"–ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω\" \n              : isToday \n              ? \"–î–æ—Å—Ç–∞–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è\" \n              : \"–ü—Ä–æ—à–µ–¥—à–∞—è –¥–∞—Ç–∞\"\n            console.error(`[PATCH /api/orders/${id}] Order is locked: ${reason}`)\n            return NextResponse.json({ \n              error: \"Order cannot be edited\",\n              reason,\n              details: isPaid \n                ? \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n                : isToday\n                ? \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n                : \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\"\n            }, { status: 403 })\n          }\n        }\n      } else {\n        console.log(`[PATCH /api/orders/${id}] Payment-only update - skipping lock check`)\n      }\n      \n      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞–ª–ª–æ–≤\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞\n      const currentOrder = await fetchOrderById(Number(id), true)\n      if (!currentOrder) {\n        return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞–ª–ª–æ–≤\n      const wasPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n      const willBePaid = updateData.paid === true || updateData.payment_status === \"paid\"\n      const willBeCancelled = body.orderStatus === \"cancelled\" || body.order_status === \"cancelled\"\n      const wasCancelled = currentOrder.order_status === \"cancelled\"\n\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ (–¥–ª—è partial update)\n      // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ù–ï–ó–ê–í–ò–°–ò–ú–û –æ—Ç —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã –∏ —Å—Ç–∞—Ç—É—Å–∞ paid\n      if (currentOrder.user_id && body.loyaltyPointsUsed && body.loyaltyPointsUsed > 0) {\n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∏ –ª–∏ –±–∞–ª–ª—ã —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã\n          const existingPointsUsed = typeof currentOrder.loyalty_points_used === 'number' \n            ? currentOrder.loyalty_points_used \n            : parseInt(String(currentOrder.loyalty_points_used)) || 0\n          \n          // –°–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–Ω–µ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ)\n          if (existingPointsUsed === 0 && body.loyaltyPointsUsed > 0) {\n            console.log(`\\nüîç ========== –°–ü–ò–°–ê–ù–ò–ï –ë–ê–õ–õ–û–í (PATCH partial) ==========`)\n            console.log(`üí≥ –°–ø–∏—Å—ã–≤–∞–µ–º ${body.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}`)\n            \n            const now = new Date().toISOString()\n            const { createLoyaltyPointsTransaction, updateUser, fetchUserById } = await import(\"@/lib/nocodb\")\n            \n            // ‚úÖ –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –±–∞–ª–ª–æ–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n            const user = await fetchUserById(currentOrder.user_id, true)\n            if (!user) {\n              console.error(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${currentOrder.user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω`)\n              throw new Error(`User ${currentOrder.user_id} not found`)\n            }\n            \n            const currentBalance = typeof user.loyalty_points === 'number' \n              ? user.loyalty_points \n              : parseFloat(String(user.loyalty_points)) || 0\n            \n            console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º:`, {\n              userId: currentOrder.user_id,\n              currentBalance,\n              requestedToUse: body.loyaltyPointsUsed,\n              sufficient: currentBalance >= body.loyaltyPointsUsed\n            })\n            \n            if (currentBalance < body.loyaltyPointsUsed) {\n              console.warn(`‚ö†Ô∏è –ó–ê–©–ò–¢–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è!`, {\n                available: currentBalance,\n                requested: body.loyaltyPointsUsed,\n                deficit: body.loyaltyPointsUsed - currentBalance\n              })\n              console.log(`‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ø–∏—Å–∞–Ω–∏–µ - –≤–æ–∑–º–æ–∂–Ω–æ –±–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã —Ä–∞–Ω–µ–µ`)\n              console.log(`üîç ========== –ö–û–ù–ï–¶ –°–ü–ò–°–ê–ù–ò–Ø –ë–ê–õ–õ–û–í (–ø—Ä–æ–ø—É—â–µ–Ω–æ) ==========\\n`)\n              // –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é\n              // –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ race condition\n            } else {\n              // –ë–∞–ª–ª–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ - —Å–ø–∏—Å—ã–≤–∞–µ–º\n              \n              // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ\n              await createLoyaltyPointsTransaction({\n                user_id: currentOrder.user_id,\n                order_id: Number(id),\n                transaction_type: \"used\",\n                transaction_status: \"completed\",\n                points: -body.loyaltyPointsUsed,\n                description: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${body.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞`,\n                created_at: now,\n                updated_at: now,\n                processed_at: now,\n              })\n              console.log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è \"used\" —Å–æ–∑–¥–∞–Ω–∞: -${body.loyaltyPointsUsed} –±–∞–ª–ª–æ–≤`)\n              \n              // –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n              const newBalance = currentBalance - body.loyaltyPointsUsed\n              \n              await updateUser(currentOrder.user_id, {\n                loyalty_points: newBalance,\n                updated_at: now,\n              })\n              \n              console.log(`‚úÖ –ë–∞–ª–ª—ã —Å–ø–∏—Å–∞–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}:`, {\n                oldBalance: currentBalance,\n                used: body.loyaltyPointsUsed,\n                newBalance,\n              })\n            }\n            \n            // –û–±–Ω–æ–≤–ª—è–µ–º loyalty_points_used –≤ updateData\n            updateData.loyalty_points_used = body.loyaltyPointsUsed\n            \n            console.log(`üîç ========== –ö–û–ù–ï–¶ –°–ü–ò–°–ê–ù–ò–Ø –ë–ê–õ–õ–û–í ==========\\n`)\n          } else {\n            console.log(`‚ÑπÔ∏è –ë–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã —Ä–∞–Ω–µ–µ (${existingPointsUsed}) –∏–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å`)\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ (partial):`, error)\n          // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞\n        }\n      }\n\n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞\n      if (!wasCancelled && willBeCancelled && currentOrder.user_id) {\n        try {\n          const pointsEarned = typeof currentOrder.loyalty_points_earned === 'number' \n            ? currentOrder.loyalty_points_earned \n            : parseInt(String(currentOrder.loyalty_points_earned)) || 0\n          const pointsUsed = typeof currentOrder.loyalty_points_used === 'number'\n            ? currentOrder.loyalty_points_used\n            : parseInt(String(currentOrder.loyalty_points_used)) || 0\n          const orderTotal = typeof currentOrder.total === 'number'\n            ? currentOrder.total\n            : parseFloat(String(currentOrder.total)) || 0\n\n          const wasPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n          \n          // –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –±—ã–ª –æ–ø–ª–∞—á–µ–Ω\n          if (!wasPaid && (pointsEarned > 0 || pointsUsed > 0)) {\n            await refundLoyaltyPoints(\n              currentOrder.user_id,\n              pointsEarned,\n              pointsUsed,\n              orderTotal,\n              Number(id)\n            )\n            console.log(`‚úÖ –°–ø–∏—Å–∞–Ω–æ ${pointsEarned} –±–∞–ª–ª–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${pointsUsed} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ${id}`)\n          } else if (wasPaid) {\n            console.log(`‚ÑπÔ∏è –ó–∞–∫–∞–∑ ${id} –±—ã–ª –æ–ø–ª–∞—á–µ–Ω, –±–∞–ª–ª—ã –Ω–µ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ`)\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞:`, error)\n        }\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –æ–Ω–ª–∞–π–Ω (–¥–ª—è partial update)\n      const oldPaymentMethodPartial = currentOrder.payment_method || (currentOrder as any)[\"Payment Method\"]\n      const newPaymentMethod = updateData.payment_method\n      \n      if (oldPaymentMethodPartial === 'cash' && \n          (newPaymentMethod === 'card' || newPaymentMethod === 'sbp')) {\n        \n        console.log(`üí≥ Partial update: –ó–∞–∫–∞–∑ ${id} –æ–ø–ª–∞—á–µ–Ω –æ–Ω–ª–∞–π–Ω (–±—ã–ª–æ: ${oldPaymentMethodPartial}, —Å—Ç–∞–ª–æ: ${newPaymentMethod}), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending –±–∞–ª–ª—ã`)\n        \n        try {\n          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞\n          const earnedPoints = await processPendingTransactionsForOrder(Number(id), currentOrder.user_id)\n          \n          if (earnedPoints > 0) {\n            pendingPointsEarned = earnedPoints\n            updateData.loyalty_points_earned = earnedPoints\n            console.log(`‚úÖ Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –Ω–∞—á–∏—Å–ª–µ–Ω–æ ${earnedPoints} –±–∞–ª–ª–æ–≤`)\n          } else {\n            console.log(`‚ÑπÔ∏è Pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã`)\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}:`, error)\n        }\n      }\n      \n      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –Ω–∞–ª–∏—á–Ω—ã–µ, —Å—Ç–∞–≤—à–∏–µ –æ–Ω–ª–∞–π–Ω)\n      // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –±—ã–ª –æ–ø–ª–∞—á–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –±–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã\n      // –ù–∞—á–∏—Å–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –≤ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π\n      // –ò –µ—Å–ª–∏ —ç—Ç–æ –ù–ï —Å–ª—É—á–∞–π —Å pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (–æ–Ω–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤—ã—à–µ)\n      \n      // ‚úÖ –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∏ –ª–∏ –±–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏\n      const existingPointsEarnedPartial = typeof currentOrder.loyalty_points_earned === 'number' \n        ? currentOrder.loyalty_points_earned \n        : parseInt(String(currentOrder.loyalty_points_earned)) || 0\n      \n      console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ ${id}:`, {\n        wasPaid,\n        willBePaid,\n        'currentOrder.user_id': currentOrder.user_id,\n        'currentOrder.loyalty_points_earned': existingPointsEarnedPartial,\n        pendingPointsEarned,\n        condition: !wasPaid && willBePaid && currentOrder.user_id && pendingPointsEarned === 0 && existingPointsEarnedPartial === 0\n      })\n      \n      if (existingPointsEarnedPartial > 0) {\n        console.warn(`‚ö†Ô∏è –ó–ê–©–ò–¢–ê –û–¢ –î–í–û–ô–ù–û–ì–û –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø (partial update): –ë–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}: ${existingPointsEarnedPartial}. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ.`)\n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ updateData\n        updateData.loyalty_points_earned = existingPointsEarnedPartial\n      } else if (!wasPaid && willBePaid && currentOrder.user_id && pendingPointsEarned === 0) {\n        console.log(`\\nüîç ========== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH partial) ==========`)\n        console.log(`üîç [PATCH partial ${id}] 1Ô∏è‚É£ –í—Ö–æ–¥—è—â–∏–π payload (updateData):`, {\n          paid: updateData.paid,\n          payment_status: updateData.payment_status,\n          payment_method: updateData.payment_method,\n        })\n        \n        console.log(`üîç [PATCH partial ${id}] –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞:`, {\n          'currentOrder.total': currentOrder.total,\n          'currentOrder.subtotal': currentOrder.subtotal,\n          'currentOrder.delivery_fee': currentOrder.delivery_fee,\n          'currentOrder.loyalty_points_earned': currentOrder.loyalty_points_earned,\n          'currentOrder.loyalty_points_used': currentOrder.loyalty_points_used,\n        })\n        \n        try {\n          // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞\n          const user = await fetchUserById(currentOrder.user_id, true)\n          if (user) {\n            console.log(`üîç [PATCH partial ${id}] 2Ô∏è‚É£ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:`, {\n              userId: user.Id,\n              loyaltyPoints: user.loyalty_points,\n              totalSpent: user.total_spent,\n            })\n            \n            // ‚úÖ –£–õ–£–ß–®–ï–ù–û: –ü–æ–ª—É—á–∞–µ–º —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–ª–µ–π\n            let orderTotal = typeof currentOrder.total === 'number' \n              ? currentOrder.total \n              : typeof (currentOrder as any).Total === 'number'\n              ? (currentOrder as any).Total\n              : parseFloat(String(currentOrder.total || (currentOrder as any).Total || 0)) || 0\n            \n            // –ï—Å–ª–∏ total = 0, –ø—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∏–∑ subtotal + delivery_fee\n            if (orderTotal === 0) {\n              const subtotal = typeof currentOrder.subtotal === 'number'\n                ? currentOrder.subtotal\n                : typeof (currentOrder as any).Subtotal === 'number'\n                ? (currentOrder as any).Subtotal\n                : parseFloat(String(currentOrder.subtotal || (currentOrder as any).Subtotal || 0)) || 0\n              \n              const deliveryFee = typeof currentOrder.delivery_fee === 'number'\n                ? currentOrder.delivery_fee\n                : typeof (currentOrder as any)['Delivery Fee'] === 'number'\n                ? (currentOrder as any)['Delivery Fee']\n                : parseFloat(String(currentOrder.delivery_fee || (currentOrder as any)['Delivery Fee'] || 0)) || 0\n              \n              if (subtotal > 0) {\n                const promoDiscount = typeof currentOrder.promo_discount === 'number'\n                  ? currentOrder.promo_discount\n                  : parseFloat(String(currentOrder.promo_discount || 0)) || 0\n                \n                orderTotal = subtotal + deliveryFee - promoDiscount\n                console.log(`‚ÑπÔ∏è Total –±—ã–ª 0, –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –∏–∑ subtotal + delivery_fee: ${subtotal} + ${deliveryFee} - ${promoDiscount} = ${orderTotal}`)\n              }\n            }\n            \n            console.log(`üîç [PATCH partial ${id}] 3Ô∏è‚É£ –†–∞—Å—á–µ—Ç orderTotal:`, {\n              'currentOrder.total': currentOrder.total,\n              'currentOrder.Total': (currentOrder as any).Total,\n              'currentOrder.subtotal': currentOrder.subtotal,\n              'currentOrder.delivery_fee': currentOrder.delivery_fee,\n              'calculated orderTotal': orderTotal,\n            })\n            \n            const pointsUsed = typeof currentOrder.loyalty_points_used === 'number'\n              ? currentOrder.loyalty_points_used\n              : parseInt(String(currentOrder.loyalty_points_used)) || 0\n            const currentTotalSpent = typeof user.total_spent === 'number' \n              ? user.total_spent \n              : parseFloat(String(user.total_spent)) || 0\n\n            console.log(`üîç [PATCH partial ${id}] 4Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:`, {\n              orderTotal,\n              pointsUsed,\n              currentTotalSpent,\n              loyaltyLevel: currentTotalSpent >= 50000 ? \"gold\" : currentTotalSpent >= 20000 ? \"silver\" : \"bronze\",\n            })\n\n            // ‚úÖ –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ orderTotal –≤—Å–µ –µ—â–µ 0, –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã\n            if (orderTotal <= 0) {\n              console.warn(`‚ö†Ô∏è PATCH ${id}: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã - orderTotal = ${orderTotal}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î!`)\n            } else {\n              // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª—è–µ–º—ã–µ –±–∞–ª–ª—ã\n              console.log(`üîç [PATCH partial ${id}] 5Ô∏è‚É£ –í—ã–∑–æ–≤ calculateEarnedPoints —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:`, {\n                orderTotal,\n                pointsUsed,\n                currentTotalSpent,\n              })\n              const loyaltyPointsEarned = calculateEarnedPoints(orderTotal, pointsUsed, currentTotalSpent)\n              \n              console.log(`üîç [PATCH partial ${id}] 6Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç calculateEarnedPoints:`, {\n                loyaltyPointsEarned,\n              })\n              \n              console.log(`üí∞ –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ ${loyaltyPointsEarned} –±–∞–ª–ª–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id} (orderTotal: ${orderTotal}, pointsUsed: ${pointsUsed})`)\n              \n              if (loyaltyPointsEarned > 0) {\n                // –ù–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n                // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –ü—Ä–∏ partial update (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã)\n                // –±–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã —Ä–∞–Ω–µ–µ, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–¥–∞–µ–º pointsUsed=0\n                // —á—Ç–æ–±—ã –Ω–µ —Å–ø–∏—Å—ã–≤–∞—Ç—å –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤ awardLoyaltyPoints\n                console.log(`üîç [PATCH partial ${id}] 7Ô∏è‚É£ –í—ã–∑–æ–≤ awardLoyaltyPoints —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:`, {\n                  userId: currentOrder.user_id,\n                  orderTotal,\n                  pointsUsed: 0, // ‚úÖ 0 –≤–º–µ—Å—Ç–æ pointsUsed, —Ç.–∫. —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã\n                  loyaltyPointsEarned,\n                  orderId: id,\n                  note: 'pointsUsed=0 –ø–æ—Ç–æ–º—É —á—Ç–æ –±–∞–ª–ª—ã —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞'\n                })\n                await awardLoyaltyPoints(currentOrder.user_id, orderTotal, 0, loyaltyPointsEarned, Number(id))\n                \n                console.log(`üîç [PATCH partial ${id}] 8Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç awardLoyaltyPoints: —É—Å–ø–µ—à–Ω–æ`)\n                \n                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –±–∞–ª–ª–∞–º–∏\n                console.log(`üîç [PATCH partial ${id}] 9Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î:`, {\n                  orderId: id,\n                  loyalty_points_earned: loyaltyPointsEarned,\n                })\n                updateData.loyalty_points_earned = loyaltyPointsEarned\n                \n                console.log(`‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ ${loyaltyPointsEarned} –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${currentOrder.user_id} –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞–∫–∞–∑–∞ ${id}`)\n              } else {\n                console.log(`‚ÑπÔ∏è PATCH ${id}: –ë–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã - —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ 0 –±–∞–ª–ª–æ–≤`)\n              }\n            }\n          }\n        } catch (error) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ:`, error)\n        }\n        console.log(`üîç ========== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH partial) ==========\\n`)\n      }\n\n      // –î–æ–±–∞–≤–ª—è–µ–º order_status –≤ updateData, –µ—Å–ª–∏ –æ–Ω —É–∫–∞–∑–∞–Ω\n      if (body.orderStatus !== undefined) updateData.order_status = body.orderStatus\n      if (body.order_status !== undefined) updateData.order_status = body.order_status\n      \n      console.log(`[PATCH /api/orders/${id}] Updating with data:`, updateData)\n      \n      try {\n        await updateOrder(Number(id), updateData)\n        console.log(`[PATCH /api/orders/${id}] ‚úÖ Successfully updated, fetching full order...`)\n        \n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –∑–∞–∫–∞–∑–∞ –∏–∑ –ë–î –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n        const fullOrder = await fetchOrderById(Number(id), true) // noCache –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n        if (!fullOrder) {\n          throw new Error(\"Order not found after update\")\n        }\n        \n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –ï—Å–ª–∏ –≤ fetchOrderById –Ω–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫—ç—à),\n        // –±–µ—Ä–µ–º –∏—Ö –∏–∑ updateData –Ω–∞–ø—Ä—è–º—É—é\n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç start_date –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n        const normalizeStartDate = (date: any): string => {\n          if (!date) return \"\"\n          if (typeof date === \"string\") {\n            // –ï—Å–ª–∏ —ç—Ç–æ ISO timestamp, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É\n            if (date.includes(\"T\")) {\n              return date.split(\"T\")[0]\n            }\n            // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å\n            return date\n          }\n          // –ï—Å–ª–∏ —ç—Ç–æ Date –æ–±—ä–µ–∫—Ç\n          if (date instanceof Date) {\n            return date.toISOString().split(\"T\")[0]\n          }\n          return String(date)\n        }\n        \n        const mergedOrder = {\n          ...fullOrder,\n          // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –æ–±–Ω–æ–≤–∏–ª–∏\n          ...(updateData.loyalty_points_used !== undefined && { \n            loyalty_points_used: updateData.loyalty_points_used \n          }),\n          ...(updateData.loyalty_points_earned !== undefined && { \n            loyalty_points_earned: updateData.loyalty_points_earned \n          }),\n          // ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º start_date –∫ —Ñ–æ—Ä–º–∞—Ç—É YYYY-MM-DD\n          start_date: normalizeStartDate(fullOrder.start_date || (fullOrder as any)[\"Start Date\"]),\n        }\n        \n        console.log(`[PATCH /api/orders/${id}] üì¶ –ü–æ–ª–Ω—ã–π –∑–∞–∫–∞–∑ (merged):`, {\n          Id: mergedOrder.Id,\n          total: mergedOrder.total,\n          loyalty_points_earned: mergedOrder.loyalty_points_earned,\n          loyalty_points_used: mergedOrder.loyalty_points_used,\n          paid: mergedOrder.paid,\n        })\n        \n        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –¥–ª—è –æ—Ç–≤–µ—Ç–∞\n        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: pendingPointsEarned (–µ—Å–ª–∏ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã pending) –∏–ª–∏ loyalty_points_earned –∏–∑ –∑–∞–∫–∞–∑–∞\n        const pointsEarned = pendingPointsEarned > 0 \n          ? pendingPointsEarned \n          : typeof mergedOrder.loyalty_points_earned === 'number' \n          ? mergedOrder.loyalty_points_earned \n          : parseInt(String(mergedOrder.loyalty_points_earned)) || 0\n        \n        console.log(`[PATCH /api/orders/${id}] üì§ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç:`, {\n          success: true,\n          pendingPointsEarned,\n          'mergedOrder.loyalty_points_earned': mergedOrder.loyalty_points_earned,\n          'mergedOrder.loyalty_points_used': mergedOrder.loyalty_points_used,\n          'mergedOrder.total': mergedOrder.total,\n          pointsEarned,\n          loyaltyPointsEarnedInResponse: pointsEarned > 0 ? pointsEarned : undefined\n        })\n        \n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2026-01-11: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n        let updatedUserProfile = undefined\n        if (currentOrder.user_id) {\n          try {\n            const updatedUser = await fetchUserById(currentOrder.user_id, true) // noCache –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n            if (updatedUser) {\n              updatedUserProfile = {\n                id: updatedUser.Id,\n                phone: updatedUser.phone,\n                name: updatedUser.name,\n                loyaltyPoints: updatedUser.loyalty_points,\n                totalSpent: updatedUser.total_spent,\n              }\n              console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ—Å–ª–µ PATCH:`, updatedUserProfile)\n            }\n          } catch (error) {\n            console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:`, error)\n          }\n        }\n        \n        return NextResponse.json({ \n          success: true, \n          order: mergedOrder,\n          orderNumber: (mergedOrder as any)?.order_number ?? (mergedOrder as any)?.[\"Order Number\"],\n          loyaltyPointsEarned: pointsEarned > 0 ? pointsEarned : undefined,\n          userProfile: updatedUserProfile\n        })\n      } catch (error) {\n        console.error(`[PATCH /api/orders/${id}] ‚ùå Update failed:`, error)\n        throw error\n      }\n    }\n  } catch (error) {\n    console.error(\"‚ùå Failed to update order:\", error)\n    const errorMessage = error instanceof Error ? error.message : \"Unknown error\"\n    const errorStack = error instanceof Error ? error.stack : undefined\n    console.error(\"Error details:\", { errorMessage, errorStack })\n    return NextResponse.json({ \n      error: \"Failed to update order\",\n      details: errorMessage,\n      stack: process.env.NODE_ENV === \"development\" ? errorStack : undefined\n    }, { status: 500 })\n  }\n}\n\nasync function saveMeal(\n  orderPersonId: number,\n  day: \"day1\" | \"day2\",\n  mealTime: \"breakfast\" | \"lunch\" | \"dinner\",\n  mealType: \"dish\" | \"salad\" | \"soup\" | \"main\",\n  meal: Meal,\n) {\n  const price = getMealPriceForPortion(meal)\n  const garnishPrice = meal.garnish ? getMealPriceForPortion(meal.garnish) : undefined\n\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ–≤—É—é —á–∞—Å—Ç—å –∏–∑ meal.id, –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞\n  const cleanMealId = typeof meal.id === 'string' \n    ? parseInt((meal.id as any).split('_')[0]) \n    : meal.id\n  \n  const cleanGarnishId = meal.garnish?.id \n    ? (typeof meal.garnish.id === 'string' \n        ? parseInt((meal.garnish.id as any).split('_')[0]) \n        : meal.garnish.id)\n    : undefined\n\n  await createOrderMeal({\n    order_person_id: orderPersonId,\n    day,\n    meal_time: mealTime,\n    meal_type: mealType,\n    meal_id: cleanMealId,\n    portion_size: meal.portion || \"single\",\n    price: Math.round(price), // ‚úÖ –û–∫—Ä—É–≥–ª—è–µ–º —Ü–µ–Ω—É –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞\n    garnish_id: cleanGarnishId,\n    garnish_portion_size: meal.garnish?.portion,\n    garnish_price: garnishPrice ? Math.round(garnishPrice) : undefined, // ‚úÖ –û–∫—Ä—É–≥–ª—è–µ–º —Ü–µ–Ω—É –≥–∞—Ä–Ω–∏—Ä–∞\n  })\n}\n\nfunction getMealPriceForPortion(meal: {\n  prices?: { single: number; medium?: number; large?: number }\n  price?: number\n  portion?: PortionSize\n}): number {\n  // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä–µ–∫—Ç prices, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ\n  if (meal.prices) {\n    const portion = meal.portion || \"single\"\n    if (portion === \"medium\" && meal.prices.medium) return meal.prices.medium\n    if (portion === \"large\" && meal.prices.large) return meal.prices.large\n    return meal.prices.single\n  }\n  // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º price (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)\n  return meal.price || 0\n}\n\n// DELETE /api/orders/[id] - –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞\nexport async function DELETE(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const { id } = await params\n\n    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞–ª–ª–æ–≤ (–ë–ï–ó –∫—ç—à–∞ –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö)\n    const currentOrder = await fetchOrderById(Number(id), true)\n    if (!currentOrder) {\n      return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\n    }\n\n    console.log(`üóëÔ∏è DELETE /api/orders/${id} - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞`, {\n      order_status: currentOrder.order_status,\n      user_id: currentOrder.user_id,\n      loyalty_points_earned: currentOrder.loyalty_points_earned,\n      \"Loyalty Points Earned\": (currentOrder as any)[\"Loyalty Points Earned\"],\n      loyalty_points_used: currentOrder.loyalty_points_used,\n      \"Loyalty Points Used\": (currentOrder as any)[\"Loyalty Points Used\"],\n      paid: currentOrder.paid,\n      payment_method: currentOrder.payment_method,\n      allKeys: Object.keys(currentOrder).filter(k => k.toLowerCase().includes('loyalty') || k.toLowerCase().includes('points')),\n    })\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –æ—Ç–º–µ–Ω–µ–Ω\n    const wasCancelled = currentOrder.order_status === \"cancelled\"\n\n    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞\n    if (!wasCancelled && currentOrder.user_id) {\n      try {\n        const wasPaid = currentOrder.paid === true || currentOrder.payment_status === \"paid\"\n        const paymentMethod = currentOrder.payment_method || (currentOrder as any)[\"Payment Method\"]\n        \n        const pointsEarned = typeof currentOrder.loyalty_points_earned === 'number' \n          ? currentOrder.loyalty_points_earned \n          : parseInt(String(currentOrder.loyalty_points_earned)) || 0\n        const pointsUsed = typeof currentOrder.loyalty_points_used === 'number'\n          ? currentOrder.loyalty_points_used\n          : parseInt(String(currentOrder.loyalty_points_used)) || 0\n        const orderTotal = typeof currentOrder.total === 'number'\n          ? currentOrder.total\n          : parseFloat(String(currentOrder.total)) || 0\n        \n        // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –û–ü–õ–ê–ß–ï–ù - –±–∞–ª–ª—ã —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö\n        if (wasPaid && (pointsEarned > 0 || pointsUsed > 0)) {\n          // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–ª—É—á–∞–µ–º –í–°–ï completed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞\n          // –í–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pointsEarned –∏–∑ –∑–∞–∫–∞–∑–∞, –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Å—É–º–º—É –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π\n          try {\n            const allTransactions = await fetchPendingTransactionsByOrder(Number(id))\n            \n            let actualPointsEarned = 0\n            let actualPointsUsed = 0\n            \n            for (const trans of allTransactions) {\n              const transPoints = typeof trans.points === 'number' ? trans.points : parseInt(String(trans.points)) || 0\n              if (trans.transaction_type === 'earned' && trans.transaction_status === 'completed') {\n                actualPointsEarned += transPoints\n              } else if (trans.transaction_type === 'used' && trans.transaction_status === 'completed') {\n                actualPointsUsed += Math.abs(transPoints) // used –±–∞–ª–ª—ã –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ\n              }\n            }\n            \n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–ª–∏ fallback –Ω–∞ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞\n            const finalPointsEarned = actualPointsEarned > 0 ? actualPointsEarned : pointsEarned\n            const finalPointsUsed = actualPointsUsed > 0 ? actualPointsUsed : pointsUsed\n            \n            console.log(`üí∞ –ó–∞–∫–∞–∑ ${id} –±—ã–ª –û–ü–õ–ê–ß–ï–ù - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–ª—ã`, {\n              pointsEarnedFromOrder: pointsEarned,\n              pointsUsedFromOrder: pointsUsed,\n              actualPointsEarnedFromTransactions: actualPointsEarned,\n              actualPointsUsedFromTransactions: actualPointsUsed,\n              finalPointsEarned,\n              finalPointsUsed,\n              orderTotal,\n              userId: currentOrder.user_id,\n            })\n            \n            await refundLoyaltyPoints(\n              currentOrder.user_id,\n              finalPointsEarned,\n              finalPointsUsed,\n              orderTotal,\n              Number(id)\n            )\n            console.log(`‚úÖ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${finalPointsEarned} –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∏ ${finalPointsUsed} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤`)\n          } catch (error) {\n            console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –±–∞–ª–ª–æ–≤:`, error)\n            // Fallback –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∑–∞–∫–∞–∑–∞\n            await refundLoyaltyPoints(\n              currentOrder.user_id,\n              pointsEarned,\n              pointsUsed,\n              orderTotal,\n              Number(id)\n            )\n            console.log(`‚úÖ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${pointsEarned} –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∏ ${pointsUsed} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ (fallback)`)\n          }\n        } else if (!wasPaid) {\n          // –ó–∞–∫–∞–∑ –ù–ï –±—ã–ª –æ–ø–ª–∞—á–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n          const pendingTransactions = await fetchPendingTransactionsByOrder(Number(id))\n          console.log(`üîç –ó–∞–∫–∞–∑ –ù–ï –±—ã–ª –æ–ø–ª–∞—á–µ–Ω. –ù–∞–π–¥–µ–Ω–æ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${pendingTransactions.length}`)\n          \n          if (pendingTransactions.length > 0) {\n            // –û—Ç–º–µ–Ω—è–µ–º pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n            console.log(`‚è≥ –û—Ç–º–µ–Ω—è–µ–º ${pendingTransactions.length} pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π`)\n            \n            const now = new Date().toISOString()\n            for (const transaction of pendingTransactions) {\n              await updateLoyaltyTransaction(transaction.Id, {\n                transaction_status: 'cancelled',\n                processed_at: now,\n              })\n            }\n            \n            console.log(`‚úÖ –û—Ç–º–µ–Ω–µ–Ω—ã pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–∞ ${id}`)\n          } else {\n            console.log(`‚ÑπÔ∏è –ù–µ—Ç pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ${id}`)\n          }\n        }\n        \n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ, –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –æ–ø–ª–∞—á–µ–Ω\n        if (wasPaid) {\n          console.log(`‚ö†Ô∏è –ó–∞–∫–∞–∑ ${id} –±—ã–ª –æ–ø–ª–∞—á–µ–Ω –∏ –æ—Ç–º–µ–Ω–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ`)\n          \n          try {\n            const stats = await getUserCancellationStats(currentOrder.user_id)\n            \n            console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}:`, stats)\n            \n            // –ï—Å–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ 3 –∏–ª–∏ –±–æ–ª–µ–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, —Å–æ–∑–¥–∞–µ–º fraud alert\n            if (stats.cancelledPaidOrders >= 3) {\n              console.warn(`üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${currentOrder.user_id} –æ—Ç–º–µ–Ω–∏–ª ${stats.cancelledPaidOrders} –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤`)\n              \n              await createFraudAlert(currentOrder.user_id, stats)\n              \n              console.log(`‚úÖ Fraud alert —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}`)\n            }\n          } catch (error) {\n            console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ:`, error)\n            // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞\n          }\n        }\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞:`, error)\n        // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞\n      }\n    }\n\n    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–∫–∞–∑ –∫–∞–∫ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–π –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è\n    const updatedOrder = await updateOrder(Number(id), {\n      order_status: \"cancelled\",\n    })\n\n    // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ë–ï–ó –∫—ç—à–∞!)\n    let updatedUserBalance: number = 0\n    if (currentOrder.user_id) {\n      try {\n        const updatedUser = await fetchUserById(currentOrder.user_id, true)\n        if (updatedUser) {\n          updatedUserBalance = typeof updatedUser.loyalty_points === 'number'\n            ? updatedUser.loyalty_points\n            : parseInt(String(updatedUser.loyalty_points)) || 0\n          console.log(`üí∞ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentOrder.user_id}: ${updatedUserBalance} –±–∞–ª–ª–æ–≤`)\n        }\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞:`, error)\n      }\n    }\n\n    return NextResponse.json({ \n      success: true, \n      order: updatedOrder,\n      updatedLoyaltyPoints: updatedUserBalance,\n    })\n  } catch (error) {\n    console.error(\"Failed to cancel order:\", error)\n    return NextResponse.json({ error: \"Failed to cancel order\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}