{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sergejasasnev/Downloads/my-project%20%281%29/lib/nocodb.ts"],"sourcesContent":["// NocoDB API client - все запросы идут через внутренний API proxy\n// Токен никогда не попадает в браузер\n\n// Определяем базовый URL для API proxy\n// На сервере используем абсолютный URL, на клиенте - относительный\nconst getApiBaseUrl = () => {\n  if (typeof window !== \"undefined\") {\n    return \"/api/db\"\n  }\n  return null\n}\n\nfunction getNocoDBUrl(): string {\n  return process.env.NOCODB_URL || \"\"\n}\n\nfunction getNocoDBToken(): string {\n  return process.env.NOCODB_TOKEN || \"\"\n}\n\nfunction getTableId(tableName: string): string {\n  const tableIds: Record<string, string | undefined> = {\n    Meals: process.env.NOCODB_TABLE_MEALS,\n    Extras: process.env.NOCODB_TABLE_EXTRAS,\n    Delivery_Zones: process.env.NOCODB_TABLE_DELIVERY_ZONES,\n    Users: process.env.NOCODB_TABLE_USERS,\n    Orders: process.env.NOCODB_TABLE_ORDERS,\n    Order_Persons: process.env.NOCODB_TABLE_ORDER_PERSONS,\n    Order_Meals: process.env.NOCODB_TABLE_ORDER_MEALS,\n    Order_Extras: process.env.NOCODB_TABLE_ORDER_EXTRAS,\n    Promo_Codes: process.env.NOCODB_TABLE_PROMO_CODES,\n    Reviews: process.env.NOCODB_TABLE_REVIEWS,\n  }\n\n  return tableIds[tableName] || \"\"\n}\n\n// Проверяем конфигурацию динамически\nfunction validateNocoDBConfig(): { isValid: boolean; error?: string } {\n  const url = getNocoDBUrl()\n  const token = getNocoDBToken()\n  const mealsTable = process.env.NOCODB_TABLE_MEALS\n\n  if (!url || !token) {\n    return { isValid: false, error: \"NOCODB_URL or NOCODB_TOKEN not set\" }\n  }\n  if (!mealsTable) {\n    return { isValid: false, error: \"NOCODB_TABLE_MEALS not set\" }\n  }\n  return { isValid: true }\n}\n\nexport function isNocoDBConfigured(): boolean {\n  return validateNocoDBConfig().isValid\n}\n\n// Типы для NocoDB ответов\ninterface NocoDBResponse<T> {\n  list: T[]\n  pageInfo?: {\n    totalRows: number\n    page: number\n    pageSize: number\n    isFirstPage: boolean\n    isLastPage: boolean\n  }\n}\n\nfunction buildNocoDBUrl(tableName: string, params: Record<string, string> = {}): string {\n  const queryString = new URLSearchParams(params).toString()\n  let baseUrl = getNocoDBUrl().replace(/\\/$/, \"\")\n\n  if (!baseUrl.endsWith(\"/api/v2\")) {\n    baseUrl = `${baseUrl}/api/v2`\n  }\n\n  const tableId = getTableId(tableName)\n\n  if (!tableId) {\n    throw new Error(`TABLE_NOT_CONFIGURED:${tableName}`)\n  }\n\n  return `${baseUrl}/tables/${tableId}/records${queryString ? `?${queryString}` : \"\"}`\n}\n\n// Серверный fetch напрямую к NocoDB (для ISR)\nasync function serverFetch<T>(tableName: string, params: Record<string, string> = {}): Promise<T> {\n  const config = validateNocoDBConfig()\n  if (!config.isValid) {\n    throw new Error(`NocoDB is not configured: ${config.error}`)\n  }\n\n  const url = buildNocoDBUrl(tableName, params)\n  const token = getNocoDBToken()\n\n  const response = await fetch(url, {\n    headers: {\n      \"xc-token\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    next: { revalidate: 3600 },\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`NocoDB API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch {\n    throw new Error(`NocoDB returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// Серверная функция для создания/обновления записей напрямую к NocoDB\nasync function serverCreateRecord<T>(\n  tableName: string,\n  data: any,\n  method: \"POST\" | \"PATCH\" = \"POST\",\n  recordId?: number,\n): Promise<T> {\n  const config = validateNocoDBConfig()\n  if (!config.isValid) {\n    throw new Error(`NocoDB is not configured: ${config.error}`)\n  }\n\n  let baseUrl = getNocoDBUrl().replace(/\\/$/, \"\")\n  if (!baseUrl.endsWith(\"/api/v2\")) {\n    baseUrl = `${baseUrl}/api/v2`\n  }\n\n  const tableId = getTableId(tableName)\n  if (!tableId) {\n    throw new Error(`TABLE_NOT_CONFIGURED:${tableName}`)\n  }\n\n  const url = method === \"PATCH\" && recordId\n    ? `${baseUrl}/tables/${tableId}/records/${recordId}`\n    : `${baseUrl}/tables/${tableId}/records`\n\n  const token = getNocoDBToken()\n\n  const response = await fetch(url, {\n    method,\n    headers: {\n      \"xc-token\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`NocoDB API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    const result = JSON.parse(text)\n    // NocoDB может вернуть запись в разных форматах\n    if (Array.isArray(result)) {\n      return result[0] as T\n    }\n    if (result && typeof result === 'object' && 'Id' in result) {\n      return result as T\n    }\n    if (result && typeof result === 'object' && 'record' in result) {\n      return result.record as T\n    }\n    return result as T\n  } catch {\n    throw new Error(`NocoDB returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// Клиентский fetch через API proxy\nasync function clientFetch<T>(\n  tableName: string,\n  params: Record<string, string> = {},\n  options: RequestInit = {},\n): Promise<T> {\n  const queryString = new URLSearchParams(params).toString()\n  const url = `/api/db/${tableName}/records${queryString ? `?${queryString}` : \"\"}`\n\n  const response = await fetch(url, {\n    ...options,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...options.headers,\n    },\n  })\n\n  const text = await response.text()\n\n  if (!response.ok) {\n    if (text.includes(\"TABLE_NOT_FOUND\") || response.status === 404) {\n      throw new Error(`TABLE_NOT_FOUND:${tableName}`)\n    }\n    throw new Error(`API error: ${response.status} - ${text}`)\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch {\n    throw new Error(`API returned invalid JSON: ${text.substring(0, 100)}...`)\n  }\n}\n\n// Универсальный fetch\nasync function nocoFetch<T>(\n  tableName: string,\n  params: Record<string, string> = {},\n  options: RequestInit = {},\n): Promise<T> {\n  const apiBaseUrl = getApiBaseUrl()\n\n  if (apiBaseUrl === null) {\n    return serverFetch<T>(tableName, params)\n  } else {\n    return clientFetch<T>(tableName, params, options)\n  }\n}\n\n// === MEALS ===\n\nexport interface NocoDBMeal {\n  Id: number\n  name: string\n  category: string\n  ingredients: string\n  description?: string\n  price: number | string\n  price_single?: number | string\n  price_medium?: number | string\n  price_large?: number | string\n  weight?: number | string\n  weight_single?: number | string\n  weight_medium?: number | string\n  weight_large?: number | string\n  image?: string\n  available?: boolean | string\n  needs_garnish?: boolean | string\n  calories?: number | string\n  protein?: number | string\n  fats?: number | string\n  carbs?: number | string\n  is_current_week?: boolean | string\n  is_next_week?: boolean | string\n}\n\nexport async function fetchMeals(weekFilter?: \"current\" | \"next\"): Promise<NocoDBMeal[]> {\n  try {\n    const params: Record<string, string> = {\n      limit: \"1000\",\n    }\n\n    const response = await nocoFetch<NocoDBResponse<NocoDBMeal>>(\"Meals\", params)\n    console.log(\n      `[v0] fetchMeals: got ${response.list?.length || 0} meals, first item:`,\n      JSON.stringify(response.list?.[0] || {}).substring(0, 200),\n    )\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Meals not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === EXTRAS ===\n\nexport interface NocoDBExtra {\n  Id: number\n  name: string\n  category: string\n  ingredients?: string\n  description?: string\n  price: number | string\n  image?: string\n  available?: boolean | string\n  calories?: number | string\n  protein?: number | string\n  fats?: number | string\n  carbs?: number | string\n  weight?: number | string\n}\n\nexport async function fetchExtras(): Promise<NocoDBExtra[]> {\n  try {\n    const response = await nocoFetch<NocoDBResponse<NocoDBExtra>>(\"Extras\", {\n      limit: \"1000\",\n    })\n    console.log(\n      `[v0] fetchExtras: got ${response.list?.length || 0} extras, first item:`,\n      JSON.stringify(response.list?.[0] || {}).substring(0, 200),\n    )\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Extras not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === DELIVERY ZONES ===\n\nexport interface NocoDBDeliveryZone {\n  Id: number\n  city: string\n  district?: string\n  delivery_fee: number | string\n  min_order_amount: number | string\n  is_available?: boolean | string\n  available_intervals?: string\n}\n\nexport async function fetchDeliveryZones(): Promise<NocoDBDeliveryZone[]> {\n  try {\n    const response = await nocoFetch<NocoDBResponse<NocoDBDeliveryZone>>(\"Delivery_Zones\", {\n      // where: \"(is_available,eq,true)\",\n    })\n    console.log(`[v0] fetchDeliveryZones: got ${response.list?.length || 0} zones, first item:`, response.list?.[0])\n    return response.list || []\n  } catch (error) {\n    if (error instanceof Error && error.message.startsWith(\"TABLE_NOT_FOUND\")) {\n      console.warn(\"Table Delivery_Zones not found in NocoDB, returning empty array\")\n      return []\n    }\n    throw error\n  }\n}\n\n// === USERS ===\n\nexport interface NocoDBUser {\n  Id: number\n  phone: string\n  password_hash?: string\n  name: string\n  additional_phone?: string\n  street?: string\n  building?: string\n  building_section?: string\n  apartment?: string\n  entrance?: string\n  floor?: string\n  intercom?: string\n  district?: string\n  delivery_comment?: string\n  loyalty_points: number | string\n  total_spent: number | string\n  created_at: string\n  updated_at: string\n}\n\nexport async function fetchUserByPhone(phone: string): Promise<NocoDBUser | null> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBUser>>(\"Users\", {\n    where: `(phone,eq,${phone})`,\n  })\n  return response.list?.[0] || null\n}\n\nexport async function fetchUserById(id: number): Promise<NocoDBUser | null> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBUser>>(\"Users\", {\n    where: `(Id,eq,${id})`,\n  })\n  return response.list?.[0] || null\n}\n\nexport async function createUser(user: Omit<NocoDBUser, \"Id\" | \"created_at\" | \"updated_at\">): Promise<NocoDBUser> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBUser>(\"Users\", user, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Users\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(user),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBUser\n    }\n    \n    return response as NocoDBUser\n  }\n}\n\nexport async function updateUser(id: number, data: Partial<NocoDBUser>): Promise<NocoDBUser> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBUser>(\"Users\", data, \"PATCH\", id)\n  } else {\n    const response = await clientFetch<any>(\n      `Users/${id}`,\n      {},\n      {\n        method: \"PATCH\",\n        body: JSON.stringify(data),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBUser\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBUser\n    }\n    \n    return response as NocoDBUser\n  }\n}\n\n// === ORDERS ===\n\nexport interface NocoDBOrder {\n  Id: number\n  user_id?: number\n  order_number: string\n  start_date: string\n  delivery_time: string\n  status: \"pending\" | \"paid\" | \"delivered\" | \"cancelled\"\n  payment_method: \"card\" | \"sbp\" | \"cash\"\n  paid?: boolean | string\n  paid_at?: string\n  delivered?: boolean | string\n  cancelled?: boolean | string\n  promo_code?: string\n  promo_discount?: number | string\n  loyalty_points_used: number | string\n  loyalty_points_earned: number | string\n  subtotal: number | string\n  total: number | string\n  guest_phone?: string\n  guest_address?: string\n  created_at: string\n  updated_at: string\n}\n\nexport async function fetchOrders(userId?: number): Promise<NocoDBOrder[]> {\n  const params: Record<string, string> = {\n    limit: \"1000\",\n    sort: \"-start_date\",\n  }\n\n  if (userId) {\n    params.where = `(user_id,eq,${userId})`\n  }\n\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrder>>(\"Orders\", params)\n  return response.list || []\n}\n\nexport async function fetchOrdersByUser(userId: number): Promise<NocoDBOrder[]> {\n  return fetchOrders(userId)\n}\n\nexport function generateOrderNumber(): string {\n  const now = new Date()\n  const date = now.toISOString().slice(0, 10).replace(/-/g, \"\")\n  const random = Math.random().toString(36).substring(2, 8).toUpperCase()\n  return `ORD-${date}-${random}`\n}\n\nexport async function fetchOrderById(id: number): Promise<NocoDBOrder | null> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrder>>(\"Orders\", {\n    where: `(Id,eq,${id})`,\n  })\n  return response.list?.[0] || null\n}\n\nexport async function createOrder(order: Omit<NocoDBOrder, \"Id\" | \"created_at\" | \"updated_at\">): Promise<NocoDBOrder> {\n  // На сервере используем прямой запрос к NocoDB, на клиенте - через proxy\n  const apiBaseUrl = getApiBaseUrl()\n  \n  let createdOrder: NocoDBOrder\n  \n  if (apiBaseUrl === null) {\n    // Серверная среда - прямой запрос к NocoDB\n    createdOrder = await serverCreateRecord<NocoDBOrder>(\"Orders\", order, \"POST\")\n  } else {\n    // Клиентская среда - через API proxy\n    const response = await clientFetch<any>(\n      \"Orders\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(order),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      createdOrder = response[0] as NocoDBOrder\n    } else if (response && typeof response === 'object' && 'Id' in response) {\n      createdOrder = response as NocoDBOrder\n    } else if (response && typeof response === 'object' && 'record' in response) {\n      createdOrder = response.record as NocoDBOrder\n    } else {\n      createdOrder = response as NocoDBOrder\n    }\n  }\n  \n  // NocoDB часто возвращает только Id при создании, поэтому всегда получаем полный объект\n  if (createdOrder?.Id) {\n    // Проверяем, есть ли уже все нужные поля\n    if (!createdOrder.order_number || Object.keys(createdOrder).length < 5) {\n      console.log(`⚠️ Order created but incomplete response, fetching full order ${createdOrder.Id}...`)\n      try {\n        // Небольшая задержка, чтобы запись точно сохранилась\n        await new Promise(resolve => setTimeout(resolve, 300))\n        const fullOrder = await fetchOrderById(createdOrder.Id)\n        if (fullOrder && fullOrder.order_number) {\n          console.log(`✅ Fetched full order with order_number: ${fullOrder.order_number}`)\n          return fullOrder\n        } else {\n          console.warn(`⚠️ Fetched order also incomplete, but using it anyway`)\n          if (fullOrder) return fullOrder\n        }\n      } catch (error) {\n        console.warn(`⚠️ Failed to fetch full order:`, error)\n        // Если не удалось получить, но есть сгенерированный номер, добавляем его\n        if ('order_number' in order) {\n          return { ...createdOrder, order_number: order.order_number } as NocoDBOrder\n        }\n      }\n    } else {\n      console.log(`✅ Order created with complete data, order_number: ${createdOrder.order_number}`)\n    }\n  }\n  \n  return createdOrder\n}\n\nexport async function updateOrder(id: number, data: Partial<NocoDBOrder>): Promise<NocoDBOrder> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    // Серверная среда - прямой запрос к NocoDB\n    return serverCreateRecord<NocoDBOrder>(\"Orders\", data, \"PATCH\", id)\n  } else {\n    // Клиентская среда - через API proxy\n    const response = await clientFetch<any>(\n      `Orders/${id}`,\n      {},\n      {\n        method: \"PATCH\",\n        body: JSON.stringify(data),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrder\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrder\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrder\n    }\n    \n    return response as NocoDBOrder\n  }\n}\n\n// === ORDER PERSONS ===\n\nexport interface NocoDBOrderPerson {\n  Id: number\n  order_id: number\n  person_number: number\n}\n\nexport async function createOrderPerson(orderPerson: Omit<NocoDBOrderPerson, \"Id\">): Promise<NocoDBOrderPerson> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderPerson>(\"Order_Persons\", orderPerson, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Persons\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderPerson),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderPerson\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderPerson\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderPerson\n    }\n    \n    return response as NocoDBOrderPerson\n  }\n}\n\n// === ORDER MEALS ===\n\nexport interface NocoDBOrderMeal {\n  Id: number\n  order_person_id: number\n  day: \"day1\" | \"day2\"\n  meal_time: \"breakfast\" | \"lunch\" | \"dinner\"\n  meal_type: \"dish\" | \"salad\" | \"soup\" | \"main\"\n  meal_id: number\n  portion_size: \"single\" | \"medium\" | \"large\"\n  price: number | string\n  garnish_id?: number\n  garnish_portion_size?: \"single\" | \"medium\" | \"large\"\n  garnish_price?: number | string\n}\n\nexport async function createOrderMeal(orderMeal: Omit<NocoDBOrderMeal, \"Id\">): Promise<NocoDBOrderMeal> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderMeal>(\"Order_Meals\", orderMeal, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Meals\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderMeal),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderMeal\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderMeal\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderMeal\n    }\n    \n    return response as NocoDBOrderMeal\n  }\n}\n\n// === ORDER EXTRAS ===\n\nexport interface NocoDBOrderExtra {\n  Id: number\n  order_id: number\n  extra_id: number\n  quantity: number | string\n  price: number | string\n}\n\nexport async function createOrderExtra(orderExtra: Omit<NocoDBOrderExtra, \"Id\">): Promise<NocoDBOrderExtra> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBOrderExtra>(\"Order_Extras\", orderExtra, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Order_Extras\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(orderExtra),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBOrderExtra\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBOrderExtra\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBOrderExtra\n    }\n    \n    return response as NocoDBOrderExtra\n  }\n}\n\n// Функции для получения данных заказа\nexport async function fetchOrderPersons(orderId: number): Promise<NocoDBOrderPerson[]> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderPerson>>(\"Order_Persons\", {\n    where: `(order_id,eq,${orderId})`,\n  })\n  return response.list || []\n}\n\nexport async function fetchOrderMeals(orderPersonId: number): Promise<NocoDBOrderMeal[]> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderMeal>>(\"Order_Meals\", {\n    where: `(order_person_id,eq,${orderPersonId})`,\n  })\n  return response.list || []\n}\n\nexport async function fetchOrderExtras(orderId: number): Promise<NocoDBOrderExtra[]> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBOrderExtra>>(\"Order_Extras\", {\n    where: `(order_id,eq,${orderId})`,\n  })\n  return response.list || []\n}\n\n// Функции для удаления данных заказа\nexport async function deleteOrderPerson(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    // На сервере используем прямой запрос к NocoDB\n    const tableId = getTableId(\"Order_Persons\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order person: ${response.status}`)\n    }\n  } else {\n    // На клиенте используем API proxy\n    const response = await fetch(`/api/db/Order_Persons/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order person: ${response.status}`)\n    }\n  }\n}\n\nexport async function deleteOrderMeal(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    const tableId = getTableId(\"Order_Meals\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order meal: ${response.status}`)\n    }\n  } else {\n    const response = await fetch(`/api/db/Order_Meals/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order meal: ${response.status}`)\n    }\n  }\n}\n\nexport async function deleteOrderExtra(id: number): Promise<void> {\n  const apiBaseUrl = getApiBaseUrl()\n  if (apiBaseUrl === null) {\n    const tableId = getTableId(\"Order_Extras\")\n    const nocodbUrl = getNocoDBUrl()\n    const token = getNocoDBToken()\n    const url = `${nocodbUrl}/api/v2/tables/${tableId}/records/${id}`\n    \n    const response = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"xc-token\": token,\n        \"Content-Type\": \"application/json\",\n      },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order extra: ${response.status}`)\n    }\n  } else {\n    const response = await fetch(`/api/db/Order_Extras/records/${id}`, {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    \n    if (!response.ok) {\n      throw new Error(`Failed to delete order extra: ${response.status}`)\n    }\n  }\n}\n\n// === PROMO CODES ===\n\nexport interface NocoDBPromoCode {\n  Id: number\n  code: string\n  discount_type: \"percentage\" | \"fixed\"\n  discount_value: number | string\n  min_order_amount?: number | string\n  max_discount?: number | string\n  valid_from?: string\n  valid_until?: string\n  usage_limit?: number | string\n  times_used: number | string\n  active?: boolean | string\n}\n\nexport async function fetchPromoCode(code: string): Promise<NocoDBPromoCode | null> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBPromoCode>>(\"Promo_Codes\", {\n    where: `(code,eq,${code})~and(active,eq,true)`,\n  })\n  return response.list?.[0] || null\n}\n\nexport async function incrementPromoCodeUsage(id: number): Promise<void> {\n  await clientFetch(\n    \"Promo_Codes\",\n    {},\n    {\n      method: \"PATCH\",\n      body: JSON.stringify({ Id: id, times_used: { increment: 1 } }),\n    },\n  )\n}\n\n// === REVIEWS ===\n\nexport interface NocoDBReview {\n  Id: number\n  order_id: number\n  user_id: number\n  rating: number | string\n  text?: string\n  created_at: string\n  updated_at: string\n}\n\nexport async function fetchReviewsForUser(userId: number): Promise<NocoDBReview[]> {\n  const response = await nocoFetch<NocoDBResponse<NocoDBReview>>(\"Reviews\", {\n    where: `(user_id,eq,${userId})`,\n  })\n  return response.list || []\n}\n\nexport async function createReview(\n  review: Omit<NocoDBReview, \"Id\" | \"created_at\" | \"updated_at\">,\n): Promise<NocoDBReview> {\n  const apiBaseUrl = getApiBaseUrl()\n  \n  if (apiBaseUrl === null) {\n    return serverCreateRecord<NocoDBReview>(\"Reviews\", review, \"POST\")\n  } else {\n    const response = await clientFetch<any>(\n      \"Reviews\",\n      {},\n      {\n        method: \"POST\",\n        body: JSON.stringify(review),\n      },\n    )\n    \n    if (Array.isArray(response)) {\n      return response[0] as NocoDBReview\n    }\n    \n    if (response && typeof response === 'object' && 'Id' in response) {\n      return response as NocoDBReview\n    }\n    \n    if (response && typeof response === 'object' && 'record' in response) {\n      return response.record as NocoDBReview\n    }\n    \n    return response as NocoDBReview\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 700, "column": 0}, "map": {"version":3,"sources":["file:///Users/sergejasasnev/Downloads/my-project%20%281%29/app/api/db/recent-orders/route.ts"],"sourcesContent":["// API route для проверки последних заказов в базе\n\nimport { NextResponse } from \"next/server\"\nimport { fetchOrders } from \"@/lib/nocodb\"\n\nexport async function GET() {\n  try {\n    // Получаем последние 10 заказов\n    const orders = await fetchOrders()\n    const recentOrders = orders.slice(0, 10).map((order) => ({\n      id: order.Id,\n      order_number: order.order_number,\n      start_date: order.start_date,\n      status: order.status,\n      total: order.total,\n      user_id: order.user_id,\n      created_at: order.created_at,\n    }))\n\n    return NextResponse.json({\n      success: true,\n      total: orders.length,\n      recent: recentOrders,\n      message: `Найдено ${orders.length} заказов в базе`,\n    })\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n      },\n      { status: 500 },\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA,kDAAkD;AAElD;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,gCAAgC;QAChC,MAAM,SAAS,MAAM,IAAA,8HAAW;QAChC,MAAM,eAAe,OAAO,KAAK,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,QAAU,CAAC;gBACvD,IAAI,MAAM,EAAE;gBACZ,cAAc,MAAM,YAAY;gBAChC,YAAY,MAAM,UAAU;gBAC5B,QAAQ,MAAM,MAAM;gBACpB,OAAO,MAAM,KAAK;gBAClB,SAAS,MAAM,OAAO;gBACtB,YAAY,MAAM,UAAU;YAC9B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,OAAO,MAAM;YACpB,QAAQ;YACR,SAAS,CAAC,QAAQ,EAAE,OAAO,MAAM,CAAC,eAAe,CAAC;QACpD;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QACzD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}