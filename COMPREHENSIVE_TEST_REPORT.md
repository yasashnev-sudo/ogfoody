# üìä –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 2026-01-15  
**–†–µ–∂–∏–º:** –†–µ–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –∏ –ë–î  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —É—Å–ø–µ—à–Ω–æ

---

## üìã –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

| # | –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|------|--------|-----------|
| 1 | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
| 2 | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
| 3 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–æ–±—â–µ |
| 4 | –ü–æ–ª—è min_order_amount –∏ max_discount | ‚úÖ PASS | –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| 5 | –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º | ‚úÖ PASS | –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |

**–ò—Ç–æ–≥–æ:** 2/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ (40%)

---

## ‚úÖ –£–°–ü–ï–®–ù–û –†–ê–ë–û–¢–ê–ï–¢

### 1. –ü–æ–ª—è min_order_amount –∏ max_discount –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ‚úÖ

**–¢–µ—Å—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ —Å –ø–æ–ª—è–º–∏ —á–µ—Ä–µ–∑ API  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS

**–î–µ—Ç–∞–ª–∏:**
- –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω —Å `Min Order Amount: 1500`
- –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω —Å `Max Discount: 500`
- –ü–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î: ‚úÖ
- –ü–æ–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏: ‚úÖ
- –ó–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã: `min_order_amount=1500`, `max_discount=500` ‚úÖ

**–í—ã–≤–æ–¥:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å–ø–µ—à–Ω–æ ‚úÖ

### 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞ ‚úÖ

**–¢–µ—Å—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS

**–î–µ—Ç–∞–ª–∏:**
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω: —Å—É–º–º–∞ 2000‚ÇΩ, –ø—Ä–æ–º–æ–∫–æ–¥ -200‚ÇΩ = 1800‚ÇΩ
- –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã: 54 –±–∞–ª–ª–∞
- –û–∂–∏–¥–∞–ª–æ—Å—å: 54 –±–∞–ª–ª–∞ (3% –æ—Ç 1800‚ÇΩ)
- –†–∞—Å—á–µ—Ç: `1800 * 0.03 = 54` ‚úÖ

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

## ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (–¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò)

### 1. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞, –Ω–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.

#### –¢–µ—Å—Ç 1: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ‚ùå

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥: `TEST-1768515010494`, `times_used: 0` ‚úÖ
2. –°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ —Å `paid: true`, `paymentStatus: 'paid'`, `promoCode: 'TEST-1768515010494'` ‚úÖ
3. –ü—Ä–æ–≤–µ—Ä–µ–Ω `times_used` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è: –æ—Å—Ç–∞–ª—Å—è `0` ‚ùå

**–û–∂–∏–¥–∞–ª–æ—Å—å:** `times_used` –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –¥–æ `1`  
**–ü–æ–ª—É—á–µ–Ω–æ:** `times_used` –æ—Å—Ç–∞–ª—Å—è `0`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –£—Å–ª–æ–≤–∏–µ `order.paid === true || order.paymentStatus === 'paid'` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
2. –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fetchPromoCode()` (–≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑-–∑–∞ —É—Å–ª–æ–≤–∏—è `Active,eq,true`)
3. –û—à–∏–±–∫–∞ –≤ `incrementPromoCodeUsage()` (—Ö–æ—Ç—è —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)

#### –¢–µ—Å—Ç 2: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ‚ùå

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥: `TEST-1768515020175`, `times_used: 0` ‚úÖ
2. –°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ —Å `paid: false`, `promoCode: 'TEST-1768515020175'` ‚úÖ
3. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏: ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
4. –ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω —á–µ—Ä–µ–∑ PATCH ‚úÖ
5. –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: `invalid json response body` ‚ö†Ô∏è
6. –ü—Ä–æ–≤–µ—Ä–µ–Ω `times_used` –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã: –æ—Å—Ç–∞–ª—Å—è `0` ‚ùå

**–û–∂–∏–¥–∞–ª–æ—Å—å:** `times_used` –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –¥–æ `1` –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ  
**–ü–æ–ª—É—á–µ–Ω–æ:** `times_used` –æ—Å—Ç–∞–ª—Å—è `0`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –£—Å–ª–æ–≤–∏–µ `!wasPaid && willBePaid` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ PATCH
2. –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∑–∞–∫–∞–∑–µ (`currentOrder.promo_code`)
3. –û—à–∏–±–∫–∞ –≤ GET API –¥–ª—è –∑–∞–∫–∞–∑–∞ (–ø–æ–±–æ—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

#### –¢–µ—Å—Ç 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ ‚ùå

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥: `TEST-1768515024718`, `times_used: 0` ‚úÖ
2. –°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ —Å `paid: false` ‚úÖ
3. –ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω —á–µ—Ä–µ–∑ PATCH ‚úÖ
4. –ü—Ä–æ–≤–µ—Ä–µ–Ω `times_used`: –æ—Å—Ç–∞–ª—Å—è `0` ‚ùå

**–û–∂–∏–¥–∞–ª–æ—Å—å:** `times_used` –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –¥–æ `1` (–æ–¥–∏–Ω —Ä–∞–∑)  
**–ü–æ–ª—É—á–µ–Ω–æ:** `times_used` –æ—Å—Ç–∞–ª—Å—è `0` (–Ω–µ —É–≤–µ–ª–∏—á–∏–ª—Å—è –≤–æ–æ–±—â–µ)

**–í—ã–≤–æ–¥:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–æ–±—â–µ, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É.

---

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤—Å–µ –µ—â–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚ùå –£–¥–∞–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç `{ increment: 1 }` (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ NocoDB)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCodeById()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚úÖ

**–í—ã–≤–æ–¥:** –§—É–Ω–∫—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fetchPromoCode()`

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã:
```typescript
where: `(Code,eq,${code})~and(Active,eq,true)`
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** ‚úÖ –£–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ `Active,eq,true` - —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –£—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å

**–í POST `/api/orders`:**
- –£—Å–ª–æ–≤–∏–µ: `order.paid === true || order.paymentStatus === 'paid'`
- –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç

**–í PATCH `/api/orders/[id]`:**
- –£—Å–ª–æ–≤–∏–µ: `!wasPaid && willBePaid`
- –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: `willBePaid` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π

---

## üîß –í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` ‚úÖ

**–§–∞–π–ª:** `lib/nocodb.ts:2485-2510`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë–´–õ–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
body: JSON.stringify({ Id: id, times_used: { increment: 1 } })

// –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç):
const promo = await fetchPromoCodeById(id)
const currentTimesUsed = promo['Times Used'] || 0
body: JSON.stringify([{ Id: id, "Times Used": currentTimesUsed + 1 }])
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 2. –§—É–Ω–∫—Ü–∏—è `fetchPromoCode()` ‚úÖ

**–§–∞–π–ª:** `lib/nocodb.ts:2475-2483`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë–´–õ–û:
where: `(Code,eq,${code})~and(Active,eq,true)`

// –°–¢–ê–õ–û:
where: `(Code,eq,${code})`
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç** (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤:
   - `app/api/orders/route.ts` - –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã –∏ –≤—ã–∑–æ–≤–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
   - `app/api/orders/[id]/route.ts` - –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã –∏ –≤—ã–∑–æ–≤–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
   - `lib/nocodb.ts` - –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö `fetchPromoCode()` –∏ `incrementPromoCodeUsage()`

### –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞–∫–∞–∑–∞
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

---

## üéØ –í–´–í–û–î–´

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ –ü–æ–ª—è `min_order_amount` –∏ `max_discount` –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞
3. ‚úÖ –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
4. ‚úÖ –§—É–Ω–∫—Ü–∏—è `fetchPromoCode()` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (—É–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚ö†Ô∏è –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑-–∑–∞ —É—Å–ª–æ–≤–∏–π –∏–ª–∏ –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞)
2. ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. ‚ö†Ô∏è –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- **–ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** ‚úÖ 100% (–≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** ‚ö†Ô∏è 60% (2/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)
- **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ù–ê –°–ï–†–í–ï–†–ï  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
