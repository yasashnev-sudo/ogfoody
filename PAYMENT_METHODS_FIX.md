# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ YooKassa

**–î–∞—Ç–∞:** $(date)  
**–ü—Ä–æ–±–ª–µ–º–∞:** `invalid_combination_of_payment_methods`

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ò–∑ –ª–æ–≥–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞:
```
‚ùå YooKassa widget error: {
  "error": "invalid_combination_of_payment_methods"
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∏–¥–∂–µ—Ç–∞ —É–∫–∞–∑–∞–Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
- `yoo_money` –∏ `sbp` –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤–º–µ—Å—Ç–µ –≤ –≤–∏–¥–∂–µ—Ç–µ YooKassa

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–§–∞–π–ª:** `components/payment-modal.tsx`

**–ë—ã–ª–æ:**
```typescript
payment_methods: ['bank_card', 'yoo_money', 'sbp']
```

**–°—Ç–∞–ª–æ:**
```typescript
payment_methods: ['bank_card', 'sbp']
```

–£–±—Ä–∞–ª–∏ `yoo_money` –∏–∑ —Å–ø–∏—Å–∫–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å `sbp` –≤ –≤–∏–¥–∂–µ—Ç–µ.

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **502 Bad Gateway** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞:
   - API `/api/payments/yookassa/create` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502
   - –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (PM2 –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ)
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

2. **Fallback –Ω–∞ redirect –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–∏–¥–∂–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å fallback –Ω–∞ redirect
   - –ù–æ `confirmationUrl` –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏–∑-–∑–∞ 502 –æ—à–∏–±–∫–∏ API

---

## üöÄ –î–µ–ø–ª–æ–π

–ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã –≤ `origin/main`.  
–î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ `deploy-increment-fix.expect`.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://ogfoody.ru
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç
4. –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–∫–∏ `invalid_combination_of_payment_methods`

---

## üîç –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å 502 –æ—Å—Ç–∞–Ω–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@5.129.194.168
cd /var/www/ogfoody
pm2 status
pm2 logs ogfoody --err --lines 50 | grep -i payment
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –¥–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
