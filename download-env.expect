#!/usr/bin/expect -f
set timeout 60
set password "pULRoAvF@P-@4Y"

spawn scp root@5.129.194.168:/var/www/ogfoody/.env.production ./.env.production.temp
expect "password:" { send "$password\r" }
expect eof

# –°–æ–∑–¥–∞—ë–º .env.local
exec cp .env.production.temp .env.local

# –ú–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
if {[file exists .env.local]} {
    set fp [open .env.local r]
    set data [read $fp]
    close $fp
    
    # –ó–∞–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
    set data [regsub {NOCODB_URL=http://172.20.0.2:8080} $data {NOCODB_URL=https://noco.povarnakolesah.ru}]
    set data [regsub {NODE_ENV=production} $data {NODE_ENV=development}]
    set data [regsub {NEXT_PUBLIC_APP_URL=https://ogfoody.ru} $data {NEXT_PUBLIC_APP_URL=http://localhost:3000}]
    
    set fp [open .env.local w]
    puts $fp $data
    close $fp
    
    puts "\n\033\[0;32m‚úÖ .env.local —Å–æ–∑–¥–∞–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\033\[0m\n"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    puts "\033\[0;34müìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env.local:\033\[0m"
    exec cat .env.local
    
    # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    exec rm .env.production.temp
    
    puts "\n\033\[1;33m================================\033\[0m"
    puts "\033\[0;32m–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å:\033\[0m"
    puts "\033\[0;34mnpm run dev\033\[0m"
    puts "\033\[1;33m================================\033\[0m\n"
}


