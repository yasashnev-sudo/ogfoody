# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –ò–ù–ö–†–ï–ú–ï–ù–¢–ê –ü–†–û–ú–û–ö–û–î–ê

**–î–∞—Ç–∞:** 2026-01-15  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## üìã –í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã ‚úÖ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (`true`, `"true"`, —Å—Ç—Ä–æ–∫–∏)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `nocoOrderId` –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏—è

**–§–∞–π–ª:** `app/api/orders/route.ts:789-795`

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCode()` ‚úÖ
- –£–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ `Active,eq,true` (–∏—â–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- –î–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ where clause
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `lib/nocodb.ts:2475-2495`

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` ‚úÖ
- –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCodeById()`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤

**–§–∞–π–ª:** `lib/nocodb.ts:2491-2530`

### 4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PATCH ‚úÖ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞

**–§–∞–π–ª:** `app/api/orders/[id]/route.ts:385-410, 1275-1300`

---

## üîç –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´ –ü–†–û–ë–õ–ï–ú–´

### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: –£—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è `paid`, `paymentStatus`, `shouldIncrement`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ó–Ω–∞—á–µ–Ω–∏—è `order.paid` –∏ `order.paymentStatus` –≤ –ª–æ–≥–∞—Ö
- –†–µ–∑—É–ª—å—Ç–∞—Ç `shouldIncrement` –≤ –ª–æ–≥–∞—Ö
- –í—Ö–æ–¥–∏—Ç –ª–∏ –∫–æ–¥ –≤ –±–ª–æ–∫ `if (shouldIncrement)`

### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fetchPromoCode()`
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `fetchPromoCode()`?
- –ö–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (`found: true/false`)?
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è where clause?

### –ì–∏–ø–æ—Ç–µ–∑–∞ 3: –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–µ
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ `incrementPromoCodeUsage()`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `incrementPromoCodeUsage()`?
- –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö?
- –£—Å–ø–µ—à–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `clientFetch()`?

### –ì–∏–ø–æ—Ç–µ–∑–∞ 4: `nocoOrder.Id` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `nocoOrderId`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω –ª–∏ `nocoOrderId` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞?
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `Id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ `createOrder()`?

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å:
- `"Checking promo increment condition"` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è
- `"Calling fetchPromoCode"` - –≤—ã–∑–æ–≤ –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `"fetchPromoCode result"` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞
- `"Calling incrementPromoCodeUsage"` - –≤—ã–∑–æ–≤ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
- `"clientFetch update completed"` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å:
- `üîç [POST] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞:` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–µ—Ä–∫–µ
- `‚úÖ –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞ "..." –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω` - —É—Å–ø–µ—à–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
- `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞:` - –æ—à–∏–±–∫–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API
–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º —á–µ—Ä–µ–∑ API –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ –∑–∞–∫–∞–∑?
2. –ï—Å—Ç—å –ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –≤ –∑–∞–∫–∞–∑–µ?
3. –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ª–∏ `times_used`?

---

## üîß –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º
2. **–ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å—å** `"Checking promo increment condition"` –≤ –ª–æ–≥–∞—Ö
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è** `shouldIncrement`, `isPaid`, `isPaymentStatusPaid`
4. **–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
5. **–ï—Å–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å where clause –∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
6. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## ‚úÖ –ß–¢–û –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û

1. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCode()` (—É–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `nocoOrderId` –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–û–í–ï–†–ö–ê –õ–û–ì–û–í –°–ï–†–í–ï–†–ê  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã
