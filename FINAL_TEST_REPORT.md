# üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 2026-01-15  
**–†–µ–∂–∏–º:** –†–µ–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –∏ –ë–î  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —É—Å–ø–µ—à–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞)

---

## üìã –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

| –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|------|--------|--------|
| –¢–µ—Å—Ç 1: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
| –¢–µ—Å—Ç 2: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
| –¢–µ—Å—Ç 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ | ‚ùå FAIL | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–æ–±—â–µ |
| –¢–µ—Å—Ç 4: –ü–æ–ª—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | ‚úÖ PASS | –ü–æ–ª—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| –¢–µ—Å—Ç 5: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º | ‚úÖ PASS | –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ |

**–ò—Ç–æ–≥–æ:** 2/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ (40%)

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### 1. –ü–æ–ª—è min_order_amount –∏ max_discount –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç–µ Title Case
- –ü–æ–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ó–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã: `min_order_amount=1500`, `max_discount=500`

**–í—ã–≤–æ–¥:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ ‚úÖ

### 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É (—Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞)
- –§–æ—Ä–º—É–ª–∞: `orderTotal * cashbackPercent / 100`
- –ü—Ä–∏–º–µ—Ä: 1800‚ÇΩ * 3% = 54 –±–∞–ª–ª–∞ ‚úÖ

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

## ‚ùå –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### 1. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞, –Ω–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

#### –ü—Ä–æ–±–ª–µ–º–∞ 1.1: –§–æ—Ä–º–∞—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ë—ã–ª–æ:** `{ times_used: { increment: 1 } }` - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ NocoDB API v2
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ

#### –ü—Ä–æ–±–ª–µ–º–∞ 1.2: –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ fetchPromoCode()
- **–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã: `(Code,eq,${code})~and(Active,eq,true)`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–º–æ–∫–æ–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `Active: true`, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–∏

#### –ü—Ä–æ–±–ª–µ–º–∞ 1.3: –£—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
- **–í POST:** –£—Å–ª–æ–≤–∏–µ `order.paid === true || order.paymentStatus === 'paid'` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
- **–í PATCH:** –£—Å–ª–æ–≤–∏–µ `!wasPaid && willBePaid` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `incrementPromoCodeUsage()`
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø, –í–ù–ï–°–ï–ù–ù–´–ï –í –ö–û–î

### 1. –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

**–§–∞–π–ª:** `lib/nocodb.ts:2485-2510`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç `{ increment: 1 }` (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `fetchPromoCodeById()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è: `"Times Used": currentTimesUsed + 1`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCodeById()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–æ ID

**–ö–æ–¥:**
```typescript
export async function incrementPromoCodeUsage(id: number): Promise<void> {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ times_used
  const promo = await fetchPromoCodeById(id)
  if (!promo) {
    throw new Error(`Promo code with ID ${id} not found`)
  }
  
  const currentTimesUsed = typeof promo.times_used === 'number' 
    ? promo.times_used 
    : typeof promo['Times Used'] === 'number'
    ? promo['Times Used']
    : parseInt(String(promo.times_used || promo['Times Used'] || 0))
  
  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 1
  const newTimesUsed = currentTimesUsed + 1
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ bulk update (–º–∞—Å—Å–∏–≤)
  await clientFetch(
    "Promo_Codes",
    {},
    {
      method: "PATCH",
      body: JSON.stringify([{ Id: id, "Times Used": newTimesUsed }]),
    },
  )
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
```bash
npm run build
```
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `incrementPromoCodeUsage()` —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤:
1. `app/api/orders/route.ts` - –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã
2. `app/api/orders/[id]/route.ts` - –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã
3. `lib/nocodb.ts` - –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `incrementPromoCodeUsage()` –∏ `fetchPromoCode()`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `fetchPromoCode()` –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–º–æ–∫–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏–µ `Active,eq,true` –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:
- –í POST: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã `order.paid` –∏ `order.paymentStatus`
- –í PATCH: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `wasPaid` –∏ `willBePaid`

---

## üéØ –í–´–í–û–î–´

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ –ü–æ–ª—è `min_order_amount` –∏ `max_discount` –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞
3. ‚úÖ –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞)

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. ‚ùå –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω)
2. ‚ùå –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞ —á–µ—Ä–µ–∑ `fetchPromoCode()`
3. ‚ùå –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –≤ POST –∏ PATCH

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç: `npm run build`
2. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è - –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–ï–†–ï–°–ë–û–†–ö–ê –ò –ü–û–í–¢–û–†–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 60% (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)
