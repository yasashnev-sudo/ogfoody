# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
node scripts/test-loyalty-flow.js
```

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç

1. **–ë–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏–∑ –ë–î
2. **–°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑** –Ω–∞ 1000‚ÇΩ –ë–ï–ó —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã ‚Üí –±–∞–ª–ª—ã –ù–ï –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è ‚úì
3. **–û–ø–ª–∞—á–∏–≤–∞–µ—Ç –∑–∞–∫–∞–∑** –∫–∞—Ä—Ç–æ–π (PATCH) ‚Üí –±–∞–ª–ª—ã –î–û–õ–ñ–ù–´ –Ω–∞—á–∏—Å–ª–∏—Ç—å—Å—è ‚úì
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É (–±—ã–ª–æ ‚Üí —Å—Ç–∞–ª–æ)

## üîç –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–ª–∞–¥–∫—É

### –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Ç–µ—Å—Ç–∞ (`node scripts/...`):
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ (–ü–†–û–ô–î–ï–ù/–ü–†–û–í–ê–õ–ï–ù)
- üìä –ë–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤ (–±—ã–ª–æ ‚Üí —Å—Ç–∞–ª–æ)
- üí∞ –°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫ (–±—ã–ª–æ ‚Üí —Å—Ç–∞–ª–æ)
- üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ

### –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å–µ—Ä–≤–µ—Ä–∞ (`npm run dev`):
–ò—â–∏—Ç–µ –±–ª–æ–∫–∏ —Å —ç–º–æ–¥–∑–∏ **üîç**:

```
üîç ========== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (POST) ==========
üîç [POST] 1Ô∏è‚É£ –í—Ö–æ–¥—è—â–∏–π payload: { paymentMethod: undefined, ... }
üîç [POST] 6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤: { hasPaymentMethod: false }
üîç [POST] ‚ùå –£—Å–ª–æ–≤–∏–µ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω
üîç ========== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (POST) ==========

üîç ========== –ù–ê–ß–ê–õ–û –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH partial) ==========
üîç [PATCH partial 123] 1Ô∏è‚É£ –í—Ö–æ–¥—è—â–∏–π payload: { payment_method: "card", ... }
üîç [PATCH partial 123] 5Ô∏è‚É£ –í—ã–∑–æ–≤ calculateEarnedPoints: { orderTotal: 1150, ... }
üîç [PATCH partial 123] 6Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç: { loyaltyPointsEarned: 11 }
üîç [PATCH partial 123] 7Ô∏è‚É£ –í—ã–∑–æ–≤ awardLoyaltyPoints: { userId: 5, ... }
üîç [PATCH partial 123] 8Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç awardLoyaltyPoints: —É—Å–ø–µ—à–Ω–æ
üîç ========== –ö–û–ù–ï–¶ –û–¢–õ–ê–î–ö–ò –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í (PATCH partial) ==========
```

## ‚ùì –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "No suitable user found"
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ UI –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π userId

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª–∏–ª–∏—Å—å (–∏–∑–º–µ–Ω–µ–Ω–∏–µ: 0)
**–†–µ—à–µ–Ω–∏–µ:** –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å üîç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–≥ 5Ô∏è‚É£: –∫–∞–∫–æ–π `orderTotal` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–≥ 6Ô∏è‚É£: –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç `calculateEarnedPoints`?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–≥ 7Ô∏è‚É£-8Ô∏è‚É£: –≤—ã–∑–≤–∞–ª—Å—è –ª–∏ `awardLoyaltyPoints`?

### –ü—Ä–æ–±–ª–µ–º–∞: HTTP 400/500 –æ—à–∏–±–∫–∏
**–†–µ—à–µ–Ω–∏–µ:** –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π traceback –æ—à–∏–±–∫–∏ –≤ –≤—ã–≤–æ–¥–µ —Ç–µ—Å—Ç–∞

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù! –ë–∞–ª–ª—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω—ã (+11)

–ë–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤:
  –ë—ã–ª–æ:    0
  –°—Ç–∞–ª–æ:   11
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ: +11

–û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫:
  –ë—ã–ª–æ:    0‚ÇΩ
  –°—Ç–∞–ª–æ:   1150‚ÇΩ
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ: +1150‚ÇΩ
```

*(–¢–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∏ —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π)*

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏

- –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∑–∞–≤—Ç—Ä–∞—à–Ω—é—é –¥–∞—Ç—É** –¥–ª—è –∑–∞–∫–∞–∑–∞ (—á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ó–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É **1000‚ÇΩ** (subtotal) + –¥–æ—Å—Ç–∞–≤–∫–∞ ‚âà 1150‚ÇΩ
- –ü—Ä–∏ —É—Ä–æ–≤–Ω–µ Bronze (0-19999‚ÇΩ) –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **1% = 11 –±–∞–ª–ª–æ–≤**
- –¢–µ—Å—Ç **–ù–ï —É–¥–∞–ª—è–µ—Ç** —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑ - –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ UI

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `DEBUG_LOYALTY_POINTS_LOGS_2026_01_11.md`


