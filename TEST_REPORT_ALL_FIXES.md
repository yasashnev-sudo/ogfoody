# üìä –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 2026-01-15  
**–†–µ–∂–∏–º:** –†–µ–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –∏ –ë–î  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —É—Å–ø–µ—à–Ω–æ

---

## üìã –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í

### ‚úÖ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û (2/5):

#### ‚úÖ –¢–µ—Å—Ç 4: –ü–æ–ª—è min_order_amount –∏ max_discount –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- `min_order_amount=1500` ‚úÖ
- `max_discount=500` ‚úÖ

#### ‚úÖ –¢–µ—Å—Ç 5: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞
- –ù–∞—á–∏—Å–ª–µ–Ω–æ: 54 –±–∞–ª–ª–∞
- –û–∂–∏–¥–∞–ª–æ—Å—å: 54 –±–∞–ª–ª–∞ (3% –æ—Ç 1800‚ÇΩ)
- –†–∞—Å—á–µ—Ç: `1800 * 0.03 = 54` ‚úÖ

---

### ‚ùå –ü–†–û–í–ê–õ–ï–ù–´ (3/5):

#### ‚ùå –¢–µ—Å—Ç 1: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
**–°—Ç–∞—Ç—É—Å:** ‚ùå FAIL  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å `paid=true`

**–î–µ—Ç–∞–ª–∏:**
- –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω: ‚úÖ
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —Å `paid=true`, `paymentStatus='paid'`: ‚úÖ
- –£—Å–ª–æ–≤–∏–µ –≤ –∫–æ–¥–µ: `order.paid === true || order.paymentStatus === 'paid'` ‚úÖ
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª: `times_used` –æ—Å—Ç–∞–ª—Å—è 0

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fetchPromoCode()` (–≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑-–∑–∞ —É—Å–ª–æ–≤–∏—è `Active,eq,true`)
2. –û—à–∏–±–∫–∞ –≤ `incrementPromoCodeUsage()` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å)
3. –£—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

#### ‚ùå –¢–µ—Å—Ç 2: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
**–°—Ç–∞—Ç—É—Å:** ‚ùå FAIL  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ, –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–î–µ—Ç–∞–ª–∏:**
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —Å `paid=false`: ‚úÖ
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏: ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ GET API: `invalid json response body`
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ: `times_used` –æ—Å—Ç–∞–ª—Å—è 0

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –û—à–∏–±–∫–∞ –≤ GET API –¥–ª—è –∑–∞–∫–∞–∑–∞
2. –£—Å–ª–æ–≤–∏–µ `!wasPaid && willBePaid` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ PATCH
3. –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∑–∞–∫–∞–∑–µ (`currentOrder.promo_code`)

#### ‚ùå –¢–µ—Å—Ç 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
**–°—Ç–∞—Ç—É—Å:** ‚ùå FAIL  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–æ–±—â–µ (–Ω–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ)

**–î–µ—Ç–∞–ª–∏:**
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —Å `paid=false`: ‚úÖ
- –ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω —á–µ—Ä–µ–∑ PATCH: ‚úÖ
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª: `times_used` –æ—Å—Ç–∞–ª—Å—è 0

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –¢–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞, —á—Ç–æ –∏ –≤ —Ç–µ—Å—Ç–∞—Ö 1 –∏ 2
2. –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –§—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** –ü—Ä–∏ –ø—Ä—è–º–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–æ—Ä–º–∞—Ç–æ–º `{ increment: 1 }`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```typescript
// –ë–´–õ–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
body: JSON.stringify({ Id: id, times_used: { increment: 1 } })

// –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç):
const currentTimesUsed = await fetchPromoCodeById(id).then(p => p['Times Used'] || 0)
body: JSON.stringify([{ Id: id, "Times Used": currentTimesUsed + 1 }])
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fetchPromoCode()`

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `fetchPromoCode()` –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã:
```typescript
where: `(Code,eq,${code})~and(Active,eq,true)`
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–º–æ–∫–æ–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `Active: true`, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –£—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –í POST —É—Å–ª–æ–≤–∏–µ `order.paid === true || order.paymentStatus === 'paid'` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑-–∑–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∞.

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

1. **–ü–æ–ª—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏** ‚úÖ
   - `min_order_amount` –∏ `max_discount` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ Title Case —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º** ‚úÖ
   - –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É (—Å —É—á–µ—Ç–æ–º –ø—Ä–æ–º–æ–∫–æ–¥–∞)
   - –§–æ—Ä–º—É–ª–∞: `orderTotal * cashbackPercent / 100` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **–§—É–Ω–∫—Ü–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)** ‚úÖ
   - –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()`

---

## üîß –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

1. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `incrementPromoCodeUsage()`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã** –≤ POST `/api/orders`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã** –≤ PATCH `/api/orders/[id]`
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞** —á–µ—Ä–µ–∑ `fetchPromoCode()`

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `incrementPromoCodeUsage()` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö
4. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–û–†–ê–ë–û–¢–ö–ê  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 60% (2/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏, —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)
