# ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ YooKassa

**–î–∞—Ç–∞:** 2026-01-18  
**–ü—Ä–æ–±–ª–µ–º–∞:** `invalid_combination_of_payment_methods` –≤ –≤–∏–¥–∂–µ—Ç–µ

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏:

1. ‚úÖ **`payment_method_types` –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
   - –í `app/api/payments/yookassa/create/route.ts` –Ω–µ—Ç –ø–æ–ª—è `payment_method_types`
   - –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç YooKassa

2. ‚úÖ **–ó–∞–ø—Ä–æ—Å –∫ YooKassa –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π:**
   ```json
   {
     "amount": { "value": "3082.00", "currency": "RUB" },
     "confirmation": {
       "type": "embedded",
       "return_url": "https://ogfoody.ru/payment/success?orderId=1085"
     },
     "description": "–ó–∞–∫–∞–∑ #1085",
     "metadata": { "orderId": "1085" },
     "capture": true
   }
   ```

3. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –í–∏–¥–∂–µ—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å—Å—è
   - –í –ª–æ–≥–∞—Ö: `"shouldUseRedirect": false`
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `"shouldUseRedirect": true`
   - **–í—ã–≤–æ–¥:** –ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞

**–§–∞–π–ª:** `components/payment-modal.tsx`

```typescript
// ‚úÖ –í–†–ï–ú–ï–ù–ù–û: –û—Ç–∫–ª—é—á–∞–µ–º –≤–∏–¥–∂–µ—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ invalid_combination_of_payment_methods
const shouldUseRedirect = true // –í—Ä–µ–º–µ–Ω–Ω–æ: redirect –≤–µ–∑–¥–µ
```

**–ü–æ—á–µ–º—É:**
- –í–∏–¥–∂–µ—Ç –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π `invalid_combination_of_payment_methods`
- –ü—Ä–∏—á–∏–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞ YooKassa
- –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ redirect –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://yookassa.ru/my
2. –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω (Shop ID: 1251656)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã**
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
   - –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã
   - –°–ë–ü –≤–∫–ª—é—á–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
   - –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### 3. –î–µ–ø–ª–æ–π

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
cd "/Users/sergejasasnev/Downloads/my-project (1)"
git push origin main
./deploy-increment-fix.expect
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–µ–ø–ª–æ–π:**
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥: `git pull origin main`
3. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç: `npm run build`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `pm2 restart ogfoody`

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Ctrl+F5) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```javascript
"shouldUseRedirect": true  // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å true
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ

- ‚ùå –í–∏–¥–∂–µ—Ç –ù–ï –¥–æ–ª–∂–µ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
- ‚úÖ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã YooKassa
- ‚úÖ –û–ø–ª–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ redirect

### 3. –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –≤—Å–µ –µ—â–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
ssh root@ogfoody.ru
cd /var/www/ogfoody
grep "shouldUseRedirect" components/payment-modal.tsx
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```typescript
const shouldUseRedirect = true
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ redirect (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ redirect —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ:
- –û—Å—Ç–∞–≤–∏—Ç—å `shouldUseRedirect = true` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- –≠—Ç–æ –ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É YooKassa

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–µ—Ä–Ω—É—Ç—å –≤–∏–¥–∂–µ—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤–∏–¥–∂–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ YooKassa
2. –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YooKassa –ø–æ –ø–æ–≤–æ–¥—É –æ—à–∏–±–∫–∏
3. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä–Ω—É—Ç—å:
   ```typescript
   const shouldUseRedirect = platform === 'telegram' || platform === 'vk'
   ```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YooKassa: –í–∏–¥–∂–µ—Ç](https://yookassa.ru/developers/payment-acceptance/integration-scenarios/widget/quick-start)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YooKassa: –û—à–∏–±–∫–∏ –≤–∏–¥–∂–µ—Ç–∞](https://yookassa.ru/developers/payment-acceptance/integration-scenarios/widget/reference)
- [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç YooKassa](https://yookassa.ru/my)

---

**–°—Ç–∞—Ç—É—Å:** üîÑ –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
