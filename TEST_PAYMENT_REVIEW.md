# Тестирование обновления статуса оплаты и создания отзывов

## Способы тестирования

### 1. Через браузер (рекомендуется)

Откройте в браузере:
```
http://localhost:3000/test-payment-review.html
```

Заполните форму:
- **Номер заказа**: например, `ORD-20260105-13QGDU`
- **Телефон пользователя**: для создания отзыва (опционально)
- **Тип теста**: выберите нужный вариант

Нажмите кнопку для запуска теста.

### 2. Через API endpoint

#### Тест обновления статуса оплаты:

```bash
curl -X PATCH http://localhost:3000/api/orders/{ORDER_ID} \
  -H "Content-Type: application/json" \
  -d '{
    "paid": true,
    "paid_at": "2025-01-05T12:00:00.000Z",
    "payment_method": "card",
    "payment_status": "paid",
    "updated_at": "2025-01-05T12:00:00.000Z"
  }'
```

#### Поиск заказа по номеру:

```bash
curl "http://localhost:3000/api/orders?orderNumber=ORD-20260105-13QGDU"
```

#### Комплексный тест через endpoint:

```bash
curl -X POST http://localhost:3000/api/db/test-payment-review \
  -H "Content-Type: application/json" \
  -d '{
    "orderNumber": "ORD-20260105-13QGDU",
    "phone": "+79991234567",
    "testType": "both"
  }'
```

### 3. Через bash скрипт

```bash
./test-payment-review.sh ORD-20260105-13QGDU +79991234567
```

Или только обновление оплаты:
```bash
./test-payment-review.sh ORD-20260105-13QGDU
```

## Что тестируется

### ✅ Обновление статуса оплаты
- Поиск заказа по номеру `ORD-20260105-13QGDU`
- Обновление полей:
  - `paid`: `true`
  - `paid_at`: текущая дата/время
  - `payment_method`: `"card"`
  - `payment_status`: `"paid"`
  - `updated_at`: текущая дата/время

### ✅ Создание отзыва
- Поиск заказа по номеру
- Поиск пользователя по телефону (или использование user_id из заказа)
- Создание отзыва с полями:
  - `order_id`: ID заказа
  - `user_id`: ID пользователя
  - `rating`: 5
  - `text`: тестовый текст с датой/временем

## Проверка результатов

После выполнения тестов проверьте в NocoDB:

1. **Таблица Orders**:
   - Найдите заказ по номеру `ORD-20260105-13QGDU`
   - Проверьте, что `payment_status` = `"paid"`
   - Проверьте, что `paid` = `true`
   - Проверьте, что `paid_at` заполнено

2. **Таблица Reviews**:
   - Найдите отзыв с `order_id` = ID заказа
   - Проверьте, что все поля заполнены корректно

## Устранение проблем

### Заказ не найден
- Убедитесь, что номер заказа правильный
- Проверьте, что заказ существует в базе данных

### Пользователь не найден (для отзыва)
- Укажите правильный телефон пользователя
- Или убедитесь, что заказ привязан к пользователю (`user_id` заполнен)

### Ошибка обновления
- Проверьте, что сервер запущен
- Проверьте логи в консоли браузера/терминала
- Убедитесь, что переменные окружения NocoDB настроены правильно





