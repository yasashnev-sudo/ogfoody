# –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–î–∞—Ç–∞:** 2026-01-11  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã –∏–∑ OrderModal + –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ —Ä–∞–π–æ–Ω—É

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø–æ –ª–æ–≥–∞–º

### 1. –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î –ø–æ —Ä–∞–π–æ–Ω—É

```
‚è∞ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è —Ä–∞–π–æ–Ω–∞: –í—ã–±–æ—Ä–≥—Å–∫–∏–π —Ä–∞–π–æ–Ω
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã: Array(3)

‚è∞ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è —Ä–∞–π–æ–Ω–∞: –ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∏–π —Ä–∞–π–æ–Ω
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã: Array(3)
```

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–π–æ–Ω–∞.

### 2. Flow –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö

```
‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ–ø–æ–ª–Ω—ã–π, –∑–∞–ø—É—Å–∫–∞–µ–º flow –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ProfileModal
‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
‚Üí –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î —Å ID: 448
üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º PaymentModal: orderId = 448 userId = 48
üí≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã: –º–µ—Ç–æ–¥=sbp, –±–∞–ª–ª—ã=0
‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
```

**–í—ã–≤–æ–¥:** ‚úÖ –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è **–û–î–ò–ù –†–ê–ó** –≤ PaymentModal!

---

## –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ù–ï–û–ü–õ–ê–ß–ï–ù–ù–û–ì–û –∑–∞–∫–∞–∑–∞**

**–ö–æ–¥ –≤ OrderModal (—Å—Ç—Ä–æ–∫–∏ 547-565):**
```typescript
const order: Order = {
  ...(existingOrder?.id ? { id: existingOrder.id } : {}),
  ...(existingOrder?.orderNumber ? { orderNumber: existingOrder.orderNumber } : {}),
  startDate: dateKey,
  persons,
  delivered: existingOrder?.delivered ?? false,
  deliveryTime,
  extras,
  paid: existingOrder?.paid ?? false, // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å
  paidAt: existingOrder?.paidAt,
  paymentStatus: existingOrder?.paymentStatus ?? "pending",
  cancelled: existingOrder?.cancelled ?? false,
  paymentMethod: existingOrder?.paymentMethod, // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥
  promoCode: appliedPromo?.code,
  promoDiscount: appliedPromo?.discount,
  loyaltyPointsUsed: pointsDiscount > 0 ? pointsDiscount : undefined,
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç OrderModal —Å `existingOrder`
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –±–ª—é–¥–∞, –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
3. –ù–∞–∂–∏–º–∞–µ—Ç "–°–û–•–†–ê–ù–ò–¢–¨" (–∫–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è existingOrder)
4. –ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `PATCH /api/orders/${id}`
5. `paymentMethod` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–∑ `existingOrder?.paymentMethod`

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùì –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–∫–∞–∑, –æ–Ω –ù–ï –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã.

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–ª—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç PaymentModal
- –ò–õ–ò: –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ —Ç–æ–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å PaymentModal –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** ‚ö†Ô∏è –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã "–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –û–ü–õ–ê–ß–ï–ù–ù–û–ì–û –∑–∞–∫–∞–∑–∞**

**–ö–æ–¥ –≤ OrderModal (—Å—Ç—Ä–æ–∫–∞ 687):**
```typescript
const isPaid = existingOrder?.paid === true || existingOrder?.paymentStatus === "paid"
const canEdit = !isViewOnly && !isPaid
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –î–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ `canEdit = false`
2. –í—Å—è —Ñ–æ—Ä–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
3. –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å" –æ—Ç–∫–ª—é—á–µ–Ω–∞

**–í—ã–≤–æ–¥:** ‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è—é—Ç.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: **–ü–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ (isDraft=true)**

**–ö–æ–¥ –≤ OrderModal:**
```typescript
isDraft?: boolean // –§–ª–∞–≥ –ø–æ–≤—Ç–æ—Ä–∞ –∑–∞–∫–∞–∑–∞

{isDraft && (
  <div className="px-3 py-1 rounded-lg text-xs font-black bg-blue-500 text-white border-2 border-black flex items-center gap-1">
    <Copy className="w-3 h-3" />
    –ü–û–í–¢–û–†
  </div>
)}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑" –Ω–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–º –∑–∞–∫–∞–∑–µ
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è OrderModal —Å `isDraft=true` –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤
4. –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–∫–∞–∑–∞—Ç—å" ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è **–ù–û–í–´–ô** –∑–∞–∫–∞–∑ (–±–µ–∑ ID)
5. –ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /api/orders`
6. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è PaymentModal –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

**–í—ã–≤–æ–¥:** ‚úÖ –ü–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –≤ PaymentModal.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º)**

**Flow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è OrderModal (–±–µ–∑ existingOrder)
3. –í—ã–±–∏—Ä–∞–µ—Ç –±–ª—é–¥–∞, –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ —Ä–∞–π–æ–Ω—É ‚úÖ)
4. –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–∫–∞–∑–∞—Ç—å ¬∑ XXXX ‚ÇΩ"
5. `handlePayAndOrder` —Å–æ–∑–¥–∞–µ—Ç Order –±–µ–∑ ID
6. `onSave(order)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
7. –í `app/page.tsx` ‚Üí `handleSaveOrder`:
   - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /api/orders`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `order.id`
   - –ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ state —Å ID
8. **–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è PaymentModal**

**–ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–¥:**

```typescript
// handleSaveOrder (—Å—Ç—Ä–æ–∫–∏ 720-1137)
if (existingOrder?.id && isAuthenticated && userProfile?.id) {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–∞–∑–∞
} else if (isAuthenticated && userProfile?.id) {
  // ‚úÖ –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û –ó–ê–ö–ê–ó–ê
  const response = await fetch("/api/orders", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ order, userId: userProfile.id }),
  })
  
  // ‚ùì –ù–æ –≥–¥–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ PaymentModal?
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùó –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **–ù–ï –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è PaymentModal!**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–∫–∞–∑–∞—Ç—å", –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î, –Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –µ–≥–æ –Ω–µ–ª—å–∑—è ‚Äî –º–æ–¥–∞–ª–∫–∞ –æ–ø–ª–∞—Ç—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

**–ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏:**
```
üîç [OrderModal] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:
onSave(order)
‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –≤ –ë–î —Å ID: 448
```

–ù–æ –≤ –ª–æ–≥–∞—Ö –ù–ï–¢ —Å—Ç—Ä–æ–∫–∏ `üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º PaymentModal` –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ flow (—Ç–æ–ª—å–∫–æ –¥–ª—è `handleAutoCheckout`).

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: **handleAutoCheckout (–ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è)**

**–ö–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 2210-2355):**
```typescript
const handleAutoCheckout = async () => {
  // ... —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ...
  
  console.log("üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º PaymentModal: orderId =", updatedOrder.id, "userId =", userProfile.id)
  
  setShowOrderLoading(false)
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –æ–ø–ª–∞—Ç—ã
  setPaymentOrder({ 
    order: updatedOrder, 
    total: (pendingCheckout.order.subtotal || pendingCheckout.total) + deliveryFee 
  })
  
  setPendingCheckout(null)
  setShouldAutoCheckout(false)
}
```

**–í—ã–≤–æ–¥:** ‚úÖ –í `handleAutoCheckout` PaymentModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **–ö–†–ò–¢–ò–ß–ù–û: PaymentModal –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞**

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å **–ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º**
2. –°–æ–∑–¥–∞–µ—Ç **–Ω–æ–≤—ã–π –∑–∞–∫–∞–∑**
3. –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–∫–∞–∑–∞—Ç—å"
4. –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î
5. ‚ùå **PaymentModal –ù–ï –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è**
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑

**–ü—Ä–∏—á–∏–Ω–∞:**
–í `handleSaveOrder` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è PaymentModal:

```typescript
// app/page.tsx, —Å—Ç—Ä–æ–∫–∞ ~850
else if (isAuthenticated && userProfile?.id) {
  try {
    const response = await fetch("/api/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ order, userId: userProfile.id }),
    })
    
    if (!response.ok) {
      throw new Error("Failed to create order")
    }
    
    const result = await response.json()
    const createdOrder = result.order
    
    // ‚ùå –ó–¥–µ—Å—å –ù–ï–¢ –æ—Ç–∫—Ä—ã—Ç–∏—è PaymentModal!
    setOrders((prev) => [...prev.filter(/* ... */), createdOrder])
  } catch (error) {
    // ...
  }
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ PaymentModal –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:

```typescript
const result = await response.json()
const createdOrder = result.order

setOrders((prev) => [...prev.filter(/* ... */), createdOrder])

// ‚úÖ –î–û–ë–ê–í–ò–¢–¨:
setPaymentOrder({ 
  order: createdOrder, 
  total: createdOrder.total 
})
```

---

### **–ù–ï–ö–†–ò–¢–ò–ß–ù–û: –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞**

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª –∑–∞–∫–∞–∑, –≤—ã–±—Ä–∞–ª "–ù–∞–ª–∏—á–Ω—ã–µ"
2. –ü–æ—Ç–æ–º –ø–µ—Ä–µ–¥—É–º–∞–ª, —Ö–æ—á–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π
3. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–∫–∞–∑ –≤ OrderModal
4. ‚ùå **–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã**

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã" –¥–ª—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤:

```typescript
{existingOrder && !isPaid && existingOrder.paymentMethod && (
  <Button onClick={() => {
    setPaymentOrder({ order: existingOrder, total: existingOrder.total })
  }}>
    –ò–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
  </Button>
)}
```

---

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
   - `POST /api/orders` ‚Üí –°–æ–∑–¥–∞–µ—Ç Order, Order_Meals
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `order.id`

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
   - `PATCH /api/orders/${id}` ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç Order, Order_Meals

3. **–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:**
   - `PATCH /api/orders/${id}` ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `paid=true`, `paymentMethod`, —Å–æ–∑–¥–∞–µ—Ç Loyalty_Transactions

### ‚úÖ –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `paymentMethod`:

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- OrderModal —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª `paymentMethod` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Order
- PaymentModal –¥—É–±–ª–∏—Ä–æ–≤–∞–ª –≤—ã–±–æ—Ä

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- OrderModal –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `paymentMethod` (–æ—Å—Ç–∞–≤–ª—è–µ—Ç `undefined`)
- PaymentModal —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `paymentMethod` –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
- –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–∫–∞–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `existingOrder?.paymentMethod`

**–í—ã–≤–æ–¥:** ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –ë–î. `paymentMethod` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ **–°–†–û–ß–ù–û –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
1. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ PaymentModal –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –≤ `handleSaveOrder`

### üü° **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
1. –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
2. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ª–æ–≥–∏ `üïê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏` (–∏—Ö —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ)

### üü¢ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
1. ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ä–∞–π–æ–Ω—É
2. ‚úÖ Flow –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ü–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞
4. ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)
5. ‚úÖ `handleAutoCheckout` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç PaymentModal

---

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è PaymentModal? |
|----------|--------|---------------------------|
| –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å –ø—Ä–æ—Ñ–∏–ª–µ–º) | ‚ùå **–û–®–ò–ë–ö–ê** | –ù–ï–¢ |
| –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è) | ‚úÖ OK | –î–ê (—á–µ—Ä–µ–∑ handleAutoCheckout) |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚ö†Ô∏è **–û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï** | –ù–ï–¢ (—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è) |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ | ‚úÖ OK | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ |
| –ü–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ (isDraft) | ‚úÖ OK | –î–ê (–Ω–æ–≤—ã–π –∑–∞–∫–∞–∑) |
| –ì–æ—Å—Ç—å | ‚úÖ OK | –î–ê (—á–µ—Ä–µ–∑ handleAutoCheckout) |

---

## –ö–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏

**–§–∞–π–ª:** `app/page.tsx`  
**–§—É–Ω–∫—Ü–∏—è:** `handleSaveOrder`  
**–°—Ç—Ä–æ–∫–∏:** ~850-950

```typescript
} else if (isAuthenticated && userProfile?.id) {
  try {
    const response = await fetch("/api/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ order, userId: userProfile.id }),
    })
    
    if (!response.ok) {
      throw new Error("Failed to create order")
    }
    
    const result = await response.json()
    console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ API:', result)
    
    const createdOrder = result.order
    console.log('‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –≤ –ë–î —Å ID:', createdOrder.Id || createdOrder.id)
    
    setOrders((prev) => {
      const filtered = prev.filter((o) => getDateTimestamp(o.startDate) !== orderTimestamp)
      return [
        ...filtered,
        {
          ...createdOrder,
          id: createdOrder.Id || createdOrder.id,
          startDate: toDate(createdOrder.startDate || createdOrder["Start Date"]),
        },
      ]
    })
    
    // ‚úÖ –î–û–ë–ê–í–ò–¢–¨ –≠–¢–ò –°–¢–†–û–ö–ò:
    console.log("üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º PaymentModal –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞: orderId =", createdOrder.Id || createdOrder.id)
    setPaymentOrder({ 
      order: {
        ...createdOrder,
        id: createdOrder.Id || createdOrder.id,
        startDate: toDate(createdOrder.startDate || createdOrder["Start Date"]),
      }, 
      total: createdOrder.total 
    })
    
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:", error)
    setWarningDialog({
      open: true,
      title: "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞",
      description: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
      variant: "error",
    })
  }
}
```


