# ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù: Flow –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–î–∞—Ç–∞:** 11.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

---

## üéØ –ó–∞–¥–∞—á–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ–≥–¥–∞ **–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (—É–∂–µ –≤–≤–µ–ª —Ç–µ–ª–µ—Ñ–æ–Ω) –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, –Ω–æ —É –Ω–µ–≥–æ **–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å** (—Ä–∞–π–æ–Ω, –∏–º—è, –∞–¥—Ä–µ—Å, –¥–æ–º).

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ flow, —á—Ç–æ –∏ –¥–ª—è –≥–æ—Å—Ç—è
- –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: **–ò–º—è, –†–∞–π–æ–Ω, –£–ª–∏—Ü–∞, –î–æ–º**

---

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **components/order-modal.tsx** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –≤ `handlePayAndOrder`

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 466:**

```typescript
// ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
const isProfileComplete = 
  userProfile?.district && 
  userProfile?.name && 
  userProfile?.street && 
  userProfile?.building

if (!isProfileComplete) {
  console.log("‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ–ø–æ–ª–Ω—ã–π, –∑–∞–ø—É—Å–∫–∞–µ–º flow –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:", {
    hasDistrict: !!userProfile?.district,
    hasName: !!userProfile?.name,
    hasStreet: !!userProfile?.street,
    hasBuilding: !!userProfile?.building,
  })
  
  const order: Order = {
    ...(existingOrder?.id ? { id: existingOrder.id } : {}),
    ...(existingOrder?.orderNumber ? { orderNumber: existingOrder.orderNumber } : {}),
    startDate: dateKey,
    persons,
    deliveryTime,
    extras,
    paid: false,
    paymentStatus: "pending",
    paymentMethod,
    promoCode: appliedPromo?.code,
    promoDiscount: appliedPromo?.discount,
    loyaltyPointsUsed: pointsDiscount > 0 ? pointsDiscount : undefined,
    deliveryFee,
    subtotal: totalBeforeDiscount,
    total: finalTotal,
  }
  
  // –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º onRequestAuth –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å –Ω–µ–ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º
  onRequestAuth?.(order, finalTotal)
  return
}
```

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: `district`, `name`, `street`, `building`
- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `onRequestAuth` (—Ç–æ—Ç –∂–µ callback, —á—Ç–æ –¥–ª—è –≥–æ—Å—Ç–µ–π)
- –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∑–∞–∫–∞–∑–∞ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ

---

### 2. **app/page.tsx** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `handleDeliveryTimeSelected`

**–ó–∞–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 2471-2513):**

```typescript
const handleDeliveryTimeSelected = async (deliveryTime: string) => {
  try {
    console.log("üïê –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–æ:", deliveryTime)
    setSelectedDeliveryTime(deliveryTime)
    
    if (!pendingCheckout || !selectedDistrict) {
      console.error("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è")
      return
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–∞–π–æ–Ω–æ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º
    const updatedOrder: Order = {
      ...pendingCheckout.order,
      deliveryTime: deliveryTime,
    }

    setPendingCheckout({
      order: updatedOrder,
      total: pendingCheckout.total,
    })

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤—Ä–µ–º–µ–Ω–∏
    setShowDeliveryTimeModal(false)
    
    // ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    if (isAuthenticated && userProfile) {
      console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å")
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)
      const isProfileComplete = 
        userProfile.district && 
        userProfile.name && 
        userProfile.street && 
        userProfile.building
      
      if (!isProfileComplete) {
        console.log("‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ–ø–æ–ª–Ω—ã–π, –æ—Ç–∫—Ä—ã–≤–∞–µ–º ProfileModal –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")
        setShouldAutoCheckout(true) // –§–ª–∞–≥ –¥–ª—è –∞–≤—Ç–æ–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
        setShowProfile(true)
      } else {
        console.log("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª–Ω—ã–π, —Å–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑ —Å—Ä–∞–∑—É")
        setShowOrderLoading(true)
        
        try {
          await handleSaveOrder(updatedOrder)
          setPendingCheckout(null)
          setSelectedDistrict(null)
          setSelectedDeliveryTime(null)
        } catch (error) {
          console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:", error)
          setShowOrderLoading(false)
        }
      }
    } else {
      // –ï—Å–ª–∏ –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ—Å—Ç–µ–≤–æ–π —Ä–∞–π–æ–Ω –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      console.log("üîê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º AuthModal")
      if (!isAuthenticated) {
        localStorage.setItem("guest_district", selectedDistrict)
      }
      setShouldAutoCheckout(true)
      setShowAuthModal(true)
    }
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏:", error)
    setWarningDialog({
      open: true,
      title: "–û—à–∏–±–∫–∞",
      description: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
      variant: "error",
    })
  }
}
```

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ï—Å–ª–∏ **–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω** ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è
  - **–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ–ø–æ–ª–Ω—ã–π** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `ProfileModal` —Å `isCheckoutFlow=true`
  - **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª–Ω—ã–π** ‚Üí —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Å—Ä–∞–∑—É —á–µ—Ä–µ–∑ `handleSaveOrder`
- –ï—Å–ª–∏ **–ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `AuthModal` (—Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

---

## üéØ FLOW –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: **–ì–æ—Å—Ç—å (–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)**
```
1. OrderModal ‚Üí "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
2. onRequestAuth –≤—ã–∑–≤–∞–Ω
3. DistrictSelectionModal ‚Üí –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞
4. DeliveryTimeSelectionModal ‚Üí –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
5. AuthModal ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
6. useEffect –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
7. ProfileModal (isCheckoutFlow=true) ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
8. handleAutoCheckout ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ë–ï–ó –ø—Ä–æ—Ñ–∏–ª—è** (–ù–û–í–´–ô!)
```
1. OrderModal ‚Üí "–ó–∞–∫–∞–∑–∞—Ç—å"
2. handlePayAndOrder –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –Ω–µ–ø–æ–ª–Ω—ã–π
3. onRequestAuth –≤—ã–∑–≤–∞–Ω
4. DistrictSelectionModal ‚Üí –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å)
5. DeliveryTimeSelectionModal ‚Üí –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
6. ‚ö†Ô∏è –ü–†–û–ü–£–°–ö AuthModal (—É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
7. ProfileModal (isCheckoutFlow=true) ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏, –∞–¥—Ä–µ—Å–∞, –¥–æ–º–∞
8. handleAutoCheckout ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –° –ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º**
```
1. OrderModal ‚Üí "–ó–∞–∫–∞–∑–∞—Ç—å"
2. handlePayAndOrder –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –ø–æ–ª–Ω—ã–π ‚úÖ
3. –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É —á–µ—Ä–µ–∑ API
4. SuccessOrderDialog
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: `tests/profile-completion-flow.spec.ts`

**3 —Ç–µ—Å—Ç–∞:**
1. ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ì–æ—Å—Ç—å** ‚Üí —Ä–∞–π–æ–Ω ‚Üí –≤—Ä–µ–º—è ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
2. ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ë–ï–ó –ø—Ä–æ—Ñ–∏–ª—è** ‚Üí —Ä–∞–π–æ–Ω ‚Üí –≤—Ä–µ–º—è ‚Üí –ø—Ä–æ—Ñ–∏–ª—å
3. ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –° –ø—Ä–æ—Ñ–∏–ª–µ–º** ‚Üí –∑–∞–∫–∞–∑ —Å—Ä–∞–∑—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
Running 3 tests using 1 worker
  3 passed (31.5s)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤:

–ó–∞–ø—É—â–µ–Ω—ã `tests/simple-e2e.spec.ts`:
```
Running 7 tests using 1 worker
  7 passed (20.2s)
```

**‚úÖ –ù–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å!**

---

## üìä –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

–ü–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

| –ü–æ–ª–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è |
|------|-------------|-------------|
| –ò–º—è | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –†–∞–π–æ–Ω | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –£–ª–∏—Ü–∞ | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –î–æ–º | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –ö–≤–∞—Ä—Ç–∏—Ä–∞ | ‚ùå –ù–µ—Ç | - |
| –ü–æ–¥—ä–µ–∑–¥ | ‚ùå –ù–µ—Ç | - |
| –≠—Ç–∞–∂ | ‚ùå –ù–µ—Ç | - |
| –î–æ–º–æ—Ñ–æ–Ω | ‚ùå –ù–µ—Ç | - |

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚úÖ –ì–æ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–µ—Å—å flow (—Ä–∞–π–æ–Ω ‚Üí –≤—Ä–µ–º—è ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –∑–∞–∫–∞–∑)
2. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ë–ï–ó —Ä–∞–π–æ–Ω–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ (—Ä–∞–π–æ–Ω ‚Üí –≤—Ä–µ–º—è ‚Üí –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –∑–∞–∫–∞–∑)
3. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –° –ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º —Å–æ–∑–¥–∞—é—Ç –∑–∞–∫–∞–∑ —Å—Ä–∞–∑—É
4. ‚úÖ –†–∞–π–æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
5. ‚úÖ `ProfileModal` –≤ —Ä–µ–∂–∏–º–µ `isCheckoutFlow=true` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π UI
6. ‚úÖ –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ `handleAutoCheckout`
7. ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üö´ –ß—Ç–æ –ù–ï –ª–æ–º–∞–µ—Ç—Å—è

1. ‚úÖ –ì–æ—Å—Ç–∏ ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
2. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
3. ‚úÖ API –∑–∞–∫–∞–∑–æ–≤ ‚Äî –Ω–µ –∏–∑–º–µ–Ω—è–ª—Å—è
4. ‚úÖ ProfileModal ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ `isCheckoutFlow`
5. ‚úÖ –ú–æ–¥–∞–ª–∫–∏ —Ä–∞–π–æ–Ω–∞/–≤—Ä–µ–º–µ–Ω–∏ ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
6. ‚úÖ `handleAutoCheckout` ‚Äî —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ | –°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ |
|------|---------|-----------------|----------------|
| `components/order-modal.tsx` | `handlePayAndOrder` | ~40 | 0 |
| `app/page.tsx` | `handleDeliveryTimeSelected` | ~30 | ~45 |
| `tests/profile-completion-flow.spec.ts` | **–ù–û–í–´–ô** | ~450 | - |

**–ò—Ç–æ–≥–æ:** ~520 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, 0 –ª–æ–º–∞—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚úÖ

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚ùå –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è –º–æ–≥ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚ùå –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –∫–∞–∫ 0‚ÇΩ (–Ω–µ—Ç —Ä–∞–π–æ–Ω–∞)
- ‚ùå –ö—É—Ä—å–µ—Ä –Ω–µ –∑–Ω–∞–ª –∫—É–¥–∞ –≤–µ–∑—Ç–∏ –∑–∞–∫–∞–∑

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ë–ï–ó –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è: –∏–º—è, —Ä–∞–π–æ–Ω, —É–ª–∏—Ü–∞, –¥–æ–º
- ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ë–ï–ó –ø—Ä–æ—Ñ–∏–ª—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç
2. –û—á–∏—Å—Ç–∏—Ç–µ localStorage: `localStorage.clear()` –≤ –∫–æ–Ω—Å–æ–ª–∏
3. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```javascript
   localStorage.setItem('currentUser', '+79991234567');
   localStorage.setItem('profile_+79991234567', JSON.stringify({
     phone: '+79991234567',
     id: 12345,
     name: '',
     street: '',
     building: '',
     district: '',
     loyaltyPoints: 0,
   }));
   ```
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–æ
6. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–∫–∞–∑–∞—Ç—å"
7. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –û—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–∞
8. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
9. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –û—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
10. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
11. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –û—Ç–∫—Ä–æ–µ—Ç—Å—è ProfileModal —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏"
12. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è, —É–ª–∏—Ü—É, –¥–æ–º
13. –ù–∞–∂–º–∏—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
14. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API

### –¢–µ—Å—Ç 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –° –ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   ```javascript
   localStorage.setItem('currentUser', '+79997654321');
   localStorage.setItem('profile_+79997654321', JSON.stringify({
     phone: '+79997654321',
     id: 54321,
     name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
     street: '–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç',
     building: '10',
     district: '–ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∏–π —Ä–∞–π–æ–Ω',
     loyaltyPoints: 0,
   }));
   ```
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–æ
4. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–∫–∞–∑–∞—Ç—å"
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –°–†–ê–ó–£, –±–µ–∑ –º–æ–¥–∞–ª–æ–∫ —Ä–∞–π–æ–Ω–∞/–≤—Ä–µ–º–µ–Ω–∏/–ø—Ä–æ—Ñ–∏–ª—è

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `DATA_ARCHITECTURE_RULES.md` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- `tests/profile-completion-flow.spec.ts` ‚Äî –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- `tests/simple-e2e.spec.ts` ‚Äî —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (–ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION

---

## üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (11.01.2026)

### –ü—Ä–æ–±–ª–µ–º–∞: –î–≤–æ–π–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Ä–∞–π–æ–Ω–∞

–ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ë–ï–ó –ø—Ä–æ—Ñ–∏–ª—è —Å–∏—Å—Ç–µ–º–∞ **–¥–≤–∞ —Ä–∞–∑–∞** —Å–ø—Ä–∞—à–∏–≤–∞–ª–∞ —Ä–∞–π–æ–Ω.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `BUGFIX_DOUBLE_DISTRICT_MODAL.md`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ `onRequestAuth` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–∞–π–æ–Ω–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –º–æ–¥–∞–ª–∫–∏
2. ‚úÖ `handleLogin` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Ä–∞–π–æ–Ω–∞ –µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤—ã–±—Ä–∞–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
3. ‚úÖ –ï—Å–ª–∏ —Ä–∞–π–æ–Ω + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –µ—Å—Ç—å ‚Üí —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –≤—Ä–µ–º–µ–Ω–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–¥–∞–ª–∫–∞ —Ä–∞–π–æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑** ‚úÖ

**–¢–µ—Å—Ç—ã:** 10 passed (–≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã) ‚úÖ


