# ‚úÖ –î–ï–ü–õ–û–ô –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ò–ù–ö–†–ï–ú–ï–ù–¢–ê –ü–†–û–ú–û–ö–û–î–ê - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2026-01-15  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ ‚úÖ
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchPromoCode()` (—É–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `incrementPromoCodeUsage()` (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- ‚úÖ –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (`localhost:3000`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã npm —Å–∫—Ä–∏–ø—Ç—ã:
  - `npm run test:fixes:local` - –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `npm run test:fixes:prod` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
  - `npm run test:fixes` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é localhost)

### 3. Git –∏ –¥–µ–ø–ª–æ–π ‚úÖ
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã –≤ GitHub (`main` –≤–µ—Ç–∫–∞)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è `deploy-increment-fix.sh`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `DEPLOY_NOW_INCREMENT_FIX.md`

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:**
- `307e647f` - üì¶ Add deployment script and instructions for increment fix
- `c498fbde` - üîß Fix promo code increment: improve payment condition check, fix fetchPromoCode, fix incrementPromoCodeUsage, add comprehensive debug logging

---

## üöÄ –î–ï–ü–õ–û–ô

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (GitHub Actions)

–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions:
1. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –∑–∞–ø—É—à–µ–Ω—ã –≤ `main`
2. ‚è≥ GitHub Actions –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
3. üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: https://github.com/yasashnev-sudo/ogfoody/actions

**–ï—Å–ª–∏ Actions –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –û—Ç–∫—Ä–æ–π—Ç–µ: https://github.com/yasashnev-sudo/ogfoody/actions
- –ù–∞–∂–º–∏—Ç–µ "Run workflow" ‚Üí "Run workflow"

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π (–µ—Å–ª–∏ Actions –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

```bash
ssh root@5.129.194.168

cd /root/my-project  # –∏–ª–∏ /var/www/ogfoody
git pull origin main
npm install
npm run build
pm2 restart all
pm2 logs --lines 50
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º)

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
npm run test:fixes:local
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

```bash
npm run test:fixes:prod
```

---

## üìä –ü–†–û–í–ï–†–ö–ê –õ–û–ì–û–í –ù–ê –ü–†–û–î–ê–ö–®–ù

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
ssh root@5.129.194.168
pm2 logs --lines 100 | grep -E "(–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞|fetchPromoCode|incrementPromoCodeUsage|promo code)"
```

**–ò—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏:**
- `üîç [POST] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞:` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è
- `Calling fetchPromoCode` - –ø–æ–∏—Å–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `fetchPromoCode result` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ (found: true/false)
- `Calling incrementPromoCodeUsage` - –≤—ã–∑–æ–≤ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
- `clientFetch update completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `‚úÖ –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞ "..." –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω` - —É—Å–ø–µ—à–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. `app/api/orders/route.ts` - —É–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. `app/api/orders/[id]/route.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PATCH
3. `lib/nocodb.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `fetchPromoCode()` –∏ `incrementPromoCodeUsage()`
4. `components/order-modal.tsx` - –ø—Ä–æ–≤–µ—Ä–∫–∞ usage_type (—É–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ)
5. `app/admin/promo/page.tsx` - –ø–æ–ª—è min_order_amount –∏ max_discount (—É–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ)
6. `scripts/test-all-fixes.ts` - –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
7. `package.json` - –¥–æ–±–∞–≤–ª–µ–Ω—ã npm —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## ‚úÖ CHECKLIST

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [x] –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã –≤ GitHub
- [ ] –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ GitHub Actions)
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
- [ ] –¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –∑–∞–ø—É—â–µ–Ω
- [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤—Ä—É—á–Ω—É—é)

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

–ï—Å–ª–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –æ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Å–ª–æ–≤–∏—è –∏ –ø–æ–∏—Å–∫–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ª–æ–≤–∏–µ –æ–ø–ª–∞—Ç—ã** - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `shouldIncrement: true`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∏—Å–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞** - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `found: true`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–∑–æ–≤ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞** - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Calling incrementPromoCodeUsage`
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `clientFetch update completed`

–í—Å–µ —ç—Ç–∏ –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö PM2 –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º.

---

**–ì–æ—Ç–æ–≤–æ!** üöÄ

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Actions –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ SSH.
