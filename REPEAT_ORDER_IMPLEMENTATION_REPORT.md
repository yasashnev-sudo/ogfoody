# üîÑ REPEAT ORDER FEATURE - –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞

**–î–∞—Ç–∞:** 11.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** Senior Frontend Developer

---

## üìã –ó–∞–¥–∞—á–∞

–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑" (Repeat Order) –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤. –°—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞ –∫—Ä–∏–≤–æ - –∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø–∞–¥–∞–ª–∞.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `lib/cart-utils.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤.

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:**
```typescript
export function validateOrderItems(
  order: Order,
  currentMenu: Record<string, Meal[]>,
  currentExtras: Record<string, Extra[]>
): OrderValidationResult
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –º–µ–Ω—é
- ‚úÖ **–ö–†–ò–¢–ò–ß–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–ï–ö–£–©–£–Æ —Ü–µ–Ω—É –∏–∑ –º–µ–Ω—é, –∞ –Ω–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é
- ‚úÖ –ò—â–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å–Ω–∞—á–∞–ª–∞ –ø–æ ID (–Ω–∞–¥–µ–∂–Ω–æ), –ø–æ—Ç–æ–º –ø–æ –∏–º–µ–Ω–∏ (—Ñ–æ–ª–±—ç–∫)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤—ã–±–æ—Ä—ã (–ø–æ—Ä—Ü–∏—è, –≥–∞—Ä–Ω–∏—Ä)
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
const { validatedOrder, unavailableItems, hasUnavailableItems } = validateOrderItems(
  historicalOrder,
  menuData.meals,
  menuData.extras
)

if (hasUnavailableItems) {
  toast.warning(`–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã: ${unavailableItems.join(', ')}`)
}
```

---

### 2Ô∏è‚É£ –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleRepeatOrder` –≤ `app/page.tsx`

**–õ–æ–∫–∞—Ü–∏—è:** `app/page.tsx`, —Å—Ç—Ä–æ–∫–∏ 1475-1565

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã (–°–¢–†–û–ì–û):**

#### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏
```typescript
const weekType = getWeekTypeForDate(targetDate)
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "current" –∏–ª–∏ "next" –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç—ã
```

#### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω—é –∏–∑ API
```typescript
const response = await fetch(`/api/menu?week=${weekType}`)
const menuData = await response.json()
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ö–ê–ñ–î–´–ô –†–ê–ó, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à!

#### –®–∞–≥ 3: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
```typescript
const { validatedOrder, unavailableItems, hasUnavailableItems } = validateOrderItems(
  order,
  menuData.meals || {},
  menuData.extras || {}
)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –º–µ–Ω—é
- **–¶–µ–Ω–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ–Ω—é** (–Ω–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏!)
- –¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –º–µ–Ω—é, –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

#### –®–∞–≥ 4: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
if (hasUnavailableItems) {
  showWarning(
    '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
    `–°–ª–µ–¥—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –±–æ–ª—å—à–µ –Ω–µ –≤ –º–µ–Ω—é: ${unavailableItems.join(', ')}`,
    'warning'
  )
}
```

#### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
```typescript
const newOrder: Order = {
  ...validatedOrder,
  // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–∫–∞–∑–∞
  id: undefined,
  orderNumber: undefined,
  startDate: targetDate,
  delivered: false,
  paid: false,
  paidAt: undefined,
  paymentMethod: undefined,
  orderStatus: 'pending',
  // –¶–µ–Ω—ã –±—É–¥—É—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –≤ OrderModal
  total: undefined,
  subtotal: undefined,
  deliveryFee: undefined,
  loyaltyPointsEarned: 0,
  loyaltyPointsUsed: 0,
}
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** 
- –í—Å–µ –ø–æ–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–∫–∞–∑–∞ –æ—á–∏—â–µ–Ω—ã
- `total`, `subtotal`, `deliveryFee` –±—É–¥—É—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ OrderModal —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏

#### –®–∞–≥ 6: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ OrderModal
```typescript
setSelectedDate(targetDate)
// OrderModal –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ selectedDate –∏–∑–º–µ–Ω–∏—Ç—Å—è
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –∫–æ—Ä–∑–∏–Ω—É —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏.

---

### 3Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `order-history.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

#### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã
```typescript
import { RotateCcw, Loader2 } from "lucide-react"
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω loading state
```typescript
const [repeatLoading, setRepeatLoading] = useState<string | null>(null)
```

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑"
```typescript
<Button
  size="sm"
  onClick={() => setRepeatMenuOpen(...)}
  disabled={repeatLoading === orderKey}
  data-testid="repeat-order-btn"  // ‚úÖ –î–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
>
  {repeatLoading === orderKey ? (
    <>
      <Loader2 className="w-3 h-3 mr-1 animate-spin" />
      –ó–∞–≥—Ä—É–∑–∫–∞...
    </>
  ) : (
    <>
      <RotateCcw className="w-3 h-3 mr-1" />  {/* ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–∫–æ–Ω–∫–∞ */}
      –ü–û–í–¢–û–†–ò–¢–¨ –ó–ê–ö–ê–ó
    </>
  )}
</Button>
```

#### 4. Async –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã
```typescript
onClick={async () => {
  setRepeatLoading(orderKey)  // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loading
  try {
    await onRepeatOrder(order, date)
  } finally {
    setRepeatLoading(null)  // ‚úÖ –í—Å–µ–≥–¥–∞ —Å–Ω–∏–º–∞–µ–º loading
    setRepeatMenuOpen(null)
  }
}}
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** `finally` –±–ª–æ–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–Ω—è—Ç–∏–µ loading –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ!

#### 5. –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```typescript
interface OrderHistoryProps {
  // ...
  onRepeatOrder: (order: Order, targetDate: Date) => Promise<void>  // ‚úÖ –¢–µ–ø–µ—Ä—å async
}
```

---

## üé® UX/UI –£–ª—É—á—à–µ–Ω–∏—è

### 1. Loading State
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç spinner –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (`disabled`) –ø–æ–∫–∞ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –¢–µ–∫—Å—Ç –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ó–∞–≥—Ä—É–∑–∫–∞..."

### 2. –ò–∫–æ–Ω–∫–∞
- ‚úÖ **–ë—ã–ª–æ:** `<Copy />` (–∏–∫–æ–Ω–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ **–°—Ç–∞–ª–æ:** `<RotateCcw />` (–∏–∫–æ–Ω–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

### 3. –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
- ‚úÖ **–ë—ã–ª–æ:** "–ü–û–í–¢–û–†–ò–¢–¨"
- ‚úÖ **–°—Ç–∞–ª–æ:** "–ü–û–í–¢–û–†–ò–¢–¨ –ó–ê–ö–ê–ó" (–±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ)

### 4. Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- ‚úÖ –°–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω
- ‚úÖ –¢–∏–ø: `warning` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ –ü–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–∞ –∑–∞–∫–∞–∑–∞ OrderModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–æ—Å—å
- ‚úÖ –ú–æ–∂–µ—Ç —Å—Ä–∞–∑—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏—Ç—å

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã (data-testid)
```typescript
data-testid="repeat-order-btn"
```

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:**
```typescript
test('Repeat order button should exist', async ({ page }) => {
  const repeatBtn = page.locator('[data-testid="repeat-order-btn"]')
  await expect(repeatBtn).toBeVisible()
})
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Å–µ —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
2. ‚úÖ –ù–∞–∂–∞—Ç—å "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑"
3. ‚úÖ –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É –∏–∑ —Å–ø–∏—Å–∫–∞
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∫–∞..."
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: OrderModal –æ—Ç–∫—Ä—ã–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ –º–µ—Å—Ç–µ
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: **—Ü–µ–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ** (–Ω–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏!)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å —Ç–æ–≤–∞—Ä–æ–º A
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä A –∏–∑ –º–µ–Ω—é –≤ NocoDB
3. ‚úÖ –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: Toast –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã: A"
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: OrderModal –æ—Ç–∫—Ä—ã–ª–∞—Å—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç–æ–≤–∞—Ä–∞ A –Ω–µ—Ç –≤ –∑–∞–∫–∞–∑–µ

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–∑–º–µ–Ω–∏–ª–∏—Å—å —Ü–µ–Ω—ã
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –±–ª—é–¥–æ–º B (—Ü–µ–Ω–∞ 300‚ÇΩ)
2. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É –±–ª—é–¥–∞ B –Ω–∞ 350‚ÇΩ –≤ NocoDB
3. ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤ OrderModal —Ü–µ–Ω–∞ –±–ª—é–¥–∞ B = 350‚ÇΩ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è!)
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: total –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è —Å –Ω–æ–≤–æ–π —Ü–µ–Ω–æ–π

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é
1. ‚úÖ –û—Ç–∫–ª—é—á–∏—Ç—å NocoDB –∏–ª–∏ API
2. ‚úÖ –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑"
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: loading —Å–Ω–∏–º–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: OrderModal –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º `filterAvailableItems`?

**–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥** (`filterAvailableItems`):
```typescript
const filteredOrder = filterAvailableItems(order)
// –ü—Ä–æ–±–ª–µ–º—ã:
// ‚ùå –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º MEALS (fallback)
// ‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –∏–∑ API
// ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã
```

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥** (`validateOrderItems`):
```typescript
const menuData = await fetch('/api/menu')
const { validatedOrder } = validateOrderItems(order, menuData.meals, menuData.extras)
// –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
// ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ê–ö–¢–£–ê–õ–¨–ù–û–ï –º–µ–Ω—é –∏–∑ API
// ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç –¢–ï–ö–£–©–ò–ï —Ü–µ–Ω—ã
// ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏–∑ –ë–î
```

### –ü–æ—á–µ–º—É –æ—á–∏—â–∞–µ–º total/subtotal?

```typescript
total: undefined,
subtotal: undefined,
deliveryFee: undefined,
```

**–ü—Ä–∏—á–∏–Ω–∞:** OrderModal –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –¢–µ–∫—É—â–∏—Ö —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤ (–∏–∑ –º–µ–Ω—é)
- –í—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ—Ä—Ü–∏–π (single/medium/large)
- –†–∞–π–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ï—Å–ª–∏ –Ω–µ –æ—á–∏—Å—Ç–∏—Ç—å:**
- ‚ùå –û—Å—Ç–∞–Ω—É—Ç—Å—è —Å—Ç–∞—Ä—ã–µ —Ü–µ–Ω—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ total
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### –ü–æ—á–µ–º—É async?

**–§—É–Ω–∫—Ü–∏—è —Å—Ç–∞–ª–∞ async:**
```typescript
onRepeatOrder: (order: Order, targetDate: Date) => Promise<void>
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é –∏–∑ API - async –æ–ø–µ—Ä–∞—Ü–∏—è
2. ‚úÖ –ù—É–∂–µ–Ω loading state –¥–ª—è UX
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

---

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Console –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```typescript
console.log('üîÑ [Repeat Order] –ù–∞—á–∞–ª–æ –ø–æ–≤—Ç–æ—Ä–∞ –∑–∞–∫–∞–∑–∞:', {
  orderId: order.id,
  orderNumber: order.orderNumber,
  targetDate: targetDate.toISOString(),
  weekType,
})

console.log('üìã [Repeat Order] –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', {
  hasBreakfast: menuData.meals?.breakfast?.length > 0,
  hasLunchSalad: menuData.meals?.lunch_salad?.length > 0,
  hasExtras: menuData.extras ? Object.keys(menuData.extras).length : 0,
})

console.log('‚úÖ [Repeat Order] –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', {
  unavailableCount: unavailableItems.length,
  unavailableItems,
})

console.log('üöÄ [Repeat Order] –û—Ç–∫—Ä—ã–≤–∞–µ–º OrderModal —Å –Ω–æ–≤—ã–º –∑–∞–∫–∞–∑–æ–º')
```

**–ù–∞–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:** –ò—â–∏—Ç–µ —ç–º–æ–¥–∑–∏ `üîÑ`, `üìã`, `‚úÖ`, `üöÄ`

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `lib/cart-utils.ts` (–Ω–æ–≤—ã–π)

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `app/page.tsx` (handleRepeatOrder)
- ‚úÖ `components/order-history.tsx` (UI + loading state)

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- üìÑ `DATA_ARCHITECTURE_RULES.md` - –ø—Ä–∞–≤–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- üìÑ `SAFE_DATA_LOADING_REPORT.md` - –∑–∞—â–∏—Ç–∞ –æ—Ç race condition
- üìÑ `UX_MESSAGES_RECOMMENDATIONS.md` - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ UX

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´

### 1. –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º –¢–ï–ö–£–©–£–Æ —Ü–µ–Ω—É
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
return mealFromHistory  // –¶–µ–Ω–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏!

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
return {
  ...foundInMenu,  // –¶–µ–Ω–∞ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ–Ω—é!
  portion: mealFromHistory.portion,  // –ù–æ –ø–æ—Ä—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω—è–µ–º
}
```

### 2. –í–°–ï–ì–î–ê —Å–Ω–∏–º–∞–µ–º loading –≤ finally
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
try {
  await action()
  setLoading(false)  // –ù–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ!
} catch (error) {}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
try {
  await action()
} finally {
  setLoading(false)  // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤—Å–µ–≥–¥–∞!
}
```

### 3. –í–°–ï–ì–î–ê –æ—á–∏—â–∞–µ–º –ø–æ–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–∫–∞–∑–∞
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
const newOrder = { ...oldOrder, startDate: newDate }
// –û—Å—Ç–∞–Ω—É—Ç—Å—è: id, orderNumber, paid, total, etc.

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
const newOrder = {
  ...oldOrder,
  id: undefined,
  orderNumber: undefined,
  total: undefined,
  // ... –≤—Å–µ –ø–æ–ª—è —è–≤–Ω–æ –æ—á–∏—â–µ–Ω—ã
}
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ
- ‚úÖ –¶–µ–Ω—ã –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ (–∏–∑ API)
- ‚úÖ –¢–æ–≤–∞—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –º–µ–Ω—é
- ‚úÖ –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
- ‚úÖ Loading state –¥–ª—è UX
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –∏ —Ç–µ–∫—Å—Ç
- ‚úÖ data-testid –¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

### –ú–µ—Ç—Ä–∏–∫–∏:
- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 1 (cart-utils.ts)
- **–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2 (page.tsx, order-history.tsx)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~300 (–≤–∫–ª—é—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é)
- **–§—É–Ω–∫—Ü–∏–π:** 3 (validateOrderItems, hasOrderContent, handleRepeatOrder)
- **–¢–µ—Å—Ç—ã:** data-testid –¥–æ–±–∞–≤–ª–µ–Ω

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ù–£

**–ê–≤—Ç–æ—Ä:** Senior Frontend Developer  
**–î–∞—Ç–∞:** 11.01.2026



